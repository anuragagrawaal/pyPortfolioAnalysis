<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>pyPortfolioAnalysis.pyPortfolioAnalysis API documentation</title>
    <meta name="description" content="pyPortfolioAnalysis: Methods to optimize portfolio
=================================================..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.HHI">HHI</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.VaR">VaR</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.VaR_portfolio">VaR_portfolio</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.add_constraint">add_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.add_objective">add_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.box_constraint">box_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.cVaR_portfolio">cVaR_portfolio</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.chart_efficient_frontier">chart_efficient_frontier</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.chart_group_weights">chart_group_weights</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.chart_weights">chart_weights</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.constrained_objective">constrained_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.diversification">diversification</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.diversification_constraint">diversification_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.equal_weight">equal_weight</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.extract_groups">extract_groups</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.extract_objective_measure">extract_objective_measure</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.extract_weights">extract_weights</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.factor_exposure_constraint">factor_exposure_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.fn_map">fn_map</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.generate_sequence">generate_sequence</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.get_constraints">get_constraints</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.group_constraint">group_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.group_fail">group_fail</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.inverse_volatility_weights">inverse_volatility_weights</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_exposure_constraint">leverage_exposure_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_fail">leverage_fail</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.max_sum_fail">max_sum_fail</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.min_sum_fail">min_sum_fail</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.minmax_objective">minmax_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.normalize_weights">normalize_weights</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.optimize_portfolio">optimize_portfolio</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.performance_metrics_objective">performance_metrics_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.port_mean">port_mean</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_risk_objective">portfolio_risk_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.pos_limit_fail">pos_limit_fail</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.position_limit_constraint">position_limit_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.return_constraint">return_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.return_objective">return_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.risk_budget_objective">risk_budget_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease">rp_decrease</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease_leverage">rp_decrease_leverage</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.rp_increase">rp_increase</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.rp_position_limit">rp_position_limit</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.rp_transform">rp_transform</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.transaction_cost_constraint">transaction_cost_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.turnover">turnover</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_constraint">turnover_constraint</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_objective">turnover_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.var_portfolio">var_portfolio</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.weight_concentration_objective">weight_concentration_objective</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.weight_sum_constraint">weight_sum_constraint</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman">black_litterman</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.__init__">__init__</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.fit">fit</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec">portfolio_spec</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.__init__">__init__</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.optimal_portfolio">optimal_portfolio</a></li>
    <li class="mono"><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.port_summary">port_summary</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">pyPortfolioAnalysis.pyPortfolioAnalysis</span> module</h1>
  <h1>pyPortfolioAnalysis: Methods to optimize portfolio</h1>
<p>Documentation is available as docstring or as HTML on https://github.com/anuragagrawaal/pyPortfolioAnalysis</p>
<p>Fucntions and Classes </p>
<h1>Optimization Methods</h1>
<p>'HHI'
 'VaR'
 'VaR_portfolio'
 'add_constraint'
 'add_objective'
 'black_litterman'
 'box_constraint'
 'cVaR_portfolio'
 'constrained_objective'
 'diversification'
 'diversification_constraint'
 'equal_weight'
 'extract_groups'
 'extract_objective_measure'
 'extract_weights'
 'factor_exposure_constraint'
 'fn_map'
 'generate_sequence'
 'get_constraints'
 'group_constraint'
 'group_fail'
 'inverse_volatility_weights'
 'leverage_exposure_constraint'
 'leverage_fail'
 'max_sum_fail'
 'min_sum_fail'
 'minmax_objective'
 'normalize_weights'
 'optimize_portfolio'
 'performance_metrics_objective
 'port_mean'
 'portfolio_risk_objective'
 'portfolio_spec'
 'pos_limit_fail'
 'position_limit_constraint'
 'return_constraint'
 'return_objective'
 'risk_budget_objective'
 'rp_decrease'
 'rp_decrease_leverage'
 'rp_increase'
 'rp_position_limit'
 'rp_transform'
 'transaction_cost_constraint'
 'turnover'
 'turnover_constraint'
 'turnover_objective'
 'var_portfolio'
 'weight_concentration_objective'
 'weight_sum_constraint'</p>
<h1>Plots</h1>
<p>'chart_efficient_frontier'
 'chart_group_weights'
 'chart_weights'</p>
<h2>References</h2>
<p>Brian G. Peterson and Peter Carl (2018). PortfolioAnalytics: Portfolio Analysis, Including Numerical Methods for Optimization of Portfolios. R package version 1.1.0. https://CRAN.R-project.org/package=PortfolioAnalytics</p>
<p>Boudt, Kris and Lu, Wanbo and Peeters, Benedict, Higher Order Comoments of Multifactor Models and Asset Allocation (June 16, 2014). Available at SSRN: http://ssrn.com/abstract=2409603 or http://dx.doi.org/10.2139/ssrn.2409603</p>
<p>Chriss, Neil A and Almgren, Robert, Portfolios from Sorts (April 27, 2005). Available at SSRN: http://ssrn.com/abstract=720041 or http://dx.doi.org/10.2139/ssrn.720041</p>
<p>Meucci, Attilio, The Black-Litterman Approach: Original Model and Extensions (August 1, 2008). Shorter version in, THE ENCYCLOPEDIA OF QUANTITATIVE FINANCE, Wiley, 2010. Avail- able at SSRN: http://ssrn.com/abstract=1117574 or http://dx.doi.org/10.2139/ssrn.1117574</p>
<p>Meucci, Attilio, Fully Flexible Views: Theory and Practice (August 8, 2008). Fully Flexible Views: Theory and Practice, Risk, Vol. 21, No. 10, pp. 97-102, October 2008. Available at SSRN: http://ssrn.com/abstract=1213325</p>
<p>Scherer, Bernd and Martin, Doug, Modern Portfolio Optimization. Springer. 2005.</p>
<p>Shaw, William Thornton, Portfolio Optimization for VAR, CVaR, Omega and Utility with General Return Distributions: A Monte Carlo Approach for Long-Only and Bounded Short Portfolios with Optional Robustness and a Simplified Approach to Covariance Matching (June 1, 2011). Available at SSRN: http://ssrn.com/abstract=1856476 or http://dx.doi.org/10.2139/ssrn.1856476</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis" class="source">
    <div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="c1"># In[1]:</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">pyPortfolioAnalysis: Methods to optimize portfolio</span>
<span class="sd">==================================================</span>

<span class="sd">Documentation is available as docstring or as HTML on https://github.com/anuragagrawaal/pyPortfolioAnalysis</span>

<span class="sd">Fucntions and Classes </span>



<span class="sd">Optimization Methods</span>
<span class="sd">====================</span>

<span class="sd"> &#39;HHI&#39;</span>
<span class="sd"> &#39;VaR&#39;</span>
<span class="sd"> &#39;VaR_portfolio&#39;</span>
<span class="sd"> &#39;add_constraint&#39;</span>
<span class="sd"> &#39;add_objective&#39;</span>
<span class="sd"> &#39;black_litterman&#39;</span>
<span class="sd"> &#39;box_constraint&#39;</span>
<span class="sd"> &#39;cVaR_portfolio&#39;</span>
<span class="sd"> &#39;constrained_objective&#39;</span>
<span class="sd"> &#39;diversification&#39;</span>
<span class="sd"> &#39;diversification_constraint&#39;</span>
<span class="sd"> &#39;equal_weight&#39;</span>
<span class="sd"> &#39;extract_groups&#39;</span>
<span class="sd"> &#39;extract_objective_measure&#39;</span>
<span class="sd"> &#39;extract_weights&#39;</span>
<span class="sd"> &#39;factor_exposure_constraint&#39;</span>
<span class="sd"> &#39;fn_map&#39;</span>
<span class="sd"> &#39;generate_sequence&#39;</span>
<span class="sd"> &#39;get_constraints&#39;</span>
<span class="sd"> &#39;group_constraint&#39;</span>
<span class="sd"> &#39;group_fail&#39;</span>
<span class="sd"> &#39;inverse_volatility_weights&#39;</span>
<span class="sd"> &#39;leverage_exposure_constraint&#39;</span>
<span class="sd"> &#39;leverage_fail&#39;</span>
<span class="sd"> &#39;max_sum_fail&#39;</span>
<span class="sd"> &#39;min_sum_fail&#39;</span>
<span class="sd"> &#39;minmax_objective&#39;</span>
<span class="sd"> &#39;normalize_weights&#39;</span>
<span class="sd"> &#39;optimize_portfolio&#39;</span>
<span class="sd"> &#39;performance_metrics_objective</span>
<span class="sd"> &#39;port_mean&#39;</span>
<span class="sd"> &#39;portfolio_risk_objective&#39;</span>
<span class="sd"> &#39;portfolio_spec&#39;</span>
<span class="sd"> &#39;pos_limit_fail&#39;</span>
<span class="sd"> &#39;position_limit_constraint&#39;</span>
<span class="sd"> &#39;return_constraint&#39;</span>
<span class="sd"> &#39;return_objective&#39;</span>
<span class="sd"> &#39;risk_budget_objective&#39;</span>
<span class="sd"> &#39;rp_decrease&#39;</span>
<span class="sd"> &#39;rp_decrease_leverage&#39;</span>
<span class="sd"> &#39;rp_increase&#39;</span>
<span class="sd"> &#39;rp_position_limit&#39;</span>
<span class="sd"> &#39;rp_transform&#39;</span>
<span class="sd"> &#39;transaction_cost_constraint&#39;</span>
<span class="sd"> &#39;turnover&#39;</span>
<span class="sd"> &#39;turnover_constraint&#39;</span>
<span class="sd"> &#39;turnover_objective&#39;</span>
<span class="sd"> &#39;var_portfolio&#39;</span>
<span class="sd"> &#39;weight_concentration_objective&#39;</span>
<span class="sd"> &#39;weight_sum_constraint&#39;</span>


<span class="sd">Plots</span>
<span class="sd">=====</span>
<span class="sd"> &#39;chart_efficient_frontier&#39;</span>
<span class="sd"> &#39;chart_group_weights&#39;</span>
<span class="sd"> &#39;chart_weights&#39;</span>




<span class="sd">References</span>
<span class="sd">----------</span>
<span class="sd">Brian G. Peterson and Peter Carl (2018). PortfolioAnalytics: Portfolio Analysis, Including Numerical Methods for Optimization of Portfolios. R package version 1.1.0. https://CRAN.R-project.org/package=PortfolioAnalytics</span>
<span class="sd">  </span>
<span class="sd">Boudt, Kris and Lu, Wanbo and Peeters, Benedict, Higher Order Comoments of Multifactor Models and Asset Allocation (June 16, 2014). Available at SSRN: http://ssrn.com/abstract=2409603 or http://dx.doi.org/10.2139/ssrn.2409603</span>

<span class="sd">Chriss, Neil A and Almgren, Robert, Portfolios from Sorts (April 27, 2005). Available at SSRN: http://ssrn.com/abstract=720041 or http://dx.doi.org/10.2139/ssrn.720041</span>

<span class="sd">Meucci, Attilio, The Black-Litterman Approach: Original Model and Extensions (August 1, 2008). Shorter version in, THE ENCYCLOPEDIA OF QUANTITATIVE FINANCE, Wiley, 2010. Avail- able at SSRN: http://ssrn.com/abstract=1117574 or http://dx.doi.org/10.2139/ssrn.1117574</span>

<span class="sd">Meucci, Attilio, Fully Flexible Views: Theory and Practice (August 8, 2008). Fully Flexible Views: Theory and Practice, Risk, Vol. 21, No. 10, pp. 97-102, October 2008. Available at SSRN: http://ssrn.com/abstract=1213325</span>

<span class="sd">Scherer, Bernd and Martin, Doug, Modern Portfolio Optimization. Springer. 2005.</span>

<span class="sd">Shaw, William Thornton, Portfolio Optimization for VAR, CVaR, Omega and Utility with General Return Distributions: A Monte Carlo Approach for Long-Only and Bounded Short Portfolios with Optional Robustness and a Simplified Approach to Covariance Matching (June 1, 2011). Available at SSRN: http://ssrn.com/abstract=1856476 or http://dx.doi.org/10.2139/ssrn.1856476</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># In[2]:</span>


<span class="k">class</span> <span class="nc">black_litterman</span><span class="p">:</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to call black_litterman object.</span>
<span class="sd">    </span>
<span class="sd">    Black-litterman formula is popular to get posterior moments of the portfolio.</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pandas.DataFrame</span>
<span class="sd">        dataframe of returns series.</span>
<span class="sd">    P : matrix-like,</span>
<span class="sd">        KXN link matrix where N is the number of assets and K are the views</span>
<span class="sd">        </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    fit(Mu = None, S = None, Views = None, tau = 1):</span>
<span class="sd">        returns a matrix of posterior returns based on Views and returns data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for all necessary attributes of class black_litterman</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pandas.DataFrame</span>
<span class="sd">        dataframe of returns series.</span>
<span class="sd">    P : matrix-like,</span>
<span class="sd">        KXN link matrix where N is the number of assets and K are the views</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Mu</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Views</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fit method of black_litterman object</span>
<span class="sd">    </span>
<span class="sd">    Main function to call in order to return the posterior mean of the portfolio given the views and return.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Mu : array-like, optional</span>
<span class="sd">        prior mean of the returns. numpy.mean is called if Mu is None</span>
<span class="sd">    S : matrix-like, optional</span>
<span class="sd">        NXN covariance matrix. numpy.cov is called if S is None</span>
<span class="sd">    Views: array-like, default = None</span>
<span class="sd">        array of K views held by investor. </span>
<span class="sd">    Tau: float, default = 1</span>
<span class="sd">        multiplying factor to be used.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array:</span>
<span class="sd">        returns an array of posterior moments of portfolio given the returns and weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    Black-litterman formula is very useful if an investor believes that a particular stock is going to rise</span>
<span class="sd">    compared to others although this information is not incorporated in the stock price. Essentially, it captures</span>
<span class="sd">    the views an investor holds for a particular asset.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">                       &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; P = np.matrix([[-1, 0, 1],[0,-1,1]])</span>
<span class="sd">    &gt;&gt;&gt; Views = np.matrix([[0.02],</span>
<span class="sd">                   [0.05]])</span>
<span class="sd">    &gt;&gt;&gt; bl = black_litterman(R = port_ret, P = P)</span>
<span class="sd">    &gt;&gt;&gt; bl.fit(Views = Views)</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
        <span class="kn">import</span> <span class="nn">random</span>
    


        <span class="k">if</span> <span class="n">Mu</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mu</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Length of Mu must equal R&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">S</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Dimensions of Sigma must equal Dimensions of R&#39;</span><span class="p">)</span>
        <span class="n">Omega</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Views</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Views</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span>
        <span class="n">tot_wgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Omega</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>
        <span class="n">wgt_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Mu</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Omega</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Views</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tot_wgt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">wgt_avg</span><span class="p">))</span>


<span class="c1"># In[3]:</span>


<span class="k">class</span> <span class="nc">portfolio_spec</span><span class="p">:</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to call portfolio_spec object.</span>
<span class="sd">    </span>
<span class="sd">    portfolio_spec object is the main class that contains all the constraints, objectives, optimal weights;</span>
<span class="sd">    it is called by many functions to get relevant attributes and store attributes.</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">        add assets to portfolio either via name of assets in the form of an array or int of number of assets.</span>
<span class="sd">    category_label: dict, optional</span>
<span class="sd">        dictionary of different categories assigned to different assets. similar to group_constraint.</span>
<span class="sd">        See group_constraint.</span>
<span class="sd">    weights_seq : sequence, optional</span>
<span class="sd">        sequence of random weights. These weights will be used to optimize weights. See generate_sequence</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or diable message</span>
<span class="sd">        </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    port_summary():</span>
<span class="sd">        returns a dictionary of the summary of constraints and objective added by add_consraint and add_objective</span>
<span class="sd">        funtions. See add_constraint, add_objective</span>
<span class="sd">    optimal_portfolio():</span>
<span class="sd">        returns a dictionary of optimal weights, objective measure and minimum value calculated by the specified solver</span>
<span class="sd">        NOTE: optimal_portfolio will only return result if optimize_portfolio is called. See optimize_portfolio</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weights_seq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for all necessary attributes of class black_litterman</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">        add assets to portfolio either via name of assets in the form of an array or int of number of assets.</span>
<span class="sd">    category_label: dict, optional</span>
<span class="sd">        dictionary of different categories assigned to different assets. similar to group_constraint.</span>
<span class="sd">        See group_constraint.</span>
<span class="sd">    weights_seq : sequence, optional</span>
<span class="sd">        sequence of random weights. These weights will be used to optimize weights. See generate_sequence</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or diable message</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>




        <span class="k">if</span> <span class="n">assets</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Please Enter Asset Names&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">assetnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asset&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">assets</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
                <span class="n">assetnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;asset&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                <span class="n">assets</span> <span class="o">=</span> <span class="n">assetnames</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">assets</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">tmp_cat_len</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)):</span>
                <span class="n">tmp_cat_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">category_labels</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">tmp_cat_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_cat_len</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tmp_cat_len</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;len(assets) must equal len(category_labels)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Category_labels must be a list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">=</span> <span class="n">category_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight_seq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">port_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    summary of the portfolio</span>
<span class="sd">    </span>
<span class="sd">    method to provide a summary of the portfolio.</span>
<span class="sd">            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict:</span>
<span class="sd">        returns a dictionary of all constraints and objective</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; p1 = portfolio_spec(assets = 3)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;factor_exposure&#39;, B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;group&#39;, groups = dict(zip([&#39;equity&#39;,&#39;debt&#39;],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;transaction&#39;, ptc = 0.2)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;return&#39;, target = 0.1, name = &#39;return_obj&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;minmax&#39;,  minimum = 0.2, maximum = 0.3,name = &#39;risk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; p1.port_summary()</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">({</span><span class="s1">&#39;Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span><span class="s1">&#39;Number of Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nassets</span><span class="p">,</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span><span class="p">,</span>
              <span class="s1">&#39;Constraints&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="s1">&#39;Objectives&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">optimal_portfolio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    summary of the portfolio</span>
<span class="sd">    </span>
<span class="sd">    method to provide a summary of the optimal weights, objective and minimum output of portfolio.</span>
<span class="sd">            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict:</span>
<span class="sd">        returns a dictionary of optimal weights, objective and minimum output of portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; p1 = portfolio_spec(assets = 3)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;factor_exposure&#39;, B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;group&#39;, groups = dict(zip([&#39;equity&#39;,&#39;debt&#39;],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;transaction&#39;, ptc = 0.2)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;return&#39;, target = 0.1, name = &#39;return_obj&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;minmax&#39;,  minimum = 0.2, maximum = 0.3,name = &#39;risk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; optimize_portfolio(R, p1, optimize_method = &#39;DEoptim&#39;)</span>
<span class="sd">    &gt;&gt;&gt; p1.optimal_weights()</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
        <span class="kn">import</span> <span class="nn">random</span>




        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Please run optimize_portfolio function before call optimzal weights&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">({</span><span class="s1">&#39;Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span><span class="s1">&#39;Number of Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nassets</span><span class="p">,</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span><span class="p">,</span>
               <span class="s1">&#39;Weights&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="s1">&#39;Objective_measures&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">objective_measures</span><span class="p">})</span>


<span class="c1"># In[4]:</span>


<span class="k">def</span> <span class="nf">add_constraint</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">            an object of class portfolio_spec. see portfolio_spec</span>
<span class="sd">    kind : str,</span>
<span class="sd">            currently supported constraint: ’weight_sum’ (also ’leverage’ or ’weight’), ’box’, ’group’,</span>
<span class="sd">           ’turnover’,’diversification’, ’position_limit’, ’return’, ’factor_exposure’,</span>
<span class="sd">            or ’leverage_exposure’.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">            any additional constraint argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    •weight_sum, weight, leverage Specify constraint on the sum of the weights, see weight_sum_constraint    </span>
<span class="sd">    •full_investment Special case to set min_sum=1 and max_sum=1 of weight sum constraints</span>
<span class="sd">    •dollar_neutral, active Special case to set min_sum=0 and max_sum=0 of weight_sum constraints</span>
<span class="sd">    •box box constraint for the individual asset weights, see box_constraint</span>
<span class="sd">    •long_only Special case to set min=0 and max=1 of box constraint</span>
<span class="sd">    •group specify the sum of weights within groups and the number of assets with non-zero weights in groups,</span>
<span class="sd">        see group_constraint</span>
<span class="sd">    •turnover Specify a constraint for target turnover. Turnover is calculated from a set of initial weights,</span>
<span class="sd">        see turnover_constraint</span>
<span class="sd">    •diversification target diversification of asset of weights, see diversification_constraint</span>
<span class="sd">    •position_limit Specify the number of non-zero,long, and/orshortpositions, see position_limit_constraint</span>
<span class="sd">    •return Specify the target mean return, see return_constraint</span>
<span class="sd">    •factor_exposure Specify risk factor exposures, see factor_exposure_constraint</span>
<span class="sd">    •leverage_exposure Specify a maximum leverage exposure, see leverage_exposure_constraint</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; portfolio = portfolio_spec(assets = 4)</span>
<span class="sd">    &gt;&gt;&gt; # adding weight_sum cinstraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;weight_sum&#39;, min_sum = 0.9, max_sum = .95)</span>
<span class="sd">    &gt;&gt;&gt; # long_only is a special kind of box constraint where minimum and maximum is positive</span>
<span class="sd">    &gt;&gt;&gt; # minimum and maximum can be list or scalars</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;box&#39;, minimum = [0.9, -0.5,-0.5, 0.1], maximum = 1)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;long_only&#39;)</span>

<span class="sd">    &gt;&gt;&gt; # group constraint is used to specify min and max weights of certain asset_groups</span>
<span class="sd">    &gt;&gt;&gt; # groups must be a dict and group_min and group_max can be scalar or list</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;group&#39;, group_min = [0.9, -0.5,-0.5, 0.1], group_max = 1,</span>
<span class="sd">                  groups = {&#39;eqity&#39;:[0,3], &#39;debt&#39;:[1,2]})</span>

<span class="sd">    &gt;&gt;&gt; # adding weight_sum constraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;weight_sum&#39;, min_sum = 0.9, max_sum = .95)</span>
<span class="sd">    &gt;&gt;&gt; # special case of weight_sum is dollar_neutral/active or full_investment</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;dollar_neutral&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;full_investment&#39;)</span>

<span class="sd">    &gt;&gt;&gt; #turnover constraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;turnover&#39;, turnover_target = 0.1)</span>

<span class="sd">    &gt;&gt;&gt; #diversification constraint for diversification target in a portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;diversification&#39;, div_target = 0.1)</span>


<span class="sd">    &gt;&gt;&gt; #position_limit is a constraint to restrict max position and also max long/short positions</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;position_limit&#39;, max_pos = 3, max_pos_long = 2, max_pos_short = 2)</span>

<span class="sd">    &gt;&gt;&gt; #return constraint to add a target mean historical return to the portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;return&#39;, return_target = 0.0018)</span>

<span class="sd">    &gt;&gt;&gt; #adds a tranaction cost constraint on portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;transaction_cost&#39;, ptc = 0.1)</span>

<span class="sd">    &gt;&gt;&gt; #constraint on the leverage of portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;leverage_exposure&#39;, leverage = 0.8)</span>

<span class="sd">    &gt;&gt;&gt; #Factor_exposure constraint is used to test portfolio with their impact on certaint factors</span>
<span class="sd">    &gt;&gt;&gt; # factors can be single or multiple with lower and upper limit. </span>
<span class="sd">    &gt;&gt;&gt; # B can be a N*K matrix for N assets and K factors.</span>
<span class="sd">    &gt;&gt;&gt; # lower and upper arguments can be float for single factor and list for multiple factors</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;factor_exposure&#39;, </span>
<span class="sd">                  B = np.matrix([[1.2,1.3],</span>
<span class="sd">                                 [2.3,1.4],</span>
<span class="sd">                                 [1.4,0.9],</span>
<span class="sd">                                 [3.4,1.2]]),</span>
<span class="sd">                   lower = [0.8,1.4], upper = [2,2.4])</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must supply kind of portfolio&#39;</span><span class="p">)</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">box_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;long_only&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">box_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">group_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;leverage&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight_sum&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;full_investment&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;dollar_neutral&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">turnover_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;diversification&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">diversification_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;position_limit&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">position_limit_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">return_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;factor_exposure&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">factor_exposure_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;transaction&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">transaction_cost_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;leverage_exposure&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">leverage_exposure_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_constraint</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_constraint</span>
    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>


<span class="c1"># In[5]:</span>


<span class="k">def</span> <span class="nf">box_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    The box constraint defines the upper and lower limits of asset weights.</span>
<span class="sd">    add_constraint calls this function when type=”box” is defined.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets :  int, or array-like,</span>
<span class="sd">              number of assets, or optionally a named list of assets specifying initial weights.</span>
<span class="sd">    minimum : float, or array-like,</span>
<span class="sd">              numeric or named list defining the minimum constraints of the weight box.</span>
<span class="sd">    maximum : float, or array-like,</span>
<span class="sd">              numeric or named list defining the maximum constraints of the weight box.</span>
<span class="sd">    kind :    str,</span>
<span class="sd">              string of kind of constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">              bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">              bool to enable or disable messages.</span>
<span class="sd">    kwargs :  additional key word arguments, optional</span>
<span class="sd">              any additional constraint argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Add box constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;box&#39;, minimum = [0.9, -0.5,-0.5, 0.1], maximum = 1)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;long_only&#39;</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(minimum) and len(maximum) must be same&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="n">nassets</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="n">nassets</span><span class="p">:</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">maximum</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[6]:</span>


<span class="k">def</span> <span class="nf">group_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">group_min</span><span class="p">,</span> <span class="n">group_max</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Group constraints determine the grouping of assets, group weights,</span>
<span class="sd">    and the number of positions of the groups (i.e. non-zero weights).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------  </span>
<span class="sd">    assets : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    groups : Dict, </span>
<span class="sd">            dictionary specifying the assets groups.</span>
<span class="sd">    group_min : float, or array-like,</span>
<span class="sd">            numeric or named list defining the minimum constraints of the weight group. </span>
<span class="sd">    group_max : float, or array-like,</span>
<span class="sd">            numeric or named list defining the maximum constraints of the weight group.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds group constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">   </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;group&#39;, group_min = [0.9, -0.5,-0.5, 0.1], </span>
<span class="sd">        group_max =1, groups = {&#39;eqity&#39;:[0,3], &#39;debt&#39;:[1,2]})</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Groups must be passed as a pandas dict&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">nassets</span> <span class="o">=</span> <span class="n">assets</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    
    <span class="n">group_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">ngroups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_min</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_min</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">group_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">group_min</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_min</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngroups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(group_min) must equal ngroups&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_max</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_max</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">group_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">group_max</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_max</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngroups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(group_max) must equal ngroups&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">group_names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">group_label</span> <span class="o">=</span> <span class="n">group_names</span>
    <span class="k">if</span> <span class="n">group_names</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">group_label</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">group_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ngroups</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">):</span>
            <span class="n">group_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_label</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngroups</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_labels must match ngroups&#39;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="s1">&#39;group_min&#39;</span><span class="p">,</span> <span class="s1">&#39;group_max&#39;</span><span class="p">,</span> <span class="s1">&#39;group_label&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">groups</span><span class="p">,</span> <span class="n">group_min</span><span class="p">,</span> <span class="n">group_max</span><span class="p">,</span> <span class="n">group_label</span><span class="p">,</span> <span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[7]:</span>


<span class="k">def</span> <span class="nf">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;weight_sum&#39;</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>


<span class="sd">    The constraint determines the sum of the weights of the upper and lower limits.</span>
<span class="sd">    This function is called add.constraint when the type is defined as &quot;weight sum&quot;, </span>
<span class="sd">    &quot;leverage&quot;, &quot;full investment&quot;, &quot;dollar neutral&quot; or &quot;active&quot;</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            character kind of the constraint.</span>
<span class="sd">    min_sum : float,</span>
<span class="sd">            Minimum sum of all weights of assets, default 0.99</span>
<span class="sd">    max_sum : float, </span>
<span class="sd">            Maximum sum of all weights of assets, default 1.01    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.  </span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds weight_sum constraint to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; # adding weight_sum constraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;weight_sum&#39;, min_sum = 0.9, max_sum = .95)</span>
<span class="sd">    &gt;&gt;&gt; # special case of weight_sum is dollar_neutral/active or full_investment</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;dollar_neutral&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;full_investment&#39;)</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;full_investment&#39;</span><span class="p">:</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;dollar_neutral&#39;</span><span class="p">:</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;min_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[8]:</span>


<span class="k">def</span> <span class="nf">turnover_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">turnover_target</span><span class="p">,</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;turnover&#39;</span><span class="p">,</span>  <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Target turnover value is determined under the turnover constraint. </span>
<span class="sd">    When type=”turnover” is stated, the function is called by add.constraint</span>
<span class="sd">   </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    asset : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    kind :  str,</span>
<span class="sd">            character kind of the constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds  turnover constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">&gt;&gt;&gt; #turnover constraint</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio, kind = &#39;turnover&#39;, turnover_target = 0.1)</span>

<span class="sd">&quot;&quot;&quot;</span> 
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;turnover_target&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">],[</span><span class="n">turnover_target</span><span class="p">,</span> <span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[9]:</span>


<span class="k">def</span> <span class="nf">diversification_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">div_target</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;diversification&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Target diversification value is specified under the diversification constraint.</span>
<span class="sd">    </span>
<span class="sd">    This function is called by add.constraint when type=”diversification” is mentioned.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    div_target : float,</span>
<span class="sd">            diversification target value</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of the kind of constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds diversification constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #diversification constraint for diversification target in a portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;diversification&#39;, div_target = 0.1)</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;diversification_target&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">div_target</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[10]:</span>


<span class="k">def</span> <span class="nf">position_limit_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span>  <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                              <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    When type=”position_limit” is mentioned, this function is called by add.constraint. </span>

<span class="sd">    The maximum number of positions as well as the maximum number of long and short positions</span>
<span class="sd">    are determined by the user using this function.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            named list of assets determining initial weights.</span>
<span class="sd">    max_pos : int,</span>
<span class="sd">            maximum number of assets with non-zero weights.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraint</span>
<span class="sd">    max_pos_long : Int, optional</span>
<span class="sd">            maximum number of assets with long positions.</span>
<span class="sd">    max_pos_short : Int, optional</span>
<span class="sd">            maximum number of assets with short positions.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds position_limit constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">&gt;&gt;&gt; #position_limit is a constraint to restrict max position and also max long/short positions</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio, kind = &#39;position_limit&#39;, max_pos = 3, max_pos_long = 2, max_pos_short = 2)</span>

<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>


    
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_pos</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;max_pos must be of type int&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos must a positive number&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos</span> <span class="o">&gt;</span> <span class="n">nassets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos must be less than or equal to number of assets&#39;</span><span class="p">)</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="n">nassets</span>
    <span class="n">max_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pos</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_pos_long</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;max_pos_long must be of type int&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_long</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_long must a positive number&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_long</span> <span class="o">&gt;</span> <span class="n">nassets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_long must be less than or equal to number of assets&#39;</span><span class="p">)</span>
        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">nassets</span>
    <span class="n">max_pos_long</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pos_long</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_pos_short</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;max_pos_short must be of type int&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_short</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_short must a positive number&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_short</span> <span class="o">&gt;</span> <span class="n">nassets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_short must be less than or equal to number of assets&#39;</span><span class="p">)</span>
        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">nassets</span>
    <span class="n">max_pos_short</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pos_short</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;max_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_long&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_short&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[11]:</span>


<span class="k">def</span> <span class="nf">return_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span>  <span class="n">return_target</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;return&#39;</span><span class="p">,</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Target mean return value is determined by the return constraint. </span>
<span class="sd">    When type=”return” is mentioned, this function is called by add_constraint.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets :. int, or array-like,</span>
<span class="sd">            named list of assets determining initial weights.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraints.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    messages : bool, default = False</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds return constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">  </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #return constraint to add a target mean historical return to the portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;return&#39;, return_target = 0.0018)</span>


<span class="sd">&quot;&quot;&quot;</span>



    
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;return_target&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">return_target</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[12]:</span>


<span class="k">def</span> <span class="nf">factor_exposure_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;factor_exposure&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a factor exposure constraint for &quot;K&quot; different factos in a portdolio and also their exposure to </span>
<span class="sd">    particular asset.</span>

<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            named list of assets specifying initial weights.</span>
<span class="sd">    B : matrix-like,</span>
<span class="sd">        matrix or list of risk factor exposures</span>
<span class="sd">    lower : int, or array-like</span>
<span class="sd">        list of lower limits of risk factor exposure constraints.</span>
<span class="sd">    upper : int, or array-like</span>
<span class="sd">        list of upper limits of risk factor exposure constraints.</span>
<span class="sd">    kind : str,</span>
<span class="sd">        string of kind of constraints.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds factor_exposure constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #Factor_exposure constraint is used to test portfolio with their impact on certaint factors</span>
<span class="sd">    &gt;&gt;&gt; # factors can be single or multiple with lower and upper limit. </span>
<span class="sd">    &gt;&gt;&gt; # B can be a N*K matrix for N assets and K factors.</span>
<span class="sd">    &gt;&gt;&gt; # lower and upper arguments can be float for single factor and list for multiple factors</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;factor_exposure&#39;, </span>
<span class="sd">                  B = np.matrix([[1.2,1.3],</span>
<span class="sd">                                 [2.3,1.4],</span>
<span class="sd">                                 [1.4,0.9],</span>
<span class="sd">                                 [3.4,1.2]]),</span>
<span class="sd">                   lower = [0.8,1.4], upper = [2,2.4])</span>

<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="c1">##Factor Exposure Constraint</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nassets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;length of B must equal nassets&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;lower must be a float&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;upper must be a float&#39;</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">B</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nassets</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapeError</span><span class="p">(</span><span class="s1">&#39;number of rows must equal nassets&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapeError</span><span class="p">(</span><span class="s1">&#39;number of columns must equal lower&#39;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[13]:</span>


<span class="k">def</span> <span class="nf">transaction_cost_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">ptc</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;transaction&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A proportional cost value is determined under the transaction cost constraint.</span>
<span class="sd">    When type=”transaction_cost” is specified, this function is called by add.constraint.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            number of assets, or optionally a named list of assets determining initial weights.</span>
<span class="sd">    ptc : float,</span>
<span class="sd">            proportional transaction cost value.  </span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraint </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds transaction _cost constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #adds a tranaction cost constraint on portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;transaction_cost&#39;, ptc = 0.1)</span>

<span class="sd">&quot;&quot;&quot;</span>

    


    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;ptc&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">ptc</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[14]:</span>


<span class="k">def</span> <span class="nf">leverage_exposure_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">leverage</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;leverage_exposure&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A maximum leverage where leverage is stated as the total of the absolute value of the weights</span>
<span class="sd">    is determined under the leverage_exposure constraint.    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            leverage : maximum leverage value</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraints    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds leverage_exposure constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #constraint on the leverage of portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;leverage_exposure&#39;, leverage = 0.8)</span>

<span class="sd">&quot;&quot;&quot;</span>


    
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;leverage&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">leverage</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>


<span class="c1"># In[15]:</span>


<span class="k">def</span> <span class="nf">diversification</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Diversification is stated as 1 minus the total of the squared weights</span>

<span class="sd">    Diversification function to compute as a constraint</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">            list of weights of assets. </span>
<span class="sd">   </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns diversification given the weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    turnover</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.5]</span>
<span class="sd">    &gt;&gt;&gt; turnover(w)</span>
<span class="sd">&quot;&quot;&quot;</span>

    
    <span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>


<span class="c1"># In[16]:</span>


<span class="k">def</span> <span class="nf">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper functionality to get the constraints allowed out of the portfolio object </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">                an object of class portfolio_spec. </span>
<span class="sd">  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns dictionary of constraints extracted from the portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(3)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;dollar_neutral&#39;)</span>
<span class="sd">    &gt;&gt;&gt; get_constraint(port)</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span>


<span class="c1"># In[17]:</span>


<span class="k">def</span> <span class="nf">add_objective</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function is the primary function of adding and updating business goals in a portfolio.spec type object.</span>
<span class="sd">    General interface, including risk, return, and risk budget, to add optimization goals.   </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">            an object of class portfolio_spec. </span>
<span class="sd">    kind : str,</span>
<span class="sd">        the character form of the goal to be added or changed, currently &#39;return&#39;,&#39; risk&#39;,</span>
<span class="sd">        ‘risk_budget&#39;,&#39; quadratic_utility’, or ‘weight_concentration’. </span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">        arguments : Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd"> </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    In general, you will define your objective as one of the following types:</span>
<span class="sd">    ’return’, ’risk’, ’risk_budget’, or ’weight_concentration’.</span>
<span class="sd">    </span>
<span class="sd">    These have special handling and intelligent defaults for dealing with the function</span>
<span class="sd">    most likely to be used as objectives, including mean, median, VaR, ES, etc.</span>
<span class="sd">    Objectives of type ’turnover’ and ’minmax’ are also supported.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;return&#39;, name = &#39;mean&#39;, target = 0.0018)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;portfolio_risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk_budget&#39;, name = &#39;risk_budget&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>


<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must specify thekind&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arguments</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You must specify arguments in a type dict&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must enter the name of the objective&#39;</span><span class="p">)</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">tmp_objective</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">return_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>  <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;portfolio_risk&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">portfolio_risk_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>  <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">risk_budget_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">turnover_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">minmax_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight_conc&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight_concentration&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">weight_concentration_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">performance_metrics_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_objective</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_objective</span>
    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>


<span class="c1"># In[18]:</span>


<span class="k">def</span> <span class="nf">return_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    We&#39;ll try minimizing the risk metric if the target is null.    </span>
<span class="sd">    Constructor for the portfolio_risk_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds return_objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;return&#39;, name = &#39;mean&#39;, target = 0.0018)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>




<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>


<span class="c1"># In[19]:</span>


<span class="k">def</span> <span class="nf">portfolio_risk_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We&#39;ll try minimizing the risk metric if the target is null.    </span>
<span class="sd">    Constructor for the portfolio_risk_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds portfolio risk objectives to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;portfolio_risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>

<span class="sd">   </span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>


<span class="c1"># In[20]:</span>


<span class="k">def</span> <span class="nf">risk_budget_objective</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">min_prisk</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_prisk</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">min_concentration</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">min_difference</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Constructor for the risk_budget_objective.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">        The asset list to be used should come from object constraints.</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances.</span>
<span class="sd">    min_prisk : float,</span>
<span class="sd">        minimum percentage risk contribution</span>
<span class="sd">    max_prisk : float,</span>
<span class="sd">        maximum percentage risk contribution</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds risk budget objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">    </span>
<span class="sd">   Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk_budget&#39;, name = &#39;risk_budget&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>




<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arguments</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;portfolio_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;component&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(min_prisk) must equal len(max_prisk)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">min_prisk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">max_prisk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">min_prisk</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_prisk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_concentration</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;min_prisk&#39;</span><span class="p">,</span> <span class="s1">&#39;max_prisk&#39;</span><span class="p">,</span> <span class="s1">&#39;min_concentration&#39;</span><span class="p">,</span> <span class="s1">&#39;min_difference&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">min_prisk</span><span class="p">,</span> <span class="n">max_prisk</span><span class="p">,</span> <span class="n">min_concentration</span><span class="p">,</span> <span class="n">min_difference</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">obj</span><span class="p">)))</span>


<span class="c1"># In[21]:</span>


<span class="k">def</span> <span class="nf">turnover_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We&#39;ll try minimizing the turnover metric if the goal is null.    </span>
<span class="sd">    Constructor for the turnover_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances.</span>
<span class="sd">    arguments : dict,</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.  </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    </span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds turnover_objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;turnover&#39;, name = &#39;turnover&#39;, target = 0.2)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>



<span class="sd">&quot;&quot;&quot;</span>


    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>


<span class="c1"># In[22]:</span>


<span class="k">def</span> <span class="nf">minmax_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This target allows to determine min and max goals.</span>
<span class="sd">    Constructor for the tmp_minmax_objective.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances.</span>
<span class="sd">    minimum : float,</span>
<span class="sd">        minimum value</span>
<span class="sd">    maximum : float,</span>
<span class="sd">        maximum value</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    arguments : dict,</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds minmax_objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    NOTE: you can add other custom function in other kind of objective in similar methd. See add_objective</span>


<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>


<span class="c1"># In[23]:</span>


<span class="k">def</span> <span class="nf">weight_concentration_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">conc_aversion</span><span class="p">,</span> <span class="n">conc_groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">    Using the HHI as a concentration scale, this feature penalizes weight concentration</span>
<span class="sd">    Constructor for objective of weight concentration.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The name of the concentration measure is currently only supported by &quot;HHI&quot;.</span>
<span class="sd">    conc_aversion : float,</span>
<span class="sd">        concentration value(s) of aversion</span>
<span class="sd">    conc_groups : dict,</span>
<span class="sd">        A dictionary defining the asset classes. Similar to &#39;group constraint&#39; groups.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds weight constraints objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">            </span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>



<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="n">conc_groups</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conc_groups</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">conc_groups</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;conc_groups must be a dictionary&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
            <span class="n">conc_aversion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">conc_groups</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">conc_groups</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(conc_aversion) must equal len(conc_groups)&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">conc_groups</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;conc_aversion must be type float when conc_groups is not defined&#39;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">,</span> <span class="s1">&#39;conc_groups&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">conc_aversion</span><span class="p">,</span> <span class="n">conc_groups</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">multiplier</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>


<span class="c1"># In[24]:</span>


<span class="k">def</span> <span class="nf">performance_metrics_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    We&#39;ll try minimizing the performance_metric if the target is null.    </span>
<span class="sd">    Constructor for the portfolio_risk_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds portfolio risk objectives to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">            </span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>


<span class="sd">&quot;&quot;&quot;</span>


    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>


<span class="c1"># In[25]:</span>


<span class="k">def</span> <span class="nf">turnover</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">wgt_init</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Turnover estimation of two weight lists.</span>
<span class="sd">    This is used as an objective function and is named when the user adds with add.objective </span>
<span class="sd">    an objective of type turnover.</span>
<span class="sd">  </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        Weights list from optimization.</span>
<span class="sd">    wgt_init : array-like, optional</span>
<span class="sd">        Initial weights list used for measuring turnover from.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the turnover of the portfolio given the weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    var_portfolio</span>
<span class="sd">    port_mean</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.4,-.4,0.5]</span>
<span class="sd">    &gt;&gt;&gt; turnover(w)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wgt_init</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wgt_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wgt_init</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The length of weights and wgt_init must be the same&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wgt_init</span><span class="o">-</span><span class="n">weights</span><span class="p">))</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>


<span class="c1"># In[26]:</span>


<span class="k">def</span> <span class="nf">var_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When var is an object for mean variance or quadratic utility optimization,</span>
<span class="sd">    this function is used to measure the portfolio variance through a call to constrained_objective.</span>
<span class="sd">    </span>
<span class="sd">    Main function to calculate portfolio variance</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        return series</span>
<span class="sd">    weights: array-like,</span>
<span class="sd">        list of weights of assets.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the variance of the portfolio given the following weights.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    \sigma_{p} = w \Sigma_{p} w^{T}</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    port_mean</span>
<span class="sd">    VaR</span>
<span class="sd">    cVaR</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # calculate the variance of portfolio</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,-0.1,0.6,0.8]</span>
<span class="sd">    &gt;&gt;&gt; var_portfolio(w,R)</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">weights</span><span class="p">))))</span>


<span class="c1"># In[27]:</span>


<span class="k">def</span> <span class="nf">HHI</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Herfindahl Hirschman Index measures the concentration of weights using this function.</span>
<span class="sd">    </span>
<span class="sd">    Concentration of weights</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        collection of weights of the portfolio.</span>
<span class="sd">    groups : dict,</span>
<span class="sd">        dictionary of groups.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the weight concentration given the weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    port_mean</span>
<span class="sd">    var_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">    cVaR</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # calculate HHI</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,-0.1,0.6,0.8]</span>
<span class="sd">    &gt;&gt;&gt; HHI(w)</span>


<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="n">groups</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">groups</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ngroups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="n">group_hhi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ngroups</span><span class="p">):</span>
            <span class="n">group_hhi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">group_hhi</span><span class="p">)</span>


<span class="c1"># In[28]:</span>


<span class="k">def</span> <span class="nf">port_mean</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        weights of the portfolio.</span>
<span class="sd">    mu : array-like,</span>
<span class="sd">        mean return of assets</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds port mean to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    \mu_{p} = w . \mu_{r}</span>


<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    var_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">    cVaR</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #calculate the portfolio mean return</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,-0.1,0.6,0.8]</span>
<span class="sd">    &gt;&gt;&gt; port_mean(w,R)</span>


<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">mu</span><span class="p">))))</span>


<span class="c1"># In[29]:</span>


<span class="k">def</span> <span class="nf">VaR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the value at risk (VaR)</span>
<span class="sd">    </span>
<span class="sd">    This function calculates the value at risk (VaR) assuming gaussian distribution</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame object,</span>
<span class="sd">        returns dataframe</span>
<span class="sd">    p : float, optional</span>
<span class="sd">        quantile estimate</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Calculates the VaR given returns</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cVaR</span>
<span class="sd">    VaR_portfolio</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; VaR(R,p = 0.01)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="n">r_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">r_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">scipy.stats</span>
    <span class="n">quantile</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">VaR</span> <span class="o">=</span> <span class="n">r_std</span><span class="o">*</span><span class="n">quantile</span>
    <span class="k">return</span><span class="p">(</span><span class="n">VaR</span><span class="p">)</span>


<span class="c1"># In[30]:</span>


<span class="k">def</span> <span class="nf">VaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate the value at risk (VaR) of a portfolio</span>
<span class="sd">    </span>
<span class="sd">    This function calculates the value at risk (VaR) assuming gaussian distribution</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w : array-like,</span>
<span class="sd">        list of weights of portfolio</span>
<span class="sd">    R : pd.DataFrame object,</span>
<span class="sd">        returns dataframe</span>
<span class="sd">    p : float, optional</span>
<span class="sd">        quantile estimate</span>
<span class="sd">    mean : bool, default = True</span>
<span class="sd">        mean VaR of portfolio</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Calculates the VaR given portfolio weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cVaR</span>
<span class="sd">    VaR_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.5]</span>
<span class="sd">    &gt;&gt;&gt; VaR_portfolio(w,R,p = 0.01)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">r_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">r_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)))</span>
    <span class="n">r_std_port</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r_cov</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span>
    <span class="kn">import</span> <span class="nn">scipy.stats</span>
    <span class="n">quantile</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">var_port</span> <span class="o">=</span> <span class="n">r_std_port</span><span class="o">*</span><span class="n">quantile</span>
    <span class="k">if</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">var_port</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">var_port</span><span class="p">)</span>


<span class="c1"># In[31]:</span>


<span class="k">def</span> <span class="nf">cVaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the conditional value at risk (cVaR) of a portfolio</span>
<span class="sd">    </span>
<span class="sd">    This function calculates the conditional value at risk (cVaR) assuming gaussian distribution</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w : array-like,</span>
<span class="sd">        list of weights of portfolio</span>
<span class="sd">    R : pd.DataFrame object,</span>
<span class="sd">        returns dataframe</span>
<span class="sd">    p : float, optional</span>
<span class="sd">        quantile estimate</span>
<span class="sd">    mean : bool, default = True</span>
<span class="sd">        mean VaR of portfolio</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Calculates the VaR given portfolio weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cVaR</span>
<span class="sd">    VaR_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.5]</span>
<span class="sd">    &gt;&gt;&gt; cVaR_portfolio(w,R,p = 0.01)</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="n">VaR_port</span> <span class="o">=</span> <span class="n">VaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">cvar_vec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">cvar_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">VaR_port</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="k">if</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cvar_vec</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">cvar_vec</span><span class="p">)</span>


<span class="c1"># In[32]:</span>


<span class="k">def</span> <span class="nf">group_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The role loops through each group and checks if the cLO or cUP for the given group has been breached.</span>
<span class="sd">    This is a rp_transform helper feature.</span>
<span class="sd">    Test if group limits have been breached.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights</span>
<span class="sd">    groups : dict,</span>
<span class="sd">        A dictionary defining the asset classes. similar in group_constraint.</span>
<span class="sd">    cLO : float, or array-like,</span>
<span class="sd">        Specifying minimum weight group constraints by numeric or vector.</span>
<span class="sd">    cUP : float, or array-like,</span>
<span class="sd">        Specifying maximum weight group constraints by numeric or vector.</span>
<span class="sd">    group_pos : array-like, optional</span>
<span class="sd">        A list that defines the number of non-zero weights for each category.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Bool returning &quot;True&quot; if group weights are breached</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">cLO</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">cUP</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;One or more arguments is incorrect&#39;</span><span class="p">)</span>
    <span class="n">group_count</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">group_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_count</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
        <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">group_fail</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">group_fail</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cLO</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cUP</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">group_pos</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">group_fail</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># In[33]:</span>


<span class="k">def</span> <span class="nf">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        list of weights to normalize based on constraints.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns array of normalized weights. Called be optimize_portfolio when optimize_method is:</span>
<span class="sd">    &#39;pso&#39;, &#39;dual_annealing&#39;, &#39;shgo&#39;, &#39;basinhopping&#39;, &#39;brute&#39;.</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
    <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>    


<span class="c1"># In[34]:</span>


<span class="k">def</span> <span class="nf">generate_sequence</span><span class="p">(</span><span class="n">minimum</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">rounding</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sequence of min&lt;-&gt;max weights for random.</span>
<span class="sd">    </span>
<span class="sd">    Creating a series of potential weights for portfolios of random or brute force.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    minimum : float,</span>
<span class="sd">        sequence minimum value   </span>
<span class="sd">    maximum : float,</span>
<span class="sd">        sequence maximum value</span>
<span class="sd">    by : float, optional</span>
<span class="sd">        number to increase the series by</span>
<span class="sd">    rounding : int, optional</span>
<span class="sd">        integer the number of decimals we can round to</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns a series of ranfom weights that satisfy the min-max weights constraint. </span>
<span class="sd">    Default weight_seq for rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">rounding</span><span class="p">),</span> <span class="n">stop</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">maximum</span><span class="p">,</span> <span class="n">rounding</span><span class="p">),</span> <span class="n">step</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>


<span class="c1"># In[35]:</span>


<span class="k">def</span> <span class="nf">pos_limit_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This is used as a rp_transform helper function to search for position limit constraints being violated.       </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test list of weights.</span>
<span class="sd">    max_pos : int, optional</span>
<span class="sd">        maximum number of non-zero-weighted assets</span>
<span class="sd">    max_pos_long : int, optional</span>
<span class="sd">        maximum number of long-position assets</span>
<span class="sd">    max_pos_short : int, optional</span>
<span class="sd">        maximum number of short-position assets</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the pos_limit constraint. called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_pos</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_pos_long</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tolerance</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_pos_short</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># In[36]:</span>


<span class="k">def</span> <span class="nf">leverage_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to test if leverage constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights.</span>
<span class="sd">    leverage : float,</span>
<span class="sd">        specify the leverage the portfolio must satisfy</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the leverage_exposure constraint. Called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    pos_limit_fail</span>
<span class="sd">      import numpy as np</span>
<span class="sd">    import pandas as pd</span>


<span class="sd">  rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="k">if</span> <span class="n">leverage</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">leverage</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># In[37]:</span>


<span class="k">def</span> <span class="nf">max_sum_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    it is used by rp_transform as a helper function to test if max_sum constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights</span>
<span class="sd">    max_sum : float, optional</span>
<span class="sd">        max_sum of the weights of portfolio</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the max_sum constraint. Called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fn_map, rp_transform</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="k">if</span> <span class="n">max_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>       


<span class="c1"># In[38]:</span>


<span class="k">def</span> <span class="nf">min_sum_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    it is used by rp_transform as a helper function to test if min_sum constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights</span>
<span class="sd">    min_sum : float, optional</span>
<span class="sd">        max_sum of the weights of portfolio</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the min_sum constraint. Called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fn_map, rp_transform</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="n">min_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>       


<span class="c1"># In[39]:</span>


<span class="k">def</span> <span class="nf">rp_decrease</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to reduce weights if </span>
<span class="sd">    max_sum or min_box constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    max_sum : float,</span>
<span class="sd">        maximum sum of weights</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the max_sum and min_box constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_sum</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_weights</span><span class="p">):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&lt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">&gt;=</span> 
        <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>


<span class="c1"># In[40]:</span>


<span class="k">def</span> <span class="nf">rp_decrease_leverage</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">leverage</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to redcrese leverage if </span>
<span class="sd">    leverage_exposure constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    max_box : array-like,</span>
<span class="sd">        maximum of individual weights in a portfolio</span>
<span class="sd">    min_box : like,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    leverage: float,</span>
<span class="sd">        leverage as specified in leverage_exposure constraints</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the leverage constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">leverage</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="n">tmp_seq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">cur_val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&gt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&lt;=</span> <span class="n">max_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="k">elif</span> <span class="n">cur_val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&lt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&gt;=</span> 
        <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>


<span class="c1"># In[41]:</span>


<span class="k">def</span> <span class="nf">rp_increase</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to increase weights if </span>
<span class="sd">    min_sum or max_box constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    max_sum : float,</span>
<span class="sd">        maximum sum of weights</span>
<span class="sd">    min_box : float,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the max_sum and min_box constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_sum</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_sum</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_weights</span><span class="p">):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="nb">any</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">&lt;=</span> 
        <span class="n">max_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>


<span class="c1"># In[42]:</span>


<span class="k">def</span> <span class="nf">rp_position_limit</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span><span class="n">min_box</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to increase weights if </span>
<span class="sd">    position_limit constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        maximum of individual weights in a portfolio</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    max_pos : int, optional</span>
<span class="sd">        maximum position to hold in a portfolio</span>
<span class="sd">    max_pos_long : int, optional</span>
<span class="sd">        maximum long position to hold in a portfolio</span>
<span class="sd">    max_pos_short : int, optional</span>
<span class="sd">        maximum short position to hold in a portfolio</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the position limit constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    rp_decrease_leverage</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_pos_long</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cur_val</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
                    <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&gt;=</span> <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
                    <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_pos_short</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cur_val</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
                    <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&lt;=</span> <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
                    <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>


<span class="c1"># In[43]:</span>


<span class="k">def</span> <span class="nf">rp_transform</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
  <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  
  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
  <span class="n">weight_seq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is mainly used to transform weights that dont satisfy the constraints such as:</span>
<span class="sd">    &quot;box&quot;</span>
<span class="sd">    &quot;group&quot;</span>
<span class="sd">    &quot;max_pos&quot;</span>
<span class="sd">    &quot;leverage_exposure&quot;</span>
<span class="sd">    See add_constraint for more deatils.</span>
<span class="sd">    </span>
<span class="sd">    Transform a list of weights to fulfill constraints</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        list of weights to be transformed</span>
<span class="sd">    min_sum : float,</span>
<span class="sd">        minimum total of all weights of assets, default of 0.99</span>
<span class="sd">    max_sum : float,</span>
<span class="sd">        maximum total of all weights of assets, default of 1.01</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        numeric or called list defining the minimum constraints of the weight box</span>
<span class="sd">    max_box : array-like</span>
<span class="sd">        numeric or called list defining the maximum constraints of the weight box</span>
<span class="sd">    groups : dict, </span>
<span class="sd">        a dictionary defining the asset groups. similar to group_constraint. see group_constraint</span>
<span class="sd">    cLO : flaot, or array-like,</span>
<span class="sd">        float or list defining the minimum constraints of the weight group</span>
<span class="sd">    cUP : float, or array-like</span>
<span class="sd">        float or list defining the minimum constraints of the weight group</span>
<span class="sd">    group_pos : array-like, optional</span>
<span class="sd">        list that specifies the maximum number of non-zero-weight assets per group</span>
<span class="sd">    max_pos : int,</span>
<span class="sd">        maximum non-zero-weight assets</span>
<span class="sd">    max_pos_long : int</span>
<span class="sd">        maximum number of long (i. e. buy) position assets</span>
<span class="sd">    max_pos_short : int,</span>
<span class="sd">        maximum number of short (i. e. sell) position assets</span>
<span class="sd">    leverage : float,</span>
<span class="sd">        maximum exposure to leverage in which leverage is defined as sum(abs(weights))</span>
<span class="sd">    weight_seq : seq, optional</span>
<span class="sd">        list of seed sequence of weights. uses generate_sequence()</span>
<span class="sd">    max_permutations : int, optional</span>
<span class="sd">        integer- maximum number of iterations to try for a portfolio which is valid, default 2000</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    weights array that satisfy the constraints on portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_decrease</span>
<span class="sd">    fn_map</span>
<span class="sd">   </span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="kn">import</span> <span class="nn">itertools</span>
    
    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">min_sum</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.01</span>
    <span class="n">max_sum</span> <span class="o">+=</span> <span class="mf">0.01</span>
    <span class="k">if</span> <span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">generate_sequence</span><span class="p">(</span><span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_box</span><span class="p">),</span> <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_box</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">)</span> <span class="c1">#GenerateSequence Function</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">group_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">weight_seq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">tolerence</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
    <span class="n">permutation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">min_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">max_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> 
    <span class="n">max_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">leverage_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">leverage</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> 
    <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> 
    <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span><span class="p">,</span> <span class="n">cUP</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">permutation</span> <span class="o">&lt;</span> <span class="n">max_permutations</span><span class="p">)):</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="n">permutation</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
        <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">max_pos</span><span class="p">)</span>
        <span class="n">full_index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">)</span>
        <span class="n">not_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">full_index</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">random_index</span><span class="p">))))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">not_index</span><span class="p">)):</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">not_index</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">min_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_increase</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> 
        <span class="n">max_box</span> <span class="o">=</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">max_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_decrease</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">leverage_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">leverage</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_decrease_leverage</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_position_limit</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">max_pos_short</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">groups</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span><span class="p">,</span> <span class="n">cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">))):</span>
                <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
                <span class="n">tmp_group_i</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
                    <span class="n">j_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">tmp_group_w</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tmp_min_box</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tmp_max_box</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">js</span> <span class="ow">in</span> <span class="n">j_idx</span><span class="p">:</span>
                        <span class="n">tmp_group_w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">[</span><span class="n">js</span><span class="p">])</span>
                        <span class="n">tmp_min_box</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_box</span><span class="p">[</span><span class="n">js</span><span class="p">])</span>
                        <span class="n">tmp_max_box</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_box</span><span class="p">[</span><span class="n">js</span><span class="p">])</span>
                    <span class="n">tmp_group_i</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_group_w</span><span class="p">,</span> 
                                        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">cLO</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">cUP</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min_box</span><span class="p">,</span> 
                                            <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max_box</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">)])</span>
                <span class="n">tmp_group_i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">tmp_group_i</span><span class="p">))</span>
                <span class="n">tmp_group_i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">tmp_group_i</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
                    <span class="n">j_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">tmp_w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_group_i</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                            <span class="c1">#group constraint</span>

    <span class="n">portfolio</span> <span class="o">=</span> <span class="n">tmp_w</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span> <span class="ow">or</span> <span class="nb">sum</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Impossible portfolio created. Try relaxing constraints&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>


<span class="c1"># In[44]:</span>


<span class="k">def</span> <span class="nf">fn_map</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">relax</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This function transforms list of weights that does not meet the portfolio constraints to an array that meets</span>
<span class="sd">    the constraints. relax argument (default = False) if True gives the function permission to transform weights </span>
<span class="sd">    if needed</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        list of initial weights.</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.</span>
<span class="sd">    relax : bool, default = False</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    verbose : bool, default = False</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the array of weights tranformed by the function and that does satisfy the constraints.</span>
<span class="sd">    called by optimize_portfolio if optimize_method = &#39;DEoptim&#39; or &#39;pso&#39;</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_investment&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>


    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">min_sum</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">max_sum</span> <span class="o">-</span> <span class="n">min_sum</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.02</span><span class="p">:</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span> <span class="o">-</span> <span class="mf">0.01</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span> <span class="o">+</span> <span class="mf">0.01</span>
   
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">generate_sequence</span><span class="p">(</span><span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minimum</span><span class="p">),</span> <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maximum</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">)</span> <span class="c1">#generateSequence function</span>
        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span>
    
    
    <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span>


    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
        <span class="n">cLO</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_min&#39;</span><span class="p">]</span>
        <span class="n">cUP</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_max&#39;</span><span class="p">]</span> <span class="c1">#add group_pos assuming None for for</span>
        <span class="n">tmp_cLO</span> <span class="o">=</span> <span class="n">cLO</span>
        <span class="n">tmp_cUP</span> <span class="o">=</span> <span class="n">cUP</span>
        <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#add group_pos assuming None for for</span>
        <span class="n">tmp_cLO</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_cUP</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span>



    <span class="n">tmp_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
    <span class="n">tmp_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span>
    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>


    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;turnover&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">turnover_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;turnover&#39;</span><span class="p">][</span><span class="s1">&#39;turnover_target&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">turnover_target</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;diversification&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">div_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;diversification&#39;</span><span class="p">][</span><span class="s1">&#39;diversification_target&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">div_target</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position_limit&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos&#39;</span><span class="p">]</span>
        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos_long&#39;</span><span class="p">]</span>
        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos_short&#39;</span><span class="p">]</span>
        <span class="n">tmp_max_pos</span> <span class="o">=</span> <span class="n">max_pos</span>
        <span class="n">tmp_max_pos_long</span> <span class="o">=</span> <span class="n">max_pos_long</span>
        <span class="n">tmp_max_pos_short</span> <span class="o">=</span> <span class="n">max_pos_short</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_max_pos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_max_pos_long</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_max_pos_short</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">leverage</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;leverage&#39;</span><span class="p">]</span>
        <span class="n">tmp_leverage</span> <span class="o">=</span> <span class="n">leverage</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">leverage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_leverage</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">min_sum</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">min_sum</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">max_sum</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                                        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
                                        <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                        <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
                                        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span><span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_min</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_max</span><span class="p">))):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                                    <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
                                    <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
                                    <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="p">((</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span> <span class="ow">or</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;</span> <span class="n">tmp_min</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&gt;</span> <span class="n">tmp_max</span><span class="p">)))</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;</span> <span class="n">tmp_min</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_min</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">tmp_weights</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;</span><span class="n">tmp_min</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                                <span class="n">tmp_min</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&gt;</span> <span class="n">tmp_max</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_max</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">tmp_weights</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="n">tmp_max</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                                <span class="n">tmp_max</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                        <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                        <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                        <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
                        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">==</span> <span class="n">weights</span><span class="p">):</span>
                    <span class="n">tmp_min</span> <span class="o">=</span> <span class="n">minimum</span>
                    <span class="n">tmp_max</span> <span class="o">=</span> <span class="n">maximum</span>

                        
    <span class="c1">#group_transform</span>
    
    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cLO</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cUP</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
            <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> 
            <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
            <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
            <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(((</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span> <span class="ow">or</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;</span> <span class="n">tmp_min</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&gt;</span> <span class="n">tmp_max</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">)))</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_cLO</span><span class="p">)):</span>
                        <span class="n">tmp_cLO</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_cUP</span><span class="p">)):</span>
                        <span class="n">tmp_cUP</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                  <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                  <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                  <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> 
                  <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                  <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                  <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">==</span> <span class="n">weights</span><span class="p">):</span>
                <span class="n">tmp_cLO</span> <span class="o">=</span> <span class="n">cLO</span>
                <span class="n">tmp_cUP</span> <span class="o">=</span> <span class="n">cUP</span>





                <span class="c1">#Max_pos Transform</span>
                

    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
                <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> 
                <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
                <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">tmp_max_pos</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nassets</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">tmp_max_pos_long</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nassets</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">tmp_max_pos_short</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nassets</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                  <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                  <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                  <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> 
                  <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
                  <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                  <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="c1">#Leverage Transform</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_leverage</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">tmp_leverage</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
            <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> 
            <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
            <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
            <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
            <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">tmp_leverage</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
                <span class="n">tmp_leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span> <span class="o">*</span><span class="mf">1.01</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                  <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                  <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                  <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> 
                  <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
                  <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                  <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>   
                
                
                
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;cLO&#39;</span><span class="p">,</span> <span class="s1">&#39;cUP&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_long&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_short&#39;</span><span class="p">,</span> <span class="s1">&#39;leverage&#39;</span><span class="p">,</span> <span class="s1">&#39;min_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sum&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">])))</span>


<span class="c1"># In[45]:</span>


<span class="k">def</span> <span class="nf">extract_weights</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array of optimal weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    extract_objective_measure</span>
<span class="sd">    extract_groups</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; extract_weights(portfolio)</span>
<span class="sd">    NOTE: extract_weights will only work after calling optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Portfolio_spec object does not have any weights. Please run optimize_portfolio before extracting weights&#39;</span><span class="p">)</span>


<span class="c1"># In[46]:</span>


<span class="k">def</span> <span class="nf">extract_objective_measure</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract objective measures of optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of objective measures as specified in the portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    extract_weights</span>
<span class="sd">    extract_objective_measure</span>
<span class="sd">    extract_groups</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; extract_objective_measure(R, portfolio)</span>
<span class="sd">    NOTE: extract_objective_measure will only work after calling optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Please specify portfoio weights in portfolio_spec_object.&#39;</span><span class="p">)</span>
    <span class="n">tmp_objective_measure</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_objective_measure</span><span class="p">)</span>


<span class="c1"># In[47]:</span>


<span class="k">def</span> <span class="nf">extract_groups</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract groups from portfolio_spec object.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of groups if group_constraint is specified.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    extract_weights</span>
<span class="sd">    extract_objective_measure</span>
<span class="sd">    extract_groups</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; extract_groups(portfolio)</span>
<span class="sd">    NOTE: extract_groups will only work after calling optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
        <span class="n">group_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">group_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">group_vals</span><span class="p">)):</span>
            <span class="n">group_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">group_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">category</span><span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">category_labels</span>
        <span class="n">category_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">ncategory</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
        <span class="n">category_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">category_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_vals</span><span class="p">)):</span>
            <span class="n">category_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">category_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="n">tmp_group_w</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([{</span><span class="s1">&#39;groups&#39;</span><span class="p">:</span><span class="n">groups</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;group_weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">group_weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="n">category_labels</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;category_weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">category_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">category_weights</span><span class="p">))}])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_group_w</span><span class="p">)</span>   


<span class="c1"># In[48]:</span>


<span class="k">def</span> <span class="nf">constrained_objective</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">penalty</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w : array-like,</span>
<span class="sd">        weights to test</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    trace : bool, default = False</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    normalize : bool, default = False</span>
<span class="sd">        bool to specify if weights should be normalized first. see normalize_weights.</span>
<span class="sd">    verbose : bool, default = False</span>
<span class="sd">        bool to enable or disable verbose argument.</span>
<span class="sd">    penalty : int, optional</span>
<span class="sd">        int value specifying he penalty if constraint or objective is breached.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns a float of total penalty given a weight. if trace = True, additional objective measure will be returned</span>
<span class="sd">    in the form of dictionary.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_transform</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    constrained_objective is the main function that is called by </span>
<span class="sd">    optimize_weights to optimze the constraint and objectives provided by the portfolio.</span>
<span class="sd">    </span>
<span class="sd">    Loosely speaking, constrained_objective is very similar to an information criteria.</span>

<span class="sd">&quot;&quot;&quot;</span>    
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">penalty</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="n">penalty</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">optimize_method</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">init_weights</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">verbosoe</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The len of portfolio assets is not equal to the weights list&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_investment&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="c1">#add normalize function (skipped for now)</span>

        <span class="k">if</span> <span class="n">normalize</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">fn_map</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>

    <span class="c1">#add normalize function (skipped for now)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">-</span><span class="n">max_sum</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="p">(</span><span class="n">min_sum</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>



        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">maximum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maximum</span><span class="p">)):</span>
                <span class="n">tmp_val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">maximum</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">tmp_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">maximum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_val</span><span class="p">)</span> <span class="o">*</span> <span class="n">penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minimum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimum</span><span class="p">)):</span>
                <span class="n">tmp_val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">minimum</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">tmp_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_val</span><span class="p">)</span> <span class="o">*</span> <span class="n">penalty</span>


        <span class="c1">#Group Constraint Penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
            <span class="n">cLO</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_min&#39;</span><span class="p">]</span>
            <span class="n">cUP</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_max&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">cUP</span><span class="p">)):</span>
                <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
                    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cLO</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="p">(</span><span class="n">cLO</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cUP</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">-</span> <span class="n">cUP</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position_limit&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">max_pos</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos&#39;</span><span class="p">]</span>
            <span class="n">tolerence</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">nzassets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tolerence</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nzassets</span> <span class="o">&gt;</span> <span class="n">max_pos</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="n">nzassets</span> <span class="o">-</span> <span class="n">max_pos</span><span class="p">)</span>    
            <span class="c1">#diversification Constraint Penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;diversification&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">div_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;diversification&#39;</span><span class="p">][</span><span class="s1">&#39;diversification_target&#39;</span><span class="p">]</span>
            <span class="n">div</span> <span class="o">=</span> <span class="n">diversification</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">div</span> <span class="o">&lt;</span> <span class="n">div_target</span> <span class="o">*</span> <span class="mf">0.95</span> <span class="ow">or</span> <span class="n">div</span> <span class="o">&gt;</span> <span class="n">div_target</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">div</span> <span class="o">-</span> <span class="n">div_target</span><span class="p">)</span>

        <span class="c1">#Turnover Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;turnover&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">turnover_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;turnover&#39;</span><span class="p">][</span><span class="s1">&#39;turnover_target&#39;</span><span class="p">]</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">turnover</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">to</span> <span class="o">&lt;</span> <span class="n">turnover_target</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">to</span> <span class="o">&gt;</span> <span class="n">turnover_target</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">to</span> <span class="o">-</span> <span class="n">turnover_target</span><span class="p">)</span>


        <span class="c1">#Return Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">return_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;return&#39;</span><span class="p">][</span><span class="s1">&#39;return_target&#39;</span><span class="p">]</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">port_ret</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">mean_return</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mean_return</span> <span class="o">-</span> <span class="n">return_target</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>


        <span class="c1">#Factor Exposure Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">t_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;B&#39;</span><span class="p">])</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;lower&#39;</span><span class="p">]</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;upper&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;lower&#39;</span><span class="p">]]</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;upper&#39;</span><span class="p">]]</span>

            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t_B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">tmp_exp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t_B</span><span class="p">[</span><span class="n">i</span><span class="p">][:])))</span>
                <span class="k">if</span> <span class="n">tmp_exp</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp_exp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tmp_exp</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmp_exp</span> <span class="o">-</span> <span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


        <span class="c1">#Transaction Cost Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transaction&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)))</span><span class="o">*</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">][</span><span class="s1">&#39;ptc&#39;</span><span class="p">])</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">mult</span> <span class="o">*</span> <span class="n">tc</span>

        <span class="c1">#Leverage Constraint Penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage_exposure&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;leverage&#39;</span><span class="p">]:</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">100</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span> <span class="o">-</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;leverage&#39;</span><span class="p">]))</span>




      
    
    <span class="c1">#assuming verbose = False for now...</span>
    
    <span class="c1">#Objectives Penalty Functions</span>
    <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>

    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="ow">or</span> <span class="n">out</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">out</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Na or NaN produced from constraints/objective&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">storage</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tmp_ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">tmp_measure</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>
                    
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span> <span class="ow">or</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;portfolio_risk&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span> <span class="ow">or</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;stdev&#39;</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)))))</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VaR&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">VaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="c1"># add Value at risk function. Skipped for now</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cVaR&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">cVaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="c1"># add cVaR function. Skipped for now</span>
                    
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>
                   
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
                <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">turnover</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;weight_concentration&#39;</span><span class="p">:</span>
                <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">HHI</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;weight_concentration&#39;</span><span class="p">][</span><span class="s1">&#39;conc_groups&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk_budget&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk_budget&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">cVaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
                <span class="c1">#Custom function support</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c1">#Update modified sharpe and complex metrics</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sharpe&#39;</span><span class="p">:</span>
                    <span class="n">sd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)))))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                    <span class="n">r_premium</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span><span class="o">-</span><span class="n">rf</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">sd</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;treynor&#39;</span><span class="p">:</span>
                    <span class="n">tmp_beta</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">tmp_beta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">Rb</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Rb</span><span class="p">))</span>
                    <span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">tmp_beta</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">))))</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span> 
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                    <span class="n">r_premium</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rf</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">beta</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;starr&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">starr_ratio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">rf</span> <span class="o">=</span> <span class="n">rf</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1">#use getattr in future</span>
        
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_measure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;portfolio_risk&#39;</span> <span class="ow">or</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;weight_concentration&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_groups&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmp_measure</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_groups&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
 
                    <span class="c1">#Risk Budget</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
        
        <span class="c1">#end of objective penalty</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_ret</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">objective</span><span class="p">,</span> <span class="n">tmp_measure</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_ret</span> <span class="o">=</span> <span class="n">tmp_ret</span>

                
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;weights : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;out : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;objective_measures : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmp_ret</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">storage</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span><span class="p">({</span><span class="s1">&#39;out&#39;</span><span class="p">:</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">tmp_ret</span><span class="p">,</span> <span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="n">w</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">storage</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>


<span class="c1"># In[49]:</span>


<span class="k">def</span> <span class="nf">chart_weights</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to plot weights of optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.lines.Line2D</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    chart_group_weights</span>
<span class="sd">    chart_efficient_frontier</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; chart_weights(portfolio)</span>
<span class="sd">    NOTE: chart_group_weights will only work after call optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;One of the requirement if missing&#39;</span><span class="p">)</span>
    
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;r&gt;&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">maximum</span><span class="p">,</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Weights&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nassets</span><span class="p">)),</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">assets</span><span class="p">)</span>


<span class="c1"># In[50]:</span>


<span class="k">def</span> <span class="nf">chart_group_weights</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to plot individual group weights of optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.lines.Line2D</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    chart_group_weights</span>
<span class="sd">    chart_efficient_frontier</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; chart_group_weights(portfolio)</span>
<span class="sd">    NOTE: chart_group_weights will only work after call optimize_portfolio on portfolio_spec</span>
<span class="sd">&quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="n">group_min</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_min&#39;</span><span class="p">]</span>
    <span class="n">group_max</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_max&#39;</span><span class="p">]</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
    <span class="n">group_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">group_weights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">group_vals</span><span class="p">)):</span>
        <span class="n">group_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">group_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_weights</span><span class="p">,</span> <span class="s1">&#39;^b&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_min</span><span class="p">,</span> <span class="s1">&#39;*r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_max</span><span class="p">,</span> <span class="s1">&#39;*r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))),</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># In[51]:</span>


<span class="k">def</span> <span class="nf">chart_efficient_frontier</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;Sharpe Ratio&#39;</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rf&#39;</span><span class="p">:</span><span class="mf">0.00</span><span class="p">},</span> <span class="n">cml</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">rand_pf</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="s1">&#39;DEoptim&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to plot efficient frontier of portfolio.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.</span>
<span class="sd">    R : pandas dataframe,</span>
<span class="sd">        dataframe of the returns series</span>
<span class="sd">    metric: str, default = &#39;Sharpe Ratio&#39;</span>
<span class="sd">        metric should be either of &#39;Sharpe Ratio&#39; or &#39;Treynor Ratio&#39;</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        additional arguments such as risk-free rate in the form of a dictionary.</span>
<span class="sd">    cml : bool, default = False</span>
<span class="sd">        bool to enable or disable capital market line</span>
<span class="sd">    rand_pf : int, optional</span>
<span class="sd">        random portfolio to plot to show the efficient frontier</span>
<span class="sd">    optimize_method : str, optional</span>
<span class="sd">        optimize_method should be similar to those in optimize_portfolio. see optimize_portfolio</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        transparency</span>
<span class="sd">    figsize : tuple, optional</span>
<span class="sd">        figure size in the form of a tuple</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.scatter</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    chart_group_weights</span>
<span class="sd">    chart_weights</span>
<span class="sd">    chart_efficient_frontier</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Rb is S&amp;P500 benchmark for capital market line and beta for treynor ratio</span>
<span class="sd">    &gt;&gt;&gt; chart_efficient_froniter(portfolio, R, metric = &#39;Treynor Ratio&#39;, </span>
<span class="sd">        arguments = {&#39;rf&#39;: 0.0008, &#39;Rb&#39;:Rb}, cml = True, alpha = 0.1, rand_pf = 1000, optimize_method = &#39;pso&#39;)</span>
<span class="sd">&quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>

    <span class="n">NP</span> <span class="o">=</span> <span class="n">rand_pf</span>
    <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
        <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
            <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

    <span class="n">ef_weights</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">ef_mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)</span>
    <span class="n">ef_sd</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
        <span class="n">ef_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">port_mean</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mu</span><span class="p">))</span>
        <span class="n">ef_sd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">ef_weights</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">opt_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">opt_w</span> <span class="o">=</span> <span class="n">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize_method</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">opt_w</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">opt_w</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    
    
    <span class="n">mu</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>

    <span class="n">opt_ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">port_mean</span><span class="p">(</span><span class="n">opt_w</span><span class="p">,</span> <span class="n">mu</span><span class="p">)]</span>
    <span class="n">opt_sd</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">opt_w</span><span class="p">))]</span>

    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Sharpe Ratio&#39;</span><span class="p">:</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">ef_sd</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">r_premium</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ef_mean</span><span class="p">)</span><span class="o">-</span><span class="n">rf</span>
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">sd</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Treynor Ratio&#39;</span><span class="p">:</span>
        <span class="n">tmp_beta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Rb</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;Rb&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">tmp_beta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">Rb</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Rb</span><span class="p">))</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">tmp_beta</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">r_premium</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ef_mean</span><span class="p">)</span><span class="o">-</span><span class="n">rf</span>
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">beta</span>
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">tmp_measure</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Sharpe Ratio&#39;</span> <span class="ow">or</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Treynor Ratio&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;metric must be either &quot;Sharpe Ratio&quot;, or &quot;Treynor Ratio&quot;&#39;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">ef_sd</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ef_mean</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">tmp_measure</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">opt_sd</span><span class="p">,</span> <span class="n">opt_ret</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">opt_sd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_ret</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Optimal&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">cml</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rb&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">Rb</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;Rb&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please add benchmark index in arguments&#39;</span><span class="p">)</span>
        <span class="n">tmp_beta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Rb</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;Rb&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">tmp_beta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">Rb</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Rb</span><span class="p">))</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">tmp_beta</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">opt_w</span><span class="p">))))</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ef_mean</span><span class="p">))</span>
        <span class="n">Ra</span> <span class="o">=</span> <span class="n">rf</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">Ra</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">cml</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="kc">None</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Efficient Frontier&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Expected Volatility (Std. Dev)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Expeected Returns&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">metric</span><span class="p">)</span>


<span class="c1"># In[52]:</span>


<span class="k">def</span> <span class="nf">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">objectives</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                       <span class="n">optimize_method</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pso&#39;</span><span class="p">,</span> <span class="s1">&#39;DEoptim&#39;</span><span class="p">,</span> <span class="s1">&#39;dual_annealing&#39;</span><span class="p">,</span> <span class="s1">&#39;brute&#39;</span><span class="p">,</span> <span class="s1">&#39;shgo&#39;</span><span class="p">,</span><span class="s1">&#39;basinhopping&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">],</span> 
                       <span class="n">search_size</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is calls the portfolio to optimize the weights given the constrained and objectives of portfolio</span>
<span class="sd">    provided using add_constraint and add_objective functions.</span>
<span class="sd">    </span>
<span class="sd">    Main function to optimize portfolio weights given the constraints and objectives</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pandas dataframe,</span>
<span class="sd">        dataframe of the series of returns</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec. </span>
<span class="sd">    constraints : dict, optional</span>
<span class="sd">        constraints to be minimized/maximized given the assets. </span>
<span class="sd">        Although they are automatically called if portfolio_spec object has constraints specified</span>
<span class="sd">    objectives : dict, optional</span>
<span class="sd">        objectives to be minimized/maximized given the assets. </span>
<span class="sd">        Although they are automatically called if portfolio_spec object has objectives specified</span>
<span class="sd">    optimize_method : float,</span>
<span class="sd">        the method for optimizing portfolio. currently supported methods are:</span>
<span class="sd">        &#39;pso&#39;</span>
<span class="sd">        &#39;DEoptim&#39;</span>
<span class="sd">        &#39;dual_annealing&#39;</span>
<span class="sd">        &#39;brute&#39;</span>
<span class="sd">        &#39;shgo&#39;</span>
<span class="sd">        &#39;basinhopping&#39;</span>
<span class="sd">        </span>
<span class="sd">        User can also specify &#39;best&#39; as optimize_method to use all optimizer and choose the best among them.</span>
<span class="sd">    search_size: int, optional</span>
<span class="sd">        specify th iterations to do before calling the best portfolio    </span>
<span class="sd">    trace : bool, default = False</span>
<span class="sd">        bool to enable or disable trace of portfolio.</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>
<span class="sd"> </span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the optimal weights, objective measure, value of the best optimization (out). automatically adds weights</span>
<span class="sd">    to the portfolio_spec objects.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    add_constraint</span>
<span class="sd">    add_objective</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    currently suuported optimization methods are:</span>
<span class="sd">        &#39;pso&#39;</span>
<span class="sd">        &#39;DEoptim&#39;</span>
<span class="sd">        &#39;dual_annealing&#39;</span>
<span class="sd">        &#39;brute&#39;</span>
<span class="sd">        &#39;shgo&#39;</span>
<span class="sd">        &#39;basinhopping&#39;</span>
<span class="sd">        </span>
<span class="sd">    The function calls constrained_objective to minimize the penalty (default = 10000) to come to a solution.</span>
<span class="sd">    the purpose of adding different optimization method is to give flexibility to user to choose optimizer based on</span>
<span class="sd">    specific problem.</span>
<span class="sd">    </span>
<span class="sd">    Additional arguments can be specified such as maxiter, disp and other controls. the argument names are similar in</span>
<span class="sd">    scipy.optimize.[optimizer] or pyswarms. see scipy and pyswarm documentation.</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;return&#39;, name = &#39;mean&#39;, target = 0.0018)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;portfolio_risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk_budget&#39;, name = &#39;risk_budget&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>

<span class="sd">    &gt;&gt;&gt; optimize_portfolio(R, port, optimize_method  = &#39;DEoptim&#39;, disp = False, search_size = 30000)</span>
<span class="sd">    NOTE: Yout can provide addional adguments based on solver. See the solver documentation for more information.</span>
<span class="sd">    &gt;&gt;&gt; # we have used scipy.optimize for most of the solver and pyswarms for &#39;pso&#39; method.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; optimize_portfolio(R, port, optimize_method  = &#39;best&#39;, disp = False, maxiter = 1000)</span>
<span class="sd">    NOTE: &#39;best&#39; optimize_method takes a while to give ouput because it uses all other optimizers.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">n_porf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
        <span class="n">out_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_porf</span>
        <span class="n">portfolio_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;portfolio&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_porf</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_porf</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting optimization of: portfolio </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">out_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">constraints</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">,</span> 
                                            <span class="n">objectives</span> <span class="o">=</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize_method</span><span class="p">,</span> 
                                        <span class="n">search_size</span> <span class="o">=</span> <span class="n">search_size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">portfolio_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;portfolio&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">portfolio_name</span><span class="p">,</span> <span class="n">out_list</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize_method</span>
    <span class="n">tmpt_trace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">portfolio</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must specify a portfolio&#39;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">&gt;</span><span class="n">N</span><span class="p">:</span>
        <span class="n">R</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
    
    
    <span class="c1">#Extra (test required)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">constraints</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="n">objectives</span>
        
        
        
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
                    <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                    <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
        <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;DEoptim&#39;</span><span class="p">:</span>
        <span class="c1">#customize later !!!! add parallel support</span>
        
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strategy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;strategy&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="s1">&#39;currenttobest1bin&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxiter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workers&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>
        
        
        <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        <span class="n">NP</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">search_size</span><span class="o">/</span><span class="n">maxiter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NP</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">NP</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="n">NP</span> <span class="o">=</span> <span class="mi">2000</span>
        <span class="k">if</span> <span class="n">maxiter</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">popsize</span> <span class="o">=</span> <span class="n">NP</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>


        <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
                <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn_map</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">differential_evolution</span><span class="p">,</span> <span class="n">Bounds</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">Bounds</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">differential_evolution</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">popsize</span> <span class="o">=</span> <span class="n">NP</span><span class="p">,</span>
                                        <span class="n">init</span> <span class="o">=</span> <span class="n">init</span><span class="p">,</span> <span class="n">maxiter</span> <span class="o">=</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">workers</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>
       
        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>
                        
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;pso&#39;</span><span class="p">:</span>
        
        <span class="c1">#inputs Update customizations of *args</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_particles&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_particles&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;options argument must be a dictionary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_processes&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_processes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="kc">None</span>
        
        
        
        
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            
            
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
        
        
        
        
        <span class="c1">#Test of init</span>
        <span class="n">NP</span> <span class="o">=</span> <span class="n">n_particles</span>
        <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
                <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn_map</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
            
        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="c1">#Process</span>
        
        <span class="kn">from</span> <span class="nn">pyswarms.single.global_best</span> <span class="kn">import</span> <span class="n">GlobalBestPSO</span>
        
        
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">GlobalBestPSO</span><span class="p">(</span><span class="n">n_particles</span><span class="o">=</span><span class="n">n_particles</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                 <span class="n">init_pos</span> <span class="o">=</span> <span class="n">init</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="p">[</span><span class="n">constrained_objective</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_particles</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>


        <span class="c1">#Runn</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">iters</span> <span class="o">=</span> <span class="n">iters</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">=</span> <span class="n">n_processes</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">best</span> <span class="o">=</span> <span class="n">minw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">weights</span><span class="o">=</span> <span class="n">minw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">best</span><span class="p">}]</span>         
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;dual_annealing&#39;</span><span class="p">:</span>
        
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxiter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="mi">5230</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;visit&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;visit&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="mf">2.62</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;accept&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="kc">False</span>
        
        
        
        
        <span class="n">NP</span> <span class="o">=</span> <span class="n">maxiter</span>
        
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>


        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">dual_annealing</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>

        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">dual_annealing</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> 
                                            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">initial_temp</span> <span class="o">=</span> <span class="n">initial_temp</span><span class="p">,</span> 
                                 <span class="n">visit</span> <span class="o">=</span> <span class="n">visit</span><span class="p">,</span> <span class="n">accept</span> <span class="o">=</span> <span class="n">accept</span><span class="p">,</span> <span class="n">no_local_search</span> <span class="o">=</span> <span class="n">no_local_search</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>



        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>
            
            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>
            
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            
            
      <span class="c1">#Brute      </span>
            
            
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;brute&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ns&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ns&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workers&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>



        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>




        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">brute</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">brute</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> 
                <span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span> <span class="n">workers</span><span class="p">,</span> <span class="n">full_output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="p">[</span><span class="mi">1</span><span class="p">]}]</span>

            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;shgo&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="s1">&#39;simplicial&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;options argument must be a dictionary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sobol&#39;</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>





        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>




        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">shgo</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">shgo</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> 
                <span class="n">iters</span> <span class="o">=</span> <span class="n">iters_shgo</span><span class="p">,</span> <span class="n">sampling_method</span> <span class="o">=</span> <span class="n">sampling_method</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>

            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;basinhopping&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;niter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>

        <span class="n">NP</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>



        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
                <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn_map</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">basinhopping</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="p">[</span><span class="n">constrained_objective</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_particles</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>




        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">basinhopping</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">x0</span> <span class="o">=</span> <span class="n">init</span><span class="p">,</span> <span class="n">niter</span> <span class="o">=</span> <span class="n">niter</span><span class="p">,</span> <span class="n">minimizer_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;args&#39;</span><span class="p">:</span><span class="n">arguments</span><span class="p">},</span>
                                        <span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>

            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    
        
        

    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;best&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strategy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;strategy&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="s1">&#39;currenttobest1bin&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxiter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workers&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="c1">#inputs Update customizations of *args</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_particles&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_particles&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="mi">100</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_processes&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_processes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="kc">None</span>

      
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="mi">5230</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;visit&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;visit&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="mf">2.62</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;accept&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ns&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ns&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="mi">5</span>
       
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="s1">&#39;simplicial&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;options argument must be a dictionary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sobol&#39;</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;niter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>



        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This may take a will as it will optimize weights sequentially across all optimizers&#39;</span><span class="p">)</span>
        
        <span class="n">optimizer</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DEoptim&#39;</span><span class="p">,</span> <span class="s1">&#39;pso&#39;</span><span class="p">,</span> <span class="s1">&#39;dual_annealing&#39;</span><span class="p">,</span> <span class="s1">&#39;brute&#39;</span><span class="p">,</span> <span class="s1">&#39;shgo&#39;</span><span class="p">,</span> <span class="s1">&#39;basinhopping&#39;</span><span class="p">]</span>
        <span class="n">tmp_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">optimize</span> <span class="ow">in</span> <span class="n">optimizer</span><span class="p">:</span>
            <span class="n">tmp_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">best_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)):</span>
            <span class="n">best_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tmp_out</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">best_vals</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>
            
            
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or check data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best optimizer was: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">best_vals</span><span class="p">))]))</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> 
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objecitve_measures</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>


<span class="c1"># In[53]:</span>


<span class="k">def</span> <span class="nf">equal_weight</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfoio</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract objective measures of equal weight portfolio.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of objective measures of equal weighted portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    inverse_volatility_weights </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; equal_weight(R, portfolio)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">nassets</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nassets</span> <span class="o">!=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;assets should be of same length as columns in R&#39;</span><span class="p">)</span>
    <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>


<span class="c1"># In[54]:</span>


<span class="k">def</span> <span class="nf">inverse_volatility_weights</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfoio</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to calculate objective_measure of inverse volatility portfolio</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of objective measures of inverse volatility portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    equal_weight</span>
<span class="sd">    inverse_volatility_weight </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; inverse_volatility_weight(R, portfolio)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">R</span><span class="p">))</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">R</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">nassets</span> <span class="o">!=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;assets should be of same length as columns in R&#39;</span><span class="p">)</span>
    <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.HHI">
    <p>def <span class="ident">HHI</span>(</p><p>weights, groups=None)</p>
    </div>
    

    
  
    <div class="desc"><p>The Herfindahl Hirschman Index measures the concentration of weights using this function.</p>
<p>Concentration of weights</p>
<h2>Parameters</h2>
<p>weights : array-like,
    collection of weights of the portfolio.
groups : dict,
    dictionary of groups.  </p>
<h2>Returns</h2>
<p>returns the weight concentration given the weights</p>
<h2>See Also</h2>
<p>port_mean
var_portfolio
VaR
cVaR</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>calculate HHI</h1>
<p>w = [0.2,0.3,-0.1,0.6,0.8]
HHI(w)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.HHI', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.HHI" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">HHI</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Herfindahl Hirschman Index measures the concentration of weights using this function.</span>
<span class="sd">    </span>
<span class="sd">    Concentration of weights</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        collection of weights of the portfolio.</span>
<span class="sd">    groups : dict,</span>
<span class="sd">        dictionary of groups.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the weight concentration given the weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    port_mean</span>
<span class="sd">    var_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">    cVaR</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # calculate HHI</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,-0.1,0.6,0.8]</span>
<span class="sd">    &gt;&gt;&gt; HHI(w)</span>


<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="n">groups</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">groups</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ngroups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="n">group_hhi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ngroups</span><span class="p">):</span>
            <span class="n">group_hhi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">group_hhi</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.VaR">
    <p>def <span class="ident">VaR</span>(</p><p>R, p=0.05)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate the value at risk (VaR)</p>
<p>This function calculates the value at risk (VaR) assuming gaussian distribution</p>
<h2>Parameters</h2>
<p>R : pd.DataFrame object,
    returns dataframe
p : float, optional
    quantile estimate</p>
<h2>Returns</h2>
<p>Calculates the VaR given returns</p>
<h2>See Also</h2>
<p>cVaR
VaR_portfolio</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>VaR(R,p = 0.01)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.VaR', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.VaR" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">VaR</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the value at risk (VaR)</span>
<span class="sd">    </span>
<span class="sd">    This function calculates the value at risk (VaR) assuming gaussian distribution</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame object,</span>
<span class="sd">        returns dataframe</span>
<span class="sd">    p : float, optional</span>
<span class="sd">        quantile estimate</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Calculates the VaR given returns</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cVaR</span>
<span class="sd">    VaR_portfolio</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; VaR(R,p = 0.01)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="n">r_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">r_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">scipy.stats</span>
    <span class="n">quantile</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">VaR</span> <span class="o">=</span> <span class="n">r_std</span><span class="o">*</span><span class="n">quantile</span>
    <span class="k">return</span><span class="p">(</span><span class="n">VaR</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.VaR_portfolio">
    <p>def <span class="ident">VaR_portfolio</span>(</p><p>w, R, p=0.05, mean=True)</p>
    </div>
    

    
  
    <div class="desc"><p>calculate the value at risk (VaR) of a portfolio</p>
<p>This function calculates the value at risk (VaR) assuming gaussian distribution</p>
<h2>Parameters</h2>
<p>w : array-like,
    list of weights of portfolio
R : pd.DataFrame object,
    returns dataframe
p : float, optional
    quantile estimate
mean : bool, default = True
    mean VaR of portfolio</p>
<h2>Returns</h2>
<p>Calculates the VaR given portfolio weights</p>
<h2>See Also</h2>
<p>cVaR
VaR_portfolio
VaR</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>w = [0.2,0.3,0.5]
VaR_portfolio(w,R,p = 0.01)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.VaR_portfolio', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.VaR_portfolio" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">VaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate the value at risk (VaR) of a portfolio</span>
<span class="sd">    </span>
<span class="sd">    This function calculates the value at risk (VaR) assuming gaussian distribution</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w : array-like,</span>
<span class="sd">        list of weights of portfolio</span>
<span class="sd">    R : pd.DataFrame object,</span>
<span class="sd">        returns dataframe</span>
<span class="sd">    p : float, optional</span>
<span class="sd">        quantile estimate</span>
<span class="sd">    mean : bool, default = True</span>
<span class="sd">        mean VaR of portfolio</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Calculates the VaR given portfolio weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cVaR</span>
<span class="sd">    VaR_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.5]</span>
<span class="sd">    &gt;&gt;&gt; VaR_portfolio(w,R,p = 0.01)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">r_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">r_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)))</span>
    <span class="n">r_std_port</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r_cov</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span>
    <span class="kn">import</span> <span class="nn">scipy.stats</span>
    <span class="n">quantile</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">var_port</span> <span class="o">=</span> <span class="n">r_std_port</span><span class="o">*</span><span class="n">quantile</span>
    <span class="k">if</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">var_port</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">var_port</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.add_constraint">
    <p>def <span class="ident">add_constraint</span>(</p><p>portfolio, kind, enabled=True, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Add a constraint in portfolio_spec object</p>
<p>Main function to add or update constraint in portfolio_spec object</p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
        an object of class portfolio_spec. see portfolio_spec
kind : str,
        currently supported constraint: ’weight_sum’ (also ’leverage’ or ’weight’), ’box’, ’group’,
       ’turnover’,’diversification’, ’position_limit’, ’return’, ’factor_exposure’,
        or ’leverage_exposure’.  <br />
enabled : bool, default = True
        bool to enable or disable constraints.
kwargs : additional key word arguments, optional
        any additional constraint argument to be passed.</p>
<h2>Returns</h2>
<p>Adds constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Notes</h2>
<p>•weight_sum, weight, leverage Specify constraint on the sum of the weights, see weight_sum_constraint  <br />
•full_investment Special case to set min_sum=1 and max_sum=1 of weight sum constraints
•dollar_neutral, active Special case to set min_sum=0 and max_sum=0 of weight_sum constraints
•box box constraint for the individual asset weights, see box_constraint
•long_only Special case to set min=0 and max=1 of box constraint
•group specify the sum of weights within groups and the number of assets with non-zero weights in groups,
    see group_constraint
•turnover Specify a constraint for target turnover. Turnover is calculated from a set of initial weights,
    see turnover_constraint
•diversification target diversification of asset of weights, see diversification_constraint
•position_limit Specify the number of non-zero,long, and/orshortpositions, see position_limit_constraint
•return Specify the target mean return, see return_constraint
•factor_exposure Specify risk factor exposures, see factor_exposure_constraint
•leverage_exposure Specify a maximum leverage exposure, see leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>portfolio = portfolio_spec(assets = 4)</p>
<h1>adding weight_sum cinstraint</h1>
<p>add_constraint(portfolio, kind = 'weight_sum', min_sum = 0.9, max_sum = .95)</p>
<h1>long_only is a special kind of box constraint where minimum and maximum is positive</h1>
<h1>minimum and maximum can be list or scalars</h1>
<p>add_constraint(portfolio, kind = 'box', minimum = [0.9, -0.5,-0.5, 0.1], maximum = 1)
add_constraint(portfolio, kind = 'long_only')</p>
<h1>group constraint is used to specify min and max weights of certain asset_groups</h1>
<h1>groups must be a dict and group_min and group_max can be scalar or list</h1>
<p>add_constraint(portfolio, kind = 'group', group_min = [0.9, -0.5,-0.5, 0.1], group_max = 1,
              groups = {'eqity':[0,3], 'debt':[1,2]})</p>
<h1>adding weight_sum constraint</h1>
<p>add_constraint(portfolio, kind = 'weight_sum', min_sum = 0.9, max_sum = .95)</p>
<h1>special case of weight_sum is dollar_neutral/active or full_investment</h1>
<p>add_constraint(portfolio, kind = 'dollar_neutral')
add_constraint(portfolio, kind = 'full_investment')</p>
<h1>turnover constraint</h1>
<p>add_constraint(portfolio, kind = 'turnover', turnover_target = 0.1)</p>
<h1>diversification constraint for diversification target in a portfolio</h1>
<p>add_constraint(portfolio, kind = 'diversification', div_target = 0.1)</p>
<h1>position_limit is a constraint to restrict max position and also max long/short positions</h1>
<p>add_constraint(portfolio, kind = 'position_limit', max_pos = 3, max_pos_long = 2, max_pos_short = 2)</p>
<h1>return constraint to add a target mean historical return to the portfolio</h1>
<p>add_constraint(portfolio, kind = 'return', return_target = 0.0018)</p>
<h1>adds a tranaction cost constraint on portfolio</h1>
<p>add_constraint(portfolio, kind = 'transaction_cost', ptc = 0.1)</p>
<h1>constraint on the leverage of portfolio</h1>
<p>add_constraint(portfolio, kind = 'leverage_exposure', leverage = 0.8)</p>
<h1>Factor_exposure constraint is used to test portfolio with their impact on certaint factors</h1>
<h1>factors can be single or multiple with lower and upper limit.</h1>
<h1>B can be a N*K matrix for N assets and K factors.</h1>
<h1>lower and upper arguments can be float for single factor and list for multiple factors</h1>
<p>add_constraint(portfolio, kind = 'factor_exposure', 
              B = np.matrix([[1.2,1.3],
                             [2.3,1.4],
                             [1.4,0.9],
                             [3.4,1.2]]),
               lower = [0.8,1.4], upper = [2,2.4])</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.add_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.add_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_constraint</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">            an object of class portfolio_spec. see portfolio_spec</span>
<span class="sd">    kind : str,</span>
<span class="sd">            currently supported constraint: ’weight_sum’ (also ’leverage’ or ’weight’), ’box’, ’group’,</span>
<span class="sd">           ’turnover’,’diversification’, ’position_limit’, ’return’, ’factor_exposure’,</span>
<span class="sd">            or ’leverage_exposure’.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">            any additional constraint argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    •weight_sum, weight, leverage Specify constraint on the sum of the weights, see weight_sum_constraint    </span>
<span class="sd">    •full_investment Special case to set min_sum=1 and max_sum=1 of weight sum constraints</span>
<span class="sd">    •dollar_neutral, active Special case to set min_sum=0 and max_sum=0 of weight_sum constraints</span>
<span class="sd">    •box box constraint for the individual asset weights, see box_constraint</span>
<span class="sd">    •long_only Special case to set min=0 and max=1 of box constraint</span>
<span class="sd">    •group specify the sum of weights within groups and the number of assets with non-zero weights in groups,</span>
<span class="sd">        see group_constraint</span>
<span class="sd">    •turnover Specify a constraint for target turnover. Turnover is calculated from a set of initial weights,</span>
<span class="sd">        see turnover_constraint</span>
<span class="sd">    •diversification target diversification of asset of weights, see diversification_constraint</span>
<span class="sd">    •position_limit Specify the number of non-zero,long, and/orshortpositions, see position_limit_constraint</span>
<span class="sd">    •return Specify the target mean return, see return_constraint</span>
<span class="sd">    •factor_exposure Specify risk factor exposures, see factor_exposure_constraint</span>
<span class="sd">    •leverage_exposure Specify a maximum leverage exposure, see leverage_exposure_constraint</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; portfolio = portfolio_spec(assets = 4)</span>
<span class="sd">    &gt;&gt;&gt; # adding weight_sum cinstraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;weight_sum&#39;, min_sum = 0.9, max_sum = .95)</span>
<span class="sd">    &gt;&gt;&gt; # long_only is a special kind of box constraint where minimum and maximum is positive</span>
<span class="sd">    &gt;&gt;&gt; # minimum and maximum can be list or scalars</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;box&#39;, minimum = [0.9, -0.5,-0.5, 0.1], maximum = 1)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;long_only&#39;)</span>

<span class="sd">    &gt;&gt;&gt; # group constraint is used to specify min and max weights of certain asset_groups</span>
<span class="sd">    &gt;&gt;&gt; # groups must be a dict and group_min and group_max can be scalar or list</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;group&#39;, group_min = [0.9, -0.5,-0.5, 0.1], group_max = 1,</span>
<span class="sd">                  groups = {&#39;eqity&#39;:[0,3], &#39;debt&#39;:[1,2]})</span>

<span class="sd">    &gt;&gt;&gt; # adding weight_sum constraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;weight_sum&#39;, min_sum = 0.9, max_sum = .95)</span>
<span class="sd">    &gt;&gt;&gt; # special case of weight_sum is dollar_neutral/active or full_investment</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;dollar_neutral&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;full_investment&#39;)</span>

<span class="sd">    &gt;&gt;&gt; #turnover constraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;turnover&#39;, turnover_target = 0.1)</span>

<span class="sd">    &gt;&gt;&gt; #diversification constraint for diversification target in a portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;diversification&#39;, div_target = 0.1)</span>


<span class="sd">    &gt;&gt;&gt; #position_limit is a constraint to restrict max position and also max long/short positions</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;position_limit&#39;, max_pos = 3, max_pos_long = 2, max_pos_short = 2)</span>

<span class="sd">    &gt;&gt;&gt; #return constraint to add a target mean historical return to the portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;return&#39;, return_target = 0.0018)</span>

<span class="sd">    &gt;&gt;&gt; #adds a tranaction cost constraint on portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;transaction_cost&#39;, ptc = 0.1)</span>

<span class="sd">    &gt;&gt;&gt; #constraint on the leverage of portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;leverage_exposure&#39;, leverage = 0.8)</span>

<span class="sd">    &gt;&gt;&gt; #Factor_exposure constraint is used to test portfolio with their impact on certaint factors</span>
<span class="sd">    &gt;&gt;&gt; # factors can be single or multiple with lower and upper limit. </span>
<span class="sd">    &gt;&gt;&gt; # B can be a N*K matrix for N assets and K factors.</span>
<span class="sd">    &gt;&gt;&gt; # lower and upper arguments can be float for single factor and list for multiple factors</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;factor_exposure&#39;, </span>
<span class="sd">                  B = np.matrix([[1.2,1.3],</span>
<span class="sd">                                 [2.3,1.4],</span>
<span class="sd">                                 [1.4,0.9],</span>
<span class="sd">                                 [3.4,1.2]]),</span>
<span class="sd">                   lower = [0.8,1.4], upper = [2,2.4])</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must supply kind of portfolio&#39;</span><span class="p">)</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">box_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;long_only&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">box_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">group_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;leverage&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight_sum&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;full_investment&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;dollar_neutral&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">turnover_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;diversification&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">diversification_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;position_limit&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">position_limit_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">return_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;factor_exposure&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">factor_exposure_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;transaction&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">transaction_cost_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;leverage_exposure&#39;</span><span class="p">:</span>
        <span class="n">tmp_constraint</span> <span class="o">=</span> <span class="n">leverage_exposure_constraint</span><span class="p">(</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_constraint</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_constraint</span>
    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.add_objective">
    <p>def <span class="ident">add_objective</span>(</p><p>portfolio, kind, name, arguments=None, constraints=None, enabled=True, message=True, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>This function is the primary function of adding and updating business goals in a portfolio.spec type object.
General interface, including risk, return, and risk budget, to add optimization goals.   </p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
        an object of class portfolio_spec. 
kind : str,
    the character form of the goal to be added or changed, currently 'return',' risk',
    ‘risk_budget',' quadratic_utility’, or ‘weight_concentration’. 
name : str,
    The target name should correspond to a feature, although we will attempt to make allowances
    arguments : Default arguments to be transferred when executed on an objective function.
enabled : bool, default = True
    bool to enable or disable constraints.
message : bool, default = True
    bool to enable or disable messages.
kwargs : additional key word arguments, optional
    any additional constraint argument to be passed.</p>
<h2>Returns</h2>
<p>Adds objective to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_objectives
portfolio_risk_objectives
risk_budget_objective
turnover_objective
minmax_objective
weight_constraint_objective</p>
<h2>Notes</h2>
<p>In general, you will define your objective as one of the following types:
’return’, ’risk’, ’risk_budget’, or ’weight_concentration’.</p>
<p>These have special handling and intelligent defaults for dealing with the function
most likely to be used as objectives, including mean, median, VaR, ES, etc.
Objectives of type ’turnover’ and ’minmax’ are also supported.</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'return', name = 'mean', target = 0.0018)
add_objective(kind = 'portfolio_risk', name = 'std', target = 0.015)
add_objective(kind = 'risk_budget', name = 'risk_budget')
add_objective(kind = 'weight_conc', name = 'HHI', target = 0.11)
add_objective(kind = 'performance_metrics', name = 'sharpe', target = 0.13)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
        #SOME CODE
add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
NOTE: The output of sortino_ratio or other custom function in objective must be a float.
NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.add_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.add_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_objective</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function is the primary function of adding and updating business goals in a portfolio.spec type object.</span>
<span class="sd">    General interface, including risk, return, and risk budget, to add optimization goals.   </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">            an object of class portfolio_spec. </span>
<span class="sd">    kind : str,</span>
<span class="sd">        the character form of the goal to be added or changed, currently &#39;return&#39;,&#39; risk&#39;,</span>
<span class="sd">        ‘risk_budget&#39;,&#39; quadratic_utility’, or ‘weight_concentration’. </span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">        arguments : Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd"> </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    In general, you will define your objective as one of the following types:</span>
<span class="sd">    ’return’, ’risk’, ’risk_budget’, or ’weight_concentration’.</span>
<span class="sd">    </span>
<span class="sd">    These have special handling and intelligent defaults for dealing with the function</span>
<span class="sd">    most likely to be used as objectives, including mean, median, VaR, ES, etc.</span>
<span class="sd">    Objectives of type ’turnover’ and ’minmax’ are also supported.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;return&#39;, name = &#39;mean&#39;, target = 0.0018)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;portfolio_risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk_budget&#39;, name = &#39;risk_budget&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>


<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must specify thekind&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arguments</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You must specify arguments in a type dict&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must enter the name of the objective&#39;</span><span class="p">)</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">tmp_objective</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">return_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>  <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;portfolio_risk&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">portfolio_risk_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>  <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">risk_budget_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">turnover_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">minmax_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight_conc&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;weight_concentration&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">weight_concentration_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">:</span>
        <span class="n">tmp_objective</span> <span class="o">=</span> <span class="n">performance_metrics_objective</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_objective</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_objective</span>
    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.box_constraint">
    <p>def <span class="ident">box_constraint</span>(</p><p>assets, minimum, maximum, kind=&#39;box&#39;, enabled=True, message=True, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>The box constraint defines the upper and lower limits of asset weights.
add_constraint calls this function when type=”box” is defined.</p>
<h2>Parameters</h2>
<p>assets :  int, or array-like,
          number of assets, or optionally a named list of assets specifying initial weights.
minimum : float, or array-like,
          numeric or named list defining the minimum constraints of the weight box.
maximum : float, or array-like,
          numeric or named list defining the maximum constraints of the weight box.
kind :    str,
          string of kind of constraint.  <br />
enabled : bool, default = True
          bool to enable or disable constraints.
message : bool, default = True
          bool to enable or disable messages.
kwargs :  additional key word arguments, optional
          any additional constraint argument to be passed.</p>
<h2>Returns</h2>
<p>Add box constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>add_constraint(portfolio, kind = 'box', minimum = [0.9, -0.5,-0.5, 0.1], maximum = 1)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.box_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.box_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">box_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    The box constraint defines the upper and lower limits of asset weights.</span>
<span class="sd">    add_constraint calls this function when type=”box” is defined.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets :  int, or array-like,</span>
<span class="sd">              number of assets, or optionally a named list of assets specifying initial weights.</span>
<span class="sd">    minimum : float, or array-like,</span>
<span class="sd">              numeric or named list defining the minimum constraints of the weight box.</span>
<span class="sd">    maximum : float, or array-like,</span>
<span class="sd">              numeric or named list defining the maximum constraints of the weight box.</span>
<span class="sd">    kind :    str,</span>
<span class="sd">              string of kind of constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">              bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">              bool to enable or disable messages.</span>
<span class="sd">    kwargs :  additional key word arguments, optional</span>
<span class="sd">              any additional constraint argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Add box constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;box&#39;, minimum = [0.9, -0.5,-0.5, 0.1], maximum = 1)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;long_only&#39;</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(minimum) and len(maximum) must be same&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="n">nassets</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="n">nassets</span><span class="p">:</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">maximum</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.cVaR_portfolio">
    <p>def <span class="ident">cVaR_portfolio</span>(</p><p>w, R, p=0.05, mean=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate the conditional value at risk (cVaR) of a portfolio</p>
<p>This function calculates the conditional value at risk (cVaR) assuming gaussian distribution</p>
<h2>Parameters</h2>
<p>w : array-like,
    list of weights of portfolio
R : pd.DataFrame object,
    returns dataframe
p : float, optional
    quantile estimate
mean : bool, default = True
    mean VaR of portfolio</p>
<h2>Returns</h2>
<p>Calculates the VaR given portfolio weights</p>
<h2>See Also</h2>
<p>cVaR
VaR_portfolio
VaR</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>w = [0.2,0.3,0.5]
cVaR_portfolio(w,R,p = 0.01)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.cVaR_portfolio', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.cVaR_portfolio" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">cVaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the conditional value at risk (cVaR) of a portfolio</span>
<span class="sd">    </span>
<span class="sd">    This function calculates the conditional value at risk (cVaR) assuming gaussian distribution</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w : array-like,</span>
<span class="sd">        list of weights of portfolio</span>
<span class="sd">    R : pd.DataFrame object,</span>
<span class="sd">        returns dataframe</span>
<span class="sd">    p : float, optional</span>
<span class="sd">        quantile estimate</span>
<span class="sd">    mean : bool, default = True</span>
<span class="sd">        mean VaR of portfolio</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Calculates the VaR given portfolio weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cVaR</span>
<span class="sd">    VaR_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.5]</span>
<span class="sd">    &gt;&gt;&gt; cVaR_portfolio(w,R,p = 0.01)</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="n">VaR_port</span> <span class="o">=</span> <span class="n">VaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">mean</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">cvar_vec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">cvar_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">VaR_port</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="k">if</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cvar_vec</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">cvar_vec</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.chart_efficient_frontier">
    <p>def <span class="ident">chart_efficient_frontier</span>(</p><p>portfolio, R, metric=&#39;Sharpe Ratio&#39;, arguments={&#39;rf&#39;: 0.0}, cml=False, rand_pf=300, optimize_method=&#39;DEoptim&#39;, alpha=0.4, figsize=(10, 6), **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to plot efficient frontier of portfolio.</p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
    an object of class portfolio_spec.
R : pandas dataframe,
    dataframe of the returns series
metric: str, default = 'Sharpe Ratio'
    metric should be either of 'Sharpe Ratio' or 'Treynor Ratio'
arguments : dict, optional
    additional arguments such as risk-free rate in the form of a dictionary.
cml : bool, default = False
    bool to enable or disable capital market line
rand_pf : int, optional
    random portfolio to plot to show the efficient frontier
optimize_method : str, optional
    optimize_method should be similar to those in optimize_portfolio. see optimize_portfolio
alpha : float, optional
    transparency
figsize : tuple, optional
    figure size in the form of a tuple
kwargs : additional key word arguments, optional
    any additional constraint argument to be passed.</p>
<h2>Returns</h2>
<p>matplotlib.scatter</p>
<h2>See Also</h2>
<p>chart_group_weights
chart_weights
chart_efficient_frontier</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>Rb is S&amp;P500 benchmark for capital market line and beta for treynor ratio</h1>
<p>chart_efficient_froniter(portfolio, R, metric = 'Treynor Ratio', 
    arguments = {'rf': 0.0008, 'Rb':Rb}, cml = True, alpha = 0.1, rand_pf = 1000, optimize_method = 'pso')</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.chart_efficient_frontier', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.chart_efficient_frontier" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">chart_efficient_frontier</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;Sharpe Ratio&#39;</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rf&#39;</span><span class="p">:</span><span class="mf">0.00</span><span class="p">},</span> <span class="n">cml</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">rand_pf</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="s1">&#39;DEoptim&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to plot efficient frontier of portfolio.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.</span>
<span class="sd">    R : pandas dataframe,</span>
<span class="sd">        dataframe of the returns series</span>
<span class="sd">    metric: str, default = &#39;Sharpe Ratio&#39;</span>
<span class="sd">        metric should be either of &#39;Sharpe Ratio&#39; or &#39;Treynor Ratio&#39;</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        additional arguments such as risk-free rate in the form of a dictionary.</span>
<span class="sd">    cml : bool, default = False</span>
<span class="sd">        bool to enable or disable capital market line</span>
<span class="sd">    rand_pf : int, optional</span>
<span class="sd">        random portfolio to plot to show the efficient frontier</span>
<span class="sd">    optimize_method : str, optional</span>
<span class="sd">        optimize_method should be similar to those in optimize_portfolio. see optimize_portfolio</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        transparency</span>
<span class="sd">    figsize : tuple, optional</span>
<span class="sd">        figure size in the form of a tuple</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.scatter</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    chart_group_weights</span>
<span class="sd">    chart_weights</span>
<span class="sd">    chart_efficient_frontier</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Rb is S&amp;P500 benchmark for capital market line and beta for treynor ratio</span>
<span class="sd">    &gt;&gt;&gt; chart_efficient_froniter(portfolio, R, metric = &#39;Treynor Ratio&#39;, </span>
<span class="sd">        arguments = {&#39;rf&#39;: 0.0008, &#39;Rb&#39;:Rb}, cml = True, alpha = 0.1, rand_pf = 1000, optimize_method = &#39;pso&#39;)</span>
<span class="sd">&quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>

    <span class="n">NP</span> <span class="o">=</span> <span class="n">rand_pf</span>
    <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
        <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
            <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

    <span class="n">ef_weights</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">ef_mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)</span>
    <span class="n">ef_sd</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
        <span class="n">ef_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">port_mean</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mu</span><span class="p">))</span>
        <span class="n">ef_sd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">ef_weights</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">opt_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">opt_w</span> <span class="o">=</span> <span class="n">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize_method</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">opt_w</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">opt_w</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    
    
    <span class="n">mu</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>

    <span class="n">opt_ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">port_mean</span><span class="p">(</span><span class="n">opt_w</span><span class="p">,</span> <span class="n">mu</span><span class="p">)]</span>
    <span class="n">opt_sd</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">opt_w</span><span class="p">))]</span>

    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Sharpe Ratio&#39;</span><span class="p">:</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">ef_sd</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">r_premium</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ef_mean</span><span class="p">)</span><span class="o">-</span><span class="n">rf</span>
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">sd</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Treynor Ratio&#39;</span><span class="p">:</span>
        <span class="n">tmp_beta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Rb</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;Rb&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">tmp_beta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">Rb</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Rb</span><span class="p">))</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">tmp_beta</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">ef_weights</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">r_premium</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ef_mean</span><span class="p">)</span><span class="o">-</span><span class="n">rf</span>
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">beta</span>
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">tmp_measure</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Sharpe Ratio&#39;</span> <span class="ow">or</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;Treynor Ratio&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;metric must be either &quot;Sharpe Ratio&quot;, or &quot;Treynor Ratio&quot;&#39;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">ef_sd</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ef_mean</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">tmp_measure</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">opt_sd</span><span class="p">,</span> <span class="n">opt_ret</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">opt_sd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_ret</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Optimal&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">cml</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rb&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">Rb</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;Rb&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please add benchmark index in arguments&#39;</span><span class="p">)</span>
        <span class="n">tmp_beta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Rb</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;Rb&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">tmp_beta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">Rb</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Rb</span><span class="p">))</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">tmp_beta</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">opt_w</span><span class="p">))))</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ef_mean</span><span class="p">))</span>
        <span class="n">Ra</span> <span class="o">=</span> <span class="n">rf</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">Ra</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">cml</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="kc">None</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Efficient Frontier&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Expected Volatility (Std. Dev)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Expeected Returns&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">metric</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.chart_group_weights">
    <p>def <span class="ident">chart_group_weights</span>(</p><p>portfolio)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to plot individual group weights of optimal weights.</p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
    an object of class portfolio_spec.  </p>
<h2>Returns</h2>
<p>matplotlib.lines.Line2D</p>
<h2>See Also</h2>
<p>chart_group_weights
chart_efficient_frontier</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>chart_group_weights(portfolio)
NOTE: chart_group_weights will only work after call optimize_portfolio on portfolio_spec</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.chart_group_weights', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.chart_group_weights" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">chart_group_weights</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to plot individual group weights of optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.lines.Line2D</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    chart_group_weights</span>
<span class="sd">    chart_efficient_frontier</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; chart_group_weights(portfolio)</span>
<span class="sd">    NOTE: chart_group_weights will only work after call optimize_portfolio on portfolio_spec</span>
<span class="sd">&quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="n">group_min</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_min&#39;</span><span class="p">]</span>
    <span class="n">group_max</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_max&#39;</span><span class="p">]</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
    <span class="n">group_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">group_weights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">group_vals</span><span class="p">)):</span>
        <span class="n">group_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">group_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_weights</span><span class="p">,</span> <span class="s1">&#39;^b&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_min</span><span class="p">,</span> <span class="s1">&#39;*r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group_max</span><span class="p">,</span> <span class="s1">&#39;*r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))),</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.chart_weights">
    <p>def <span class="ident">chart_weights</span>(</p><p>portfolio)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to plot weights of optimal weights.</p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
    an object of class portfolio_spec.  </p>
<h2>Returns</h2>
<p>matplotlib.lines.Line2D</p>
<h2>See Also</h2>
<p>chart_group_weights
chart_efficient_frontier</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>chart_weights(portfolio)
NOTE: chart_group_weights will only work after call optimize_portfolio on portfolio_spec</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.chart_weights', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.chart_weights" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">chart_weights</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to plot weights of optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.lines.Line2D</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    chart_group_weights</span>
<span class="sd">    chart_efficient_frontier</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; chart_weights(portfolio)</span>
<span class="sd">    NOTE: chart_group_weights will only work after call optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;One of the requirement if missing&#39;</span><span class="p">)</span>
    
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;r&gt;&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">maximum</span><span class="p">,</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Weights&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nassets</span><span class="p">)),</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">assets</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.constrained_objective">
    <p>def <span class="ident">constrained_objective</span>(</p><p>w, R, portfolio, trace=False, normalize=False, storage=False, verbose=False, penalty=10000, *kwargs, **args)</p>
    </div>
    

    
  
    <div class="desc"><p>Add a constraint in portfolio_spec object</p>
<p>Main function to add or update constraint in portfolio_spec object</p>
<h2>Parameters</h2>
<p>w : array-like,
    weights to test
R : pd.DataFrame,
    dataframe of returns of assets in portfolio
trace : bool, default = False
    bool to enable or disable constraints.
normalize : bool, default = False
    bool to specify if weights should be normalized first. see normalize_weights.
verbose : bool, default = False
    bool to enable or disable verbose argument.
penalty : int, optional
    int value specifying he penalty if constraint or objective is breached.
kwargs : additional key word arguments, optional
    any additional constraint argument to be passed.
kwargs : additional arguments, optional
    any additional argument to be passed.</p>
<h2>Returns</h2>
<p>returns a float of total penalty given a weight. if trace = True, additional objective measure will be returned
in the form of dictionary.</p>
<h2>See Also</h2>
<p>rp_transform
optimize_portfolio</p>
<h2>Notes</h2>
<p>constrained_objective is the main function that is called by 
optimize_weights to optimze the constraint and objectives provided by the portfolio.</p>
<p>Loosely speaking, constrained_objective is very similar to an information criteria.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.constrained_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.constrained_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">constrained_objective</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">penalty</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w : array-like,</span>
<span class="sd">        weights to test</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    trace : bool, default = False</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    normalize : bool, default = False</span>
<span class="sd">        bool to specify if weights should be normalized first. see normalize_weights.</span>
<span class="sd">    verbose : bool, default = False</span>
<span class="sd">        bool to enable or disable verbose argument.</span>
<span class="sd">    penalty : int, optional</span>
<span class="sd">        int value specifying he penalty if constraint or objective is breached.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns a float of total penalty given a weight. if trace = True, additional objective measure will be returned</span>
<span class="sd">    in the form of dictionary.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_transform</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    constrained_objective is the main function that is called by </span>
<span class="sd">    optimize_weights to optimze the constraint and objectives provided by the portfolio.</span>
<span class="sd">    </span>
<span class="sd">    Loosely speaking, constrained_objective is very similar to an information criteria.</span>

<span class="sd">&quot;&quot;&quot;</span>    
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">penalty</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="n">penalty</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">optimize_method</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">init_weights</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">verbosoe</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The len of portfolio assets is not equal to the weights list&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_investment&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="c1">#add normalize function (skipped for now)</span>

        <span class="k">if</span> <span class="n">normalize</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">fn_map</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>

    <span class="c1">#add normalize function (skipped for now)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">-</span><span class="n">max_sum</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="p">(</span><span class="n">min_sum</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>



        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">maximum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maximum</span><span class="p">)):</span>
                <span class="n">tmp_val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">maximum</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">tmp_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">maximum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_val</span><span class="p">)</span> <span class="o">*</span> <span class="n">penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minimum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimum</span><span class="p">)):</span>
                <span class="n">tmp_val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">minimum</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">tmp_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_val</span><span class="p">)</span> <span class="o">*</span> <span class="n">penalty</span>


        <span class="c1">#Group Constraint Penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
            <span class="n">cLO</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_min&#39;</span><span class="p">]</span>
            <span class="n">cUP</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_max&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">cUP</span><span class="p">)):</span>
                <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
                    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cLO</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="p">(</span><span class="n">cLO</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cUP</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">-</span> <span class="n">cUP</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position_limit&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">max_pos</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos&#39;</span><span class="p">]</span>
            <span class="n">tolerence</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">nzassets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tolerence</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nzassets</span> <span class="o">&gt;</span> <span class="n">max_pos</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="n">nzassets</span> <span class="o">-</span> <span class="n">max_pos</span><span class="p">)</span>    
            <span class="c1">#diversification Constraint Penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;diversification&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">div_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;diversification&#39;</span><span class="p">][</span><span class="s1">&#39;diversification_target&#39;</span><span class="p">]</span>
            <span class="n">div</span> <span class="o">=</span> <span class="n">diversification</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">div</span> <span class="o">&lt;</span> <span class="n">div_target</span> <span class="o">*</span> <span class="mf">0.95</span> <span class="ow">or</span> <span class="n">div</span> <span class="o">&gt;</span> <span class="n">div_target</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">div</span> <span class="o">-</span> <span class="n">div_target</span><span class="p">)</span>

        <span class="c1">#Turnover Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;turnover&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">turnover_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;turnover&#39;</span><span class="p">][</span><span class="s1">&#39;turnover_target&#39;</span><span class="p">]</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">turnover</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">to</span> <span class="o">&lt;</span> <span class="n">turnover_target</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">to</span> <span class="o">&gt;</span> <span class="n">turnover_target</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">to</span> <span class="o">-</span> <span class="n">turnover_target</span><span class="p">)</span>


        <span class="c1">#Return Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">return_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;return&#39;</span><span class="p">][</span><span class="s1">&#39;return_target&#39;</span><span class="p">]</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">port_ret</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">mean_return</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mean_return</span> <span class="o">-</span> <span class="n">return_target</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>


        <span class="c1">#Factor Exposure Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">t_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;B&#39;</span><span class="p">])</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;lower&#39;</span><span class="p">]</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;upper&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;lower&#39;</span><span class="p">]]</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;factor_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;upper&#39;</span><span class="p">]]</span>

            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t_B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">tmp_exp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">t_B</span><span class="p">[</span><span class="n">i</span><span class="p">][:])))</span>
                <span class="k">if</span> <span class="n">tmp_exp</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp_exp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tmp_exp</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmp_exp</span> <span class="o">-</span> <span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


        <span class="c1">#Transaction Cost Constraint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transaction&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">tc</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)))</span><span class="o">*</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;transaction&#39;</span><span class="p">][</span><span class="s1">&#39;ptc&#39;</span><span class="p">])</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">mult</span> <span class="o">*</span> <span class="n">tc</span>

        <span class="c1">#Leverage Constraint Penalty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage_exposure&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;leverage&#39;</span><span class="p">]:</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">100</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span> <span class="o">-</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage_exposure&#39;</span><span class="p">][</span><span class="s1">&#39;leverage&#39;</span><span class="p">]))</span>




      
    
    <span class="c1">#assuming verbose = False for now...</span>
    
    <span class="c1">#Objectives Penalty Functions</span>
    <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>

    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="ow">or</span> <span class="n">out</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">out</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Na or NaN produced from constraints/objective&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">storage</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tmp_ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">tmp_measure</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>
                    
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span> <span class="ow">or</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;portfolio_risk&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span> <span class="ow">or</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;stdev&#39;</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)))))</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VaR&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">VaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="c1"># add Value at risk function. Skipped for now</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cVaR&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">cVaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="c1"># add cVaR function. Skipped for now</span>
                    
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>
                   
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
                <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">turnover</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;weight_concentration&#39;</span><span class="p">:</span>
                <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">HHI</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;weight_concentration&#39;</span><span class="p">][</span><span class="s1">&#39;conc_groups&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk_budget&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;risk_budget&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">cVaR_portfolio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
                <span class="c1">#Custom function support</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c1">#Update modified sharpe and complex metrics</span>
            <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sharpe&#39;</span><span class="p">:</span>
                    <span class="n">sd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">)))))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                    <span class="n">r_premium</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)</span><span class="o">-</span><span class="n">rf</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">sd</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;treynor&#39;</span><span class="p">:</span>
                    <span class="n">tmp_beta</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">tmp_beta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">Rb</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">Rb</span><span class="p">))</span>
                    <span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">tmp_beta</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">))))</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span> 
                    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                    <span class="n">r_premium</span> <span class="o">=</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rf</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">r_premium</span><span class="o">/</span><span class="n">beta</span>
                <span class="k">if</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;starr&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rf</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="s1">&#39;performance_metrics&#39;</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.05</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">starr_ratio</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">rf</span> <span class="o">=</span> <span class="n">rf</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;arguments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]](</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_measure</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1">#use getattr in future</span>
        
        <span class="n">tmp_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_measure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;portfolio_risk&#39;</span> <span class="ow">or</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;turnover&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;weight_concentration&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_groups&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmp_measure</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_groups&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_measure</span>
 
                    <span class="c1">#Risk Budget</span>
        <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;risk_budget&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">penalty</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_measure</span> <span class="o">-</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objective</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
        
        <span class="c1">#end of objective penalty</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_ret</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">objective</span><span class="p">,</span> <span class="n">tmp_measure</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_ret</span> <span class="o">=</span> <span class="n">tmp_ret</span>

                
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;weights : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;out : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;objective_measures : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmp_ret</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">storage</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span><span class="p">({</span><span class="s1">&#39;out&#39;</span><span class="p">:</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">tmp_ret</span><span class="p">,</span> <span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="n">w</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">storage</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">trace</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.diversification">
    <p>def <span class="ident">diversification</span>(</p><p>weights)</p>
    </div>
    

    
  
    <div class="desc"><p>Diversification is stated as 1 minus the total of the squared weights</p>
<p>Diversification function to compute as a constraint</p>
<h2>Parameters</h2>
<p>weights : array-like,
        list of weights of assets. </p>
<h2>Returns</h2>
<p>returns diversification given the weights</p>
<h2>See Also</h2>
<p>turnover</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>w = [0.2,0.3,0.5]
turnover(w)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.diversification', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.diversification" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">diversification</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Diversification is stated as 1 minus the total of the squared weights</span>

<span class="sd">    Diversification function to compute as a constraint</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">            list of weights of assets. </span>
<span class="sd">   </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns diversification given the weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    turnover</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.5]</span>
<span class="sd">    &gt;&gt;&gt; turnover(w)</span>
<span class="sd">&quot;&quot;&quot;</span>

    
    <span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.diversification_constraint">
    <p>def <span class="ident">diversification_constraint</span>(</p><p>assets, div_target, kind=&#39;diversification&#39;, enabled=True, message=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Target diversification value is specified under the diversification constraint.</p>
<p>This function is called by add.constraint when type=”diversification” is mentioned.</p>
<h2>Parameters</h2>
<p>assets : Int, or array-like,
        Number of assets or, as an alternative, a named asset list specifying initial weights.
div_target : float,
        diversification target value
kind : str,
        string of the kind of constraint.  <br />
enabled : bool, default = True
        bool to enable or disable constraints.
message : bool, default = True
        bool to enable or disable messages.</p>
<h2>Returns</h2>
<p>Adds diversification constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>diversification constraint for diversification target in a portfolio</h1>
<p>add_constraint(portfolio, kind = 'diversification', div_target = 0.1)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.diversification_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.diversification_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">diversification_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">div_target</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;diversification&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Target diversification value is specified under the diversification constraint.</span>
<span class="sd">    </span>
<span class="sd">    This function is called by add.constraint when type=”diversification” is mentioned.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    div_target : float,</span>
<span class="sd">            diversification target value</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of the kind of constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds diversification constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #diversification constraint for diversification target in a portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;diversification&#39;, div_target = 0.1)</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;diversification_target&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">div_target</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.equal_weight">
    <p>def <span class="ident">equal_weight</span>(</p><p>R, portfoio, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to extract objective measures of equal weight portfolio.</p>
<h2>Parameters</h2>
<p>R : pd.DataFrame,
    dataframe of returns of assets in portfolio
portfolio : portfolio_spec,
    an object of class portfolio_spec.<br />
kwargs : additional arguments, optional
    any additional argument to be passed.</p>
<h2>Returns</h2>
<p>dictionary of objective measures of equal weighted portfolio</p>
<h2>See Also</h2>
<p>inverse_volatility_weights </p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>equal_weight(R, portfolio)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.equal_weight', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.equal_weight" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">equal_weight</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfoio</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract objective measures of equal weight portfolio.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of objective measures of equal weighted portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    inverse_volatility_weights </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; equal_weight(R, portfolio)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">nassets</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nassets</span> <span class="o">!=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;assets should be of same length as columns in R&#39;</span><span class="p">)</span>
    <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.extract_groups">
    <p>def <span class="ident">extract_groups</span>(</p><p>portfolio)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to extract groups from portfolio_spec object.</p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
    an object of class portfolio_spec.  </p>
<h2>Returns</h2>
<p>dictionary of groups if group_constraint is specified.</p>
<h2>See Also</h2>
<p>extract_weights
extract_objective_measure
extract_groups</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>extract_groups(portfolio)
NOTE: extract_groups will only work after calling optimize_portfolio on portfolio_spec</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.extract_groups', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.extract_groups" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_groups</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract groups from portfolio_spec object.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of groups if group_constraint is specified.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    extract_weights</span>
<span class="sd">    extract_objective_measure</span>
<span class="sd">    extract_groups</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; extract_groups(portfolio)</span>
<span class="sd">    NOTE: extract_groups will only work after calling optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
        <span class="n">group_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">group_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">group_vals</span><span class="p">)):</span>
            <span class="n">group_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">group_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">category</span><span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">category_labels</span>
        <span class="n">category_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">ncategory</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
        <span class="n">category_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">category_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_vals</span><span class="p">)):</span>
            <span class="n">category_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">category_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
    <span class="n">tmp_group_w</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([{</span><span class="s1">&#39;groups&#39;</span><span class="p">:</span><span class="n">groups</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;group_weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">group_weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="n">category_labels</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;category_weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">category_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">category_weights</span><span class="p">))}])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_group_w</span><span class="p">)</span>   
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.extract_objective_measure">
    <p>def <span class="ident">extract_objective_measure</span>(</p><p>R, portfolio, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to extract objective measures of optimal weights.</p>
<h2>Parameters</h2>
<p>R : pd.DataFrame,
    dataframe of returns of assets in portfolio
portfolio : portfolio_spec,
    an object of class portfolio_spec.<br />
kwargs : additional arguments, optional
    any additional argument to be passed.</p>
<h2>Returns</h2>
<p>dictionary of objective measures as specified in the portfolio_spec object</p>
<h2>See Also</h2>
<p>extract_weights
extract_objective_measure
extract_groups</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>extract_objective_measure(R, portfolio)
NOTE: extract_objective_measure will only work after calling optimize_portfolio on portfolio_spec</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.extract_objective_measure', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.extract_objective_measure" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_objective_measure</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract objective measures of optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of objective measures as specified in the portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    extract_weights</span>
<span class="sd">    extract_objective_measure</span>
<span class="sd">    extract_groups</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; extract_objective_measure(R, portfolio)</span>
<span class="sd">    NOTE: extract_objective_measure will only work after calling optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Please specify portfoio weights in portfolio_spec_object.&#39;</span><span class="p">)</span>
    <span class="n">tmp_objective_measure</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_objective_measure</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.extract_weights">
    <p>def <span class="ident">extract_weights</span>(</p><p>portfolio)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to extract optimal weights.</p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
    an object of class portfolio_spec.  </p>
<h2>Returns</h2>
<p>array of optimal weights</p>
<h2>See Also</h2>
<p>extract_objective_measure
extract_groups</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>extract_weights(portfolio)
NOTE: extract_weights will only work after calling optimize_portfolio on portfolio_spec</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.extract_weights', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.extract_weights" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_weights</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to extract optimal weights.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array of optimal weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    extract_objective_measure</span>
<span class="sd">    extract_groups</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; extract_weights(portfolio)</span>
<span class="sd">    NOTE: extract_weights will only work after calling optimize_portfolio on portfolio_spec</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Portfolio_spec object does not have any weights. Please run optimize_portfolio before extracting weights&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.factor_exposure_constraint">
    <p>def <span class="ident">factor_exposure_constraint</span>(</p><p>assets, B, lower, upper, kind=&#39;factor_exposure&#39;, enabled=True, message=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Add a factor exposure constraint for "K" different factos in a portdolio and also their exposure to 
particular asset.</p>
<h2>Parameters</h2>
<p>assets : int, or array-like,
        named list of assets specifying initial weights.
B : matrix-like,
    matrix or list of risk factor exposures
lower : int, or array-like
    list of lower limits of risk factor exposure constraints.
upper : int, or array-like
    list of upper limits of risk factor exposure constraints.
kind : str,
    string of kind of constraints.  <br />
enabled : bool, default = True
    bool to enable or disable constraints.
message : bool, default = False
    bool to enable or disable messages.</p>
<h2>Returns</h2>
<p>Adds factor_exposure constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>Factor_exposure constraint is used to test portfolio with their impact on certaint factors</h1>
<h1>factors can be single or multiple with lower and upper limit.</h1>
<h1>B can be a N*K matrix for N assets and K factors.</h1>
<h1>lower and upper arguments can be float for single factor and list for multiple factors</h1>
<p>add_constraint(portfolio, kind = 'factor_exposure', 
              B = np.matrix([[1.2,1.3],
                             [2.3,1.4],
                             [1.4,0.9],
                             [3.4,1.2]]),
               lower = [0.8,1.4], upper = [2,2.4])</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.factor_exposure_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.factor_exposure_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">factor_exposure_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;factor_exposure&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a factor exposure constraint for &quot;K&quot; different factos in a portdolio and also their exposure to </span>
<span class="sd">    particular asset.</span>

<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            named list of assets specifying initial weights.</span>
<span class="sd">    B : matrix-like,</span>
<span class="sd">        matrix or list of risk factor exposures</span>
<span class="sd">    lower : int, or array-like</span>
<span class="sd">        list of lower limits of risk factor exposure constraints.</span>
<span class="sd">    upper : int, or array-like</span>
<span class="sd">        list of upper limits of risk factor exposure constraints.</span>
<span class="sd">    kind : str,</span>
<span class="sd">        string of kind of constraints.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds factor_exposure constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #Factor_exposure constraint is used to test portfolio with their impact on certaint factors</span>
<span class="sd">    &gt;&gt;&gt; # factors can be single or multiple with lower and upper limit. </span>
<span class="sd">    &gt;&gt;&gt; # B can be a N*K matrix for N assets and K factors.</span>
<span class="sd">    &gt;&gt;&gt; # lower and upper arguments can be float for single factor and list for multiple factors</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;factor_exposure&#39;, </span>
<span class="sd">                  B = np.matrix([[1.2,1.3],</span>
<span class="sd">                                 [2.3,1.4],</span>
<span class="sd">                                 [1.4,0.9],</span>
<span class="sd">                                 [3.4,1.2]]),</span>
<span class="sd">                   lower = [0.8,1.4], upper = [2,2.4])</span>

<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="c1">##Factor Exposure Constraint</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nassets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;length of B must equal nassets&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;lower must be a float&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;upper must be a float&#39;</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">B</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nassets</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapeError</span><span class="p">(</span><span class="s1">&#39;number of rows must equal nassets&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShapeError</span><span class="p">(</span><span class="s1">&#39;number of columns must equal lower&#39;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.fn_map">
    <p>def <span class="ident">fn_map</span>(</p><p>weights, portfolio, relax=False, verbose=False)</p>
    </div>
    

    
  
    <div class="desc"><p>This function transforms list of weights that does not meet the portfolio constraints to an array that meets
the constraints. relax argument (default = False) if True gives the function permission to transform weights 
if needed</p>
<h2>Parameters</h2>
<p>weights : array-like,
    list of initial weights.
portfolio : portfolio_spec,
    an object of class portfolio_spec.
relax : bool, default = False
    bool to enable or disable constraints.
verbose : bool, default = False
    bool to enable or disable messages.</p>
<h2>Returns</h2>
<p>returns the array of weights tranformed by the function and that does satisfy the constraints.
called by optimize_portfolio if optimize_method = 'DEoptim' or 'pso'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.fn_map', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.fn_map" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fn_map</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">relax</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This function transforms list of weights that does not meet the portfolio constraints to an array that meets</span>
<span class="sd">    the constraints. relax argument (default = False) if True gives the function permission to transform weights </span>
<span class="sd">    if needed</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        list of initial weights.</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.</span>
<span class="sd">    relax : bool, default = False</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    verbose : bool, default = False</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the array of weights tranformed by the function and that does satisfy the constraints.</span>
<span class="sd">    called by optimize_portfolio if optimize_method = &#39;DEoptim&#39; or &#39;pso&#39;</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_investment&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;full_investment&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>     
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;dollar_neutral&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>


    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">min_sum</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">max_sum</span> <span class="o">-</span> <span class="n">min_sum</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.02</span><span class="p">:</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span> <span class="o">-</span> <span class="mf">0.01</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span> <span class="o">+</span> <span class="mf">0.01</span>
   
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">generate_sequence</span><span class="p">(</span><span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minimum</span><span class="p">),</span> <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maximum</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">)</span> <span class="c1">#generateSequence function</span>
        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span>
    
    
    <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span>


    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
        <span class="n">cLO</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_min&#39;</span><span class="p">]</span>
        <span class="n">cUP</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">][</span><span class="s1">&#39;group_max&#39;</span><span class="p">]</span> <span class="c1">#add group_pos assuming None for for</span>
        <span class="n">tmp_cLO</span> <span class="o">=</span> <span class="n">cLO</span>
        <span class="n">tmp_cUP</span> <span class="o">=</span> <span class="n">cUP</span>
        <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#add group_pos assuming None for for</span>
        <span class="n">tmp_cLO</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_cUP</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span>



    <span class="n">tmp_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
    <span class="n">tmp_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span>
    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>


    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;turnover&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">turnover_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;turnover&#39;</span><span class="p">][</span><span class="s1">&#39;turnover_target&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">turnover_target</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;diversification&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">div_target</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;diversification&#39;</span><span class="p">][</span><span class="s1">&#39;diversification_target&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">div_target</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position_limit&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos&#39;</span><span class="p">]</span>
        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos_long&#39;</span><span class="p">]</span>
        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;position_limit&#39;</span><span class="p">][</span><span class="s1">&#39;max_pos_short&#39;</span><span class="p">]</span>
        <span class="n">tmp_max_pos</span> <span class="o">=</span> <span class="n">max_pos</span>
        <span class="n">tmp_max_pos_long</span> <span class="o">=</span> <span class="n">max_pos_long</span>
        <span class="n">tmp_max_pos_short</span> <span class="o">=</span> <span class="n">max_pos_short</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_max_pos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_max_pos_long</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_max_pos_short</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;leverage&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">leverage</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;leverage&#39;</span><span class="p">][</span><span class="s1">&#39;leverage&#39;</span><span class="p">]</span>
        <span class="n">tmp_leverage</span> <span class="o">=</span> <span class="n">leverage</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">leverage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmp_leverage</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">min_sum</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">min_sum</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">max_sum</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                                        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
                                        <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                        <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
                                        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span><span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_min</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_max</span><span class="p">))):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                                    <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
                                    <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
                                    <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="p">((</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span> <span class="ow">or</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;</span> <span class="n">tmp_min</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&gt;</span> <span class="n">tmp_max</span><span class="p">)))</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;</span> <span class="n">tmp_min</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_min</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">tmp_weights</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;</span><span class="n">tmp_min</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                                <span class="n">tmp_min</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&gt;</span> <span class="n">tmp_max</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_max</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">tmp_weights</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="n">tmp_max</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                                <span class="n">tmp_max</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                        <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                        <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                        <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
                        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">==</span> <span class="n">weights</span><span class="p">):</span>
                    <span class="n">tmp_min</span> <span class="o">=</span> <span class="n">minimum</span>
                    <span class="n">tmp_max</span> <span class="o">=</span> <span class="n">maximum</span>

                        
    <span class="c1">#group_transform</span>
    
    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cLO</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cUP</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
            <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> 
            <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
            <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> 
            <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(((</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span> <span class="ow">or</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&lt;</span> <span class="n">tmp_min</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">&gt;</span> <span class="n">tmp_max</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">)))</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_cLO</span><span class="p">)):</span>
                        <span class="n">tmp_cLO</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_cUP</span><span class="p">)):</span>
                        <span class="n">tmp_cUP</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                  <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                  <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                  <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> 
                  <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                  <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                  <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_weights</span> <span class="o">==</span> <span class="n">weights</span><span class="p">):</span>
                <span class="n">tmp_cLO</span> <span class="o">=</span> <span class="n">cLO</span>
                <span class="n">tmp_cUP</span> <span class="o">=</span> <span class="n">cUP</span>





                <span class="c1">#Max_pos Transform</span>
                

    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
                <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> 
                <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
                <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">tmp_max_pos</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nassets</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">tmp_max_pos_long</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nassets</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">tmp_max_pos_short</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nassets</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                  <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                  <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                  <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> 
                  <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
                  <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                  <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="c1">#Leverage Transform</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">tmp_leverage</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">tmp_leverage</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> 
            <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> 
            <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
            <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
            <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
            <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="n">relax</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_weights</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">tmp_leverage</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
                <span class="n">tmp_leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span> <span class="o">*</span><span class="mf">1.01</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_weights</span><span class="p">,</span> 
                  <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> 
                  <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max</span><span class="p">,</span> 
                  <span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="n">tmp_cUP</span><span class="p">,</span> 
                  <span class="n">max_pos</span> <span class="o">=</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_pos</span><span class="p">,</span> 
                  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> 
                  <span class="n">leverage</span> <span class="o">=</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">,</span> 
                  <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tmp_weights</span> <span class="o">=</span> <span class="n">weights</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>   
                
                
                
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;cLO&#39;</span><span class="p">,</span> <span class="s1">&#39;cUP&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_long&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_short&#39;</span><span class="p">,</span> <span class="s1">&#39;leverage&#39;</span><span class="p">,</span> <span class="s1">&#39;min_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sum&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">tmp_weights</span><span class="p">,</span> <span class="n">tmp_min</span><span class="p">,</span> <span class="n">tmp_max</span><span class="p">,</span> <span class="n">tmp_cLO</span><span class="p">,</span> <span class="n">tmp_cUP</span><span class="p">,</span> <span class="n">tmp_max_pos</span><span class="p">,</span> <span class="n">tmp_max_pos_long</span><span class="p">,</span> <span class="n">tmp_max_pos_short</span><span class="p">,</span> <span class="n">tmp_leverage</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.generate_sequence">
    <p>def <span class="ident">generate_sequence</span>(</p><p>minimum=0.01, maximum=1.01, by=0.01, rounding=3)</p>
    </div>
    

    
  
    <div class="desc"><p>The sequence of min&lt;-&gt;max weights for random.</p>
<p>Creating a series of potential weights for portfolios of random or brute force.</p>
<h2>Parameters</h2>
<p>minimum : float,
    sequence minimum value <br />
maximum : float,
    sequence maximum value
by : float, optional
    number to increase the series by
rounding : int, optional
    integer the number of decimals we can round to</p>
<h2>Returns</h2>
<p>returns a series of ranfom weights that satisfy the min-max weights constraint. 
Default weight_seq for rp_transform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.generate_sequence', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.generate_sequence" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_sequence</span><span class="p">(</span><span class="n">minimum</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">rounding</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sequence of min&lt;-&gt;max weights for random.</span>
<span class="sd">    </span>
<span class="sd">    Creating a series of potential weights for portfolios of random or brute force.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    minimum : float,</span>
<span class="sd">        sequence minimum value   </span>
<span class="sd">    maximum : float,</span>
<span class="sd">        sequence maximum value</span>
<span class="sd">    by : float, optional</span>
<span class="sd">        number to increase the series by</span>
<span class="sd">    rounding : int, optional</span>
<span class="sd">        integer the number of decimals we can round to</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns a series of ranfom weights that satisfy the min-max weights constraint. </span>
<span class="sd">    Default weight_seq for rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">rounding</span><span class="p">),</span> <span class="n">stop</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">maximum</span><span class="p">,</span> <span class="n">rounding</span><span class="p">),</span> <span class="n">step</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.get_constraints">
    <p>def <span class="ident">get_constraints</span>(</p><p>portfolio)</p>
    </div>
    

    
  
    <div class="desc"><p>Helper functionality to get the constraints allowed out of the portfolio object </p>
<h2>Parameters</h2>
<p>portfolio : portfolio_spec,
            an object of class portfolio_spec. </p>
<h2>Returns</h2>
<p>returns dictionary of constraints extracted from the portfolio_spec object</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(3)
add_constraint('dollar_neutral')
get_constraint(port)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.get_constraints', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.get_constraints" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_constraints</span><span class="p">(</span><span class="n">portfolio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper functionality to get the constraints allowed out of the portfolio object </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">                an object of class portfolio_spec. </span>
<span class="sd">  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns dictionary of constraints extracted from the portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(3)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;dollar_neutral&#39;)</span>
<span class="sd">    &gt;&gt;&gt; get_constraint(port)</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.group_constraint">
    <p>def <span class="ident">group_constraint</span>(</p><p>assets, groups, group_min, group_max, kind=&#39;group&#39;, enabled=True, message=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Group constraints determine the grouping of assets, group weights,
and the number of positions of the groups (i.e. non-zero weights).</p>
<h2>Parameters</h2>
<p>assets : Int, or array-like,
        Number of assets or, as an alternative, a named asset list specifying initial weights.
groups : Dict, 
        dictionary specifying the assets groups.
group_min : float, or array-like,
        numeric or named list defining the minimum constraints of the weight group. 
group_max : float, or array-like,
        numeric or named list defining the maximum constraints of the weight group.
kind : str,
        string of kind of constraint.  <br />
enabled : bool, default = True
        bool to enable or disable constraints.
message : bool, default = False
        bool to enable or disable messages.</p>
<h2>Returns</h2>
<p>Adds group constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>add_constraint(portfolio, kind = 'group', group_min = [0.9, -0.5,-0.5, 0.1], 
    group_max =1, groups = {'eqity':[0,3], 'debt':[1,2]})</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.group_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.group_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">group_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">group_min</span><span class="p">,</span> <span class="n">group_max</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Group constraints determine the grouping of assets, group weights,</span>
<span class="sd">    and the number of positions of the groups (i.e. non-zero weights).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------  </span>
<span class="sd">    assets : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    groups : Dict, </span>
<span class="sd">            dictionary specifying the assets groups.</span>
<span class="sd">    group_min : float, or array-like,</span>
<span class="sd">            numeric or named list defining the minimum constraints of the weight group. </span>
<span class="sd">    group_max : float, or array-like,</span>
<span class="sd">            numeric or named list defining the maximum constraints of the weight group.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds group constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">   </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;group&#39;, group_min = [0.9, -0.5,-0.5, 0.1], </span>
<span class="sd">        group_max =1, groups = {&#39;eqity&#39;:[0,3], &#39;debt&#39;:[1,2]})</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Groups must be passed as a pandas dict&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">nassets</span> <span class="o">=</span> <span class="n">assets</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    
    <span class="n">group_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">ngroups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_min</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_min</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">group_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">group_min</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_min</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngroups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(group_min) must equal ngroups&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_max</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_max</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">group_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">group_max</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_max</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngroups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(group_max) must equal ngroups&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">group_names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">group_label</span> <span class="o">=</span> <span class="n">group_names</span>
    <span class="k">if</span> <span class="n">group_names</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">group_label</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">group_label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ngroups</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">):</span>
            <span class="n">group_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_label</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngroups</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;group_labels must match ngroups&#39;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="s1">&#39;group_min&#39;</span><span class="p">,</span> <span class="s1">&#39;group_max&#39;</span><span class="p">,</span> <span class="s1">&#39;group_label&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">groups</span><span class="p">,</span> <span class="n">group_min</span><span class="p">,</span> <span class="n">group_max</span><span class="p">,</span> <span class="n">group_label</span><span class="p">,</span> <span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.group_fail">
    <p>def <span class="ident">group_fail</span>(</p><p>weights, groups=None, cLO=None, cUP=None, group_pos=None)</p>
    </div>
    

    
  
    <div class="desc"><p>The role loops through each group and checks if the cLO or cUP for the given group has been breached.
This is a rp_transform helper feature.
Test if group limits have been breached.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    test the list of weights
groups : dict,
    A dictionary defining the asset classes. similar in group_constraint.
cLO : float, or array-like,
    Specifying minimum weight group constraints by numeric or vector.
cUP : float, or array-like,
    Specifying maximum weight group constraints by numeric or vector.
group_pos : array-like, optional
    A list that defines the number of non-zero weights for each category.</p>
<h2>Returns</h2>
<p>Bool returning "True" if group weights are breached</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.group_fail', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.group_fail" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">group_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The role loops through each group and checks if the cLO or cUP for the given group has been breached.</span>
<span class="sd">    This is a rp_transform helper feature.</span>
<span class="sd">    Test if group limits have been breached.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights</span>
<span class="sd">    groups : dict,</span>
<span class="sd">        A dictionary defining the asset classes. similar in group_constraint.</span>
<span class="sd">    cLO : float, or array-like,</span>
<span class="sd">        Specifying minimum weight group constraints by numeric or vector.</span>
<span class="sd">    cUP : float, or array-like,</span>
<span class="sd">        Specifying maximum weight group constraints by numeric or vector.</span>
<span class="sd">    group_pos : array-like, optional</span>
<span class="sd">        A list that defines the number of non-zero weights for each category.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Bool returning &quot;True&quot; if group weights are breached</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">cLO</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">cUP</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;One or more arguments is incorrect&#39;</span><span class="p">)</span>
    <span class="n">group_count</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">group_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">group_pos</span> <span class="o">=</span> <span class="n">group_count</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
        <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">group_fail</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)[</span><span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">group_fail</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cLO</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cUP</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">group_pos</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">group_fail</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.inverse_volatility_weights">
    <p>def <span class="ident">inverse_volatility_weights</span>(</p><p>R, portfoio, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to calculate objective_measure of inverse volatility portfolio</p>
<h2>Parameters</h2>
<p>R : pd.DataFrame,
    dataframe of returns of assets in portfolio
portfolio : portfolio_spec,
    an object of class portfolio_spec.<br />
kwargs : additional arguments, optional
    any additional argument to be passed.</p>
<h2>Returns</h2>
<p>dictionary of objective measures of inverse volatility portfolio</p>
<h2>See Also</h2>
<p>equal_weight
inverse_volatility_weight </p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>inverse_volatility_weight(R, portfolio)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.inverse_volatility_weights', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.inverse_volatility_weights" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">inverse_volatility_weights</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfoio</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Function to calculate objective_measure of inverse volatility portfolio</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        dataframe of returns of assets in portfolio</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec.  </span>
<span class="sd">    kwargs : additional arguments, optional</span>
<span class="sd">        any additional argument to be passed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dictionary of objective measures of inverse volatility portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    equal_weight</span>
<span class="sd">    inverse_volatility_weight </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; inverse_volatility_weight(R, portfolio)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">assets</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">R</span><span class="p">))</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">R</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">nassets</span> <span class="o">!=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;assets should be of same length as columns in R&#39;</span><span class="p">)</span>
    <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_exposure_constraint">
    <p>def <span class="ident">leverage_exposure_constraint</span>(</p><p>assets, leverage, kind=&#39;leverage_exposure&#39;, enabled=True, message=True)</p>
    </div>
    

    
  
    <div class="desc"><p>A maximum leverage where leverage is stated as the total of the absolute value of the weights
is determined under the leverage_exposure constraint.    </p>
<h2>Parameters</h2>
<p>assets : int, or array-like,
        leverage : maximum leverage value
kind : str,
        string of kind of constraints  <br />
enabled : bool, default = True
        bool to enable or disable constraints.
message : bool, default = True
        bool to enable or disable messages.</p>
<h2>Returns</h2>
<p>Adds leverage_exposure constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>constraint on the leverage of portfolio</h1>
<p>add_constraint(portfolio, kind = 'leverage_exposure', leverage = 0.8)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_exposure_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_exposure_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">leverage_exposure_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">leverage</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;leverage_exposure&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A maximum leverage where leverage is stated as the total of the absolute value of the weights</span>
<span class="sd">    is determined under the leverage_exposure constraint.    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            leverage : maximum leverage value</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraints    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds leverage_exposure constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #constraint on the leverage of portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;leverage_exposure&#39;, leverage = 0.8)</span>

<span class="sd">&quot;&quot;&quot;</span>


    
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;leverage&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">leverage</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_fail">
    <p>def <span class="ident">leverage_fail</span>(</p><p>weights, leverage=None)</p>
    </div>
    

    
  
    <div class="desc"><p>It is used by rp_transform as a helper function to test if leverage constraint is breached.</p>
<p>Parameters</p>
<hr />
<p>weights : array-like,
      test the list of weights.
  leverage : float,
      specify the leverage the portfolio must satisfy</p>
<p>Returns</p>
<hr />
<p>Returns "True" if the weights fail the leverage_exposure constraint. Called by rp_transform. see rp_transform.</p>
<p>See Also</p>
<hr />
<p>pos_limit_fail
    import numpy as np
  import pandas as pd</p>
<p>rp_transform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_fail', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.leverage_fail" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">leverage_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to test if leverage constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights.</span>
<span class="sd">    leverage : float,</span>
<span class="sd">        specify the leverage the portfolio must satisfy</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the leverage_exposure constraint. Called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    pos_limit_fail</span>
<span class="sd">      import numpy as np</span>
<span class="sd">    import pandas as pd</span>


<span class="sd">  rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>


    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="k">if</span> <span class="n">leverage</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">leverage</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.max_sum_fail">
    <p>def <span class="ident">max_sum_fail</span>(</p><p>weights, max_sum=None)</p>
    </div>
    

    
  
    <div class="desc"><p>it is used by rp_transform as a helper function to test if max_sum constraint is breached.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    test the list of weights
max_sum : float, optional
    max_sum of the weights of portfolio</p>
<h2>Returns</h2>
<p>Returns "True" if the weights fail the max_sum constraint. Called by rp_transform. see rp_transform.</p>
<h2>See Also</h2>
<p>fn_map, rp_transform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.max_sum_fail', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.max_sum_fail" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">max_sum_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    it is used by rp_transform as a helper function to test if max_sum constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights</span>
<span class="sd">    max_sum : float, optional</span>
<span class="sd">        max_sum of the weights of portfolio</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the max_sum constraint. Called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fn_map, rp_transform</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="k">if</span> <span class="n">max_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>       
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.min_sum_fail">
    <p>def <span class="ident">min_sum_fail</span>(</p><p>weights, min_sum=None)</p>
    </div>
    

    
  
    <div class="desc"><p>it is used by rp_transform as a helper function to test if min_sum constraint is breached.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    test the list of weights
min_sum : float, optional
    max_sum of the weights of portfolio</p>
<h2>Returns</h2>
<p>Returns "True" if the weights fail the min_sum constraint. Called by rp_transform. see rp_transform.</p>
<h2>See Also</h2>
<p>fn_map, rp_transform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.min_sum_fail', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.min_sum_fail" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">min_sum_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    it is used by rp_transform as a helper function to test if min_sum constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test the list of weights</span>
<span class="sd">    min_sum : float, optional</span>
<span class="sd">        max_sum of the weights of portfolio</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the min_sum constraint. Called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fn_map, rp_transform</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="n">min_sum</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>       
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.minmax_objective">
    <p>def <span class="ident">minmax_objective</span>(</p><p>name, minimum, maximum, multiplier=1, arguments=None, target=None, enabled=True)</p>
    </div>
    

    
  
    <div class="desc"><p>This target allows to determine min and max goals.
Constructor for the tmp_minmax_objective.</p>
<h2>Parameters</h2>
<p>name : str,
    The target name should correspond to a feature, although we will attempt to make allowances.
minimum : float,
    minimum value
maximum : float,
    maximum value
multiplier : int, optional
    Multiplier to be added to the target, typically 1 or -1.
arguments : dict,
    Default arguments to be transferred when executed on an objective function.
target : float,
    Univariate goal for the target.
enabled : bool, default = True
    bool to enable or disable constraints.</p>
<h2>Returns</h2>
<p>Adds minmax_objective to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_objectives
portfolio_risk_objectives
risk_budget_objective
turnover_objective
minmax_objective
weight_constraint_objective</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'risk', name = 'std', target = 0.015)
NOTE: you can add other custom function in other kind of objective in similar methd. See add_objective</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.minmax_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.minmax_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">minmax_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This target allows to determine min and max goals.</span>
<span class="sd">    Constructor for the tmp_minmax_objective.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances.</span>
<span class="sd">    minimum : float,</span>
<span class="sd">        minimum value</span>
<span class="sd">    maximum : float,</span>
<span class="sd">        maximum value</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    arguments : dict,</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds minmax_objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    NOTE: you can add other custom function in other kind of objective in similar methd. See add_objective</span>


<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.normalize_weights">
    <p>def <span class="ident">normalize_weights</span>(</p><p>weights)</p>
    </div>
    

    
  
    <div class="desc"><p>Add a constraint in portfolio_spec object</p>
<p>Main function to add or update constraint in portfolio_spec object</p>
<h2>Parameters</h2>
<p>weights : array-like,
    list of weights to normalize based on constraints.</p>
<h2>Returns</h2>
<p>Returns array of normalized weights. Called be optimize_portfolio when optimize_method is:
'pso', 'dual_annealing', 'shgo', 'basinhopping', 'brute'.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.normalize_weights', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.normalize_weights" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        list of weights to normalize based on constraints.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns array of normalized weights. Called be optimize_portfolio when optimize_method is:</span>
<span class="sd">    &#39;pso&#39;, &#39;dual_annealing&#39;, &#39;shgo&#39;, &#39;basinhopping&#39;, &#39;brute&#39;.</span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
    <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>    
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.optimize_portfolio">
    <p>def <span class="ident">optimize_portfolio</span>(</p><p>R, portfolio=None, constraints=None, objectives=None, optimize_method=[&#39;pso&#39;, &#39;DEoptim&#39;, &#39;dual_annealing&#39;, &#39;brute&#39;, &#39;shgo&#39;, &#39;basinhopping&#39;, &#39;best&#39;], search_size=20000, trace=False, message=False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>This function is calls the portfolio to optimize the weights given the constrained and objectives of portfolio
provided using add_constraint and add_objective functions.</p>
<p>Main function to optimize portfolio weights given the constraints and objectives</p>
<h2>Parameters</h2>
<p>R : pandas dataframe,
    dataframe of the series of returns
portfolio : portfolio_spec,
    an object of class portfolio_spec. 
constraints : dict, optional
    constraints to be minimized/maximized given the assets. 
    Although they are automatically called if portfolio_spec object has constraints specified
objectives : dict, optional
    objectives to be minimized/maximized given the assets. 
    Although they are automatically called if portfolio_spec object has objectives specified
optimize_method : float,
    the method for optimizing portfolio. currently supported methods are:
    'pso'
    'DEoptim'
    'dual_annealing'
    'brute'
    'shgo'
    'basinhopping'</p>
<div class="codehilite"><pre><span></span>User can also specify &#39;best&#39; as optimize_method to use all optimizer and choose the best among them.
</pre></div>


<p>search_size: int, optional
    specify th iterations to do before calling the best portfolio  <br />
trace : bool, default = False
    bool to enable or disable trace of portfolio.
message : bool, default = False
    bool to enable or disable messages.
kwargs : additional key word arguments, optional
    any additional constraint argument to be passed.</p>
<h2>Returns</h2>
<p>returns the optimal weights, objective measure, value of the best optimization (out). automatically adds weights
to the portfolio_spec objects.</p>
<h2>See Also</h2>
<p>portfolio_spec
add_constraint
add_objective</p>
<h2>Notes</h2>
<p>currently suuported optimization methods are:
    'pso'
    'DEoptim'
    'dual_annealing'
    'brute'
    'shgo'
    'basinhopping'</p>
<p>The function calls constrained_objective to minimize the penalty (default = 10000) to come to a solution.
the purpose of adding different optimization method is to give flexibility to user to choose optimizer based on
specific problem.</p>
<p>Additional arguments can be specified such as maxiter, disp and other controls. the argument names are similar in
scipy.optimize.[optimizer] or pyswarms. see scipy and pyswarm documentation.</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'return', name = 'mean', target = 0.0018)
add_objective(kind = 'portfolio_risk', name = 'std', target = 0.015)
add_objective(kind = 'risk_budget', name = 'risk_budget')
add_objective(kind = 'weight_conc', name = 'HHI', target = 0.11)
add_objective(kind = 'performance_metrics', name = 'sharpe', target = 0.13)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
        #SOME CODE
add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
NOTE: The output of sortino_ratio or other custom function in objective must be a float.
NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
<p>optimize_portfolio(R, port, optimize_method  = 'DEoptim', disp = False, search_size = 30000)
NOTE: Yout can provide addional adguments based on solver. See the solver documentation for more information.</p>
<h1>we have used scipy.optimize for most of the solver and pyswarms for 'pso' method.</h1>
<p>optimize_portfolio(R, port, optimize_method  = 'best', disp = False, maxiter = 1000)
NOTE: 'best' optimize_method takes a while to give ouput because it uses all other optimizers.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.optimize_portfolio', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.optimize_portfolio" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">objectives</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                       <span class="n">optimize_method</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pso&#39;</span><span class="p">,</span> <span class="s1">&#39;DEoptim&#39;</span><span class="p">,</span> <span class="s1">&#39;dual_annealing&#39;</span><span class="p">,</span> <span class="s1">&#39;brute&#39;</span><span class="p">,</span> <span class="s1">&#39;shgo&#39;</span><span class="p">,</span><span class="s1">&#39;basinhopping&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">],</span> 
                       <span class="n">search_size</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is calls the portfolio to optimize the weights given the constrained and objectives of portfolio</span>
<span class="sd">    provided using add_constraint and add_objective functions.</span>
<span class="sd">    </span>
<span class="sd">    Main function to optimize portfolio weights given the constraints and objectives</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pandas dataframe,</span>
<span class="sd">        dataframe of the series of returns</span>
<span class="sd">    portfolio : portfolio_spec,</span>
<span class="sd">        an object of class portfolio_spec. </span>
<span class="sd">    constraints : dict, optional</span>
<span class="sd">        constraints to be minimized/maximized given the assets. </span>
<span class="sd">        Although they are automatically called if portfolio_spec object has constraints specified</span>
<span class="sd">    objectives : dict, optional</span>
<span class="sd">        objectives to be minimized/maximized given the assets. </span>
<span class="sd">        Although they are automatically called if portfolio_spec object has objectives specified</span>
<span class="sd">    optimize_method : float,</span>
<span class="sd">        the method for optimizing portfolio. currently supported methods are:</span>
<span class="sd">        &#39;pso&#39;</span>
<span class="sd">        &#39;DEoptim&#39;</span>
<span class="sd">        &#39;dual_annealing&#39;</span>
<span class="sd">        &#39;brute&#39;</span>
<span class="sd">        &#39;shgo&#39;</span>
<span class="sd">        &#39;basinhopping&#39;</span>
<span class="sd">        </span>
<span class="sd">        User can also specify &#39;best&#39; as optimize_method to use all optimizer and choose the best among them.</span>
<span class="sd">    search_size: int, optional</span>
<span class="sd">        specify th iterations to do before calling the best portfolio    </span>
<span class="sd">    trace : bool, default = False</span>
<span class="sd">        bool to enable or disable trace of portfolio.</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or disable messages.</span>
<span class="sd">    kwargs : additional key word arguments, optional</span>
<span class="sd">        any additional constraint argument to be passed.</span>
<span class="sd"> </span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the optimal weights, objective measure, value of the best optimization (out). automatically adds weights</span>
<span class="sd">    to the portfolio_spec objects.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    add_constraint</span>
<span class="sd">    add_objective</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    currently suuported optimization methods are:</span>
<span class="sd">        &#39;pso&#39;</span>
<span class="sd">        &#39;DEoptim&#39;</span>
<span class="sd">        &#39;dual_annealing&#39;</span>
<span class="sd">        &#39;brute&#39;</span>
<span class="sd">        &#39;shgo&#39;</span>
<span class="sd">        &#39;basinhopping&#39;</span>
<span class="sd">        </span>
<span class="sd">    The function calls constrained_objective to minimize the penalty (default = 10000) to come to a solution.</span>
<span class="sd">    the purpose of adding different optimization method is to give flexibility to user to choose optimizer based on</span>
<span class="sd">    specific problem.</span>
<span class="sd">    </span>
<span class="sd">    Additional arguments can be specified such as maxiter, disp and other controls. the argument names are similar in</span>
<span class="sd">    scipy.optimize.[optimizer] or pyswarms. see scipy and pyswarm documentation.</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;return&#39;, name = &#39;mean&#39;, target = 0.0018)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;portfolio_risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk_budget&#39;, name = &#39;risk_budget&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>

<span class="sd">    &gt;&gt;&gt; optimize_portfolio(R, port, optimize_method  = &#39;DEoptim&#39;, disp = False, search_size = 30000)</span>
<span class="sd">    NOTE: Yout can provide addional adguments based on solver. See the solver documentation for more information.</span>
<span class="sd">    &gt;&gt;&gt; # we have used scipy.optimize for most of the solver and pyswarms for &#39;pso&#39; method.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; optimize_portfolio(R, port, optimize_method  = &#39;best&#39;, disp = False, maxiter = 1000)</span>
<span class="sd">    NOTE: &#39;best&#39; optimize_method takes a while to give ouput because it uses all other optimizers.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>



    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">n_porf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
        <span class="n">out_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_porf</span>
        <span class="n">portfolio_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;portfolio&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_porf</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_porf</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting optimization of: portfolio </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">out_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">constraints</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">,</span> 
                                            <span class="n">objectives</span> <span class="o">=</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize_method</span><span class="p">,</span> 
                                        <span class="n">search_size</span> <span class="o">=</span> <span class="n">search_size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">portfolio_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;portfolio&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">portfolio_name</span><span class="p">,</span> <span class="n">out_list</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize_method</span>
    <span class="n">tmpt_trace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">portfolio</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must specify a portfolio&#39;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">&gt;</span><span class="n">N</span><span class="p">:</span>
        <span class="n">R</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
    
    
    <span class="c1">#Extra (test required)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="n">constraints</span>
        <span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="n">objectives</span>
        
        
        
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">get_constraints</span><span class="p">(</span><span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">max_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;max_sum&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">:</span>
                    <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">min_sum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;weight_sum&#39;</span><span class="p">][</span><span class="s1">&#39;min_sum&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span><span class="p">:</span>
                    <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_sum</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
        <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;DEoptim&#39;</span><span class="p">:</span>
        <span class="c1">#customize later !!!! add parallel support</span>
        
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strategy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;strategy&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="s1">&#39;currenttobest1bin&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxiter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workers&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>
        
        
        <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        <span class="n">NP</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">search_size</span><span class="o">/</span><span class="n">maxiter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NP</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">NP</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="n">NP</span> <span class="o">=</span> <span class="mi">2000</span>
        <span class="k">if</span> <span class="n">maxiter</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">popsize</span> <span class="o">=</span> <span class="n">NP</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>


        <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
                <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn_map</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">differential_evolution</span><span class="p">,</span> <span class="n">Bounds</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">Bounds</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">differential_evolution</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">popsize</span> <span class="o">=</span> <span class="n">NP</span><span class="p">,</span>
                                        <span class="n">init</span> <span class="o">=</span> <span class="n">init</span><span class="p">,</span> <span class="n">maxiter</span> <span class="o">=</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span><span class="p">,</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">workers</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>
       
        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>
                        
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;pso&#39;</span><span class="p">:</span>
        
        <span class="c1">#inputs Update customizations of *args</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_particles&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_particles&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;options argument must be a dictionary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_processes&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_processes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="kc">None</span>
        
        
        
        
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            
            
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
        
        
        
        
        <span class="c1">#Test of init</span>
        <span class="n">NP</span> <span class="o">=</span> <span class="n">n_particles</span>
        <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
                <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn_map</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
            
        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="c1">#Process</span>
        
        <span class="kn">from</span> <span class="nn">pyswarms.single.global_best</span> <span class="kn">import</span> <span class="n">GlobalBestPSO</span>
        
        
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">GlobalBestPSO</span><span class="p">(</span><span class="n">n_particles</span><span class="o">=</span><span class="n">n_particles</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                 <span class="n">init_pos</span> <span class="o">=</span> <span class="n">init</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="p">[</span><span class="n">constrained_objective</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_particles</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>


        <span class="c1">#Runn</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">iters</span> <span class="o">=</span> <span class="n">iters</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">n_processes</span> <span class="o">=</span> <span class="n">n_processes</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">best</span> <span class="o">=</span> <span class="n">minw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">weights</span><span class="o">=</span> <span class="n">minw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">best</span><span class="p">}]</span>         
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;dual_annealing&#39;</span><span class="p">:</span>
        
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxiter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="mi">5230</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;visit&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;visit&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="mf">2.62</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;accept&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="kc">False</span>
        
        
        
        
        <span class="n">NP</span> <span class="o">=</span> <span class="n">maxiter</span>
        
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>


        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">dual_annealing</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>

        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">dual_annealing</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> 
                                            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">initial_temp</span> <span class="o">=</span> <span class="n">initial_temp</span><span class="p">,</span> 
                                 <span class="n">visit</span> <span class="o">=</span> <span class="n">visit</span><span class="p">,</span> <span class="n">accept</span> <span class="o">=</span> <span class="n">accept</span><span class="p">,</span> <span class="n">no_local_search</span> <span class="o">=</span> <span class="n">no_local_search</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>



        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>
            
            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>
            
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            
            
      <span class="c1">#Brute      </span>
            
            
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;brute&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ns&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ns&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workers&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>



        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>




        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">brute</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">brute</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> 
                <span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span> <span class="n">workers</span><span class="p">,</span> <span class="n">full_output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="p">[</span><span class="mi">1</span><span class="p">]}]</span>

            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;shgo&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="s1">&#39;simplicial&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;options argument must be a dictionary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sobol&#39;</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>





        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>




        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">shgo</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">shgo</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">,</span> 
                <span class="n">iters</span> <span class="o">=</span> <span class="n">iters_shgo</span><span class="p">,</span> <span class="n">sampling_method</span> <span class="o">=</span> <span class="n">sampling_method</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">normalize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>

            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;basinhopping&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;niter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_only&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;minimum&#39;</span><span class="p">]</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;long_only&#39;</span><span class="p">][</span><span class="s1">&#39;maximum&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>
            <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">))</span>

        <span class="n">NP</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">init</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">NP</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,)</span>



        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span><span class="p">)):</span>
                <span class="n">sw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">maximum</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NP</span><span class="p">):</span>
            <span class="n">init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn_map</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">portfolio</span><span class="p">)[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">basinhopping</span><span class="p">,</span> <span class="n">Bounds</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="p">[</span><span class="n">constrained_objective</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_particles</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>




        <span class="k">try</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="n">basinhopping</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">,</span> <span class="n">x0</span> <span class="o">=</span> <span class="n">init</span><span class="p">,</span> <span class="n">niter</span> <span class="o">=</span> <span class="n">niter</span><span class="p">,</span> <span class="n">minimizer_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;args&#39;</span><span class="p">:</span><span class="n">arguments</span><span class="p">},</span>
                                        <span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">minw</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or checkdata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">minw</span><span class="o">.</span><span class="n">x</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">objectives</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="n">constrained_objective</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span> <span class="o">=</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">trace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_vals</span> <span class="o">=</span> <span class="s1">&#39;No Objectives&#39;</span>

            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">assets</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">assetnames</span><span class="p">,</span> <span class="n">weights</span><span class="p">))},</span> <span class="p">{</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">:</span><span class="n">obj_vals</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;best&#39;</span><span class="p">:</span><span class="n">minw</span><span class="o">.</span><span class="n">fun</span><span class="p">}]</span>

            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="n">obj_vals</span>
            <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    
        
        

    <span class="k">if</span> <span class="n">optimize_method</span> <span class="o">==</span> <span class="s1">&#39;best&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strategy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;strategy&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="s1">&#39;currenttobest1bin&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maxiter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxiter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;workers&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="c1">#inputs Update customizations of *args</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_particles&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_particles&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_particles</span> <span class="o">=</span> <span class="mi">100</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_processes&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n_processes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_processes</span> <span class="o">=</span> <span class="kc">None</span>

      
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initial_temp&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_temp</span> <span class="o">=</span> <span class="mi">5230</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;visit&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;visit&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="mf">2.62</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;accept&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;no_local_search&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">no_local_search</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ns&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ns&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ns</span> <span class="o">=</span> <span class="mi">5</span>
       
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;iters_shgo&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iters_shgo</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sampling_method</span> <span class="o">=</span> <span class="s1">&#39;simplicial&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;options argument must be a dictionary&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampling_method&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sobol&#39;</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;niter&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;niter&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">niter</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="mi">50</span>



        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This may take a will as it will optimize weights sequentially across all optimizers&#39;</span><span class="p">)</span>
        
        <span class="n">optimizer</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DEoptim&#39;</span><span class="p">,</span> <span class="s1">&#39;pso&#39;</span><span class="p">,</span> <span class="s1">&#39;dual_annealing&#39;</span><span class="p">,</span> <span class="s1">&#39;brute&#39;</span><span class="p">,</span> <span class="s1">&#39;shgo&#39;</span><span class="p">,</span> <span class="s1">&#39;basinhopping&#39;</span><span class="p">]</span>
        <span class="n">tmp_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">optimize</span> <span class="ow">in</span> <span class="n">optimizer</span><span class="p">:</span>
            <span class="n">tmp_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimize_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">optimize_method</span> <span class="o">=</span> <span class="n">optimize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">best_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)):</span>
            <span class="n">best_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tmp_out</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">best_vals</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>
            
            
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;optimizer did not find any solution, trying relaxing constraints or check data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best optimizer was: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">best_vals</span><span class="p">))]))</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
            <span class="n">portfolio</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> 
            <span class="n">portfolio</span><span class="o">.</span><span class="n">objecitve_measures</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;objective_measures&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.performance_metrics_objective">
    <p>def <span class="ident">performance_metrics_objective</span>(</p><p>name, arguments, target=None, multiplier=1, enabled=True)</p>
    </div>
    

    
  
    <div class="desc"><p>We'll try minimizing the performance_metric if the target is null.  <br />
Constructor for the portfolio_risk_objective class.</p>
<h2>Parameters</h2>
<p>name : str,
    The target name should correspond to a feature, although we will attempt to make allowances
target : float,
    Univariate goal for the target.
arguments : dict, optional
    Default arguments to be transferred when executed on an objective function.
multiplier : int, optional
    Multiplier to be added to the target, typically 1 or -1.
enabled : bool, default = True
    bool to enable or disable constraints.</p>
<h2>Returns</h2>
<p>Adds portfolio risk objectives to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_objectives
portfolio_risk_objectives
risk_budget_objective
turnover_objective
minmax_objective
weight_constraint_objective</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'performance_metrics', name = 'sharpe', target = 0.13)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
        #SOME CODE</p>
<p>add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
NOTE: The output of sortino_ratio or other custom function in objective must be a float.
NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.performance_metrics_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.performance_metrics_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">performance_metrics_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    We&#39;ll try minimizing the performance_metric if the target is null.    </span>
<span class="sd">    Constructor for the portfolio_risk_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds portfolio risk objectives to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">            </span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>


<span class="sd">&quot;&quot;&quot;</span>


    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.port_mean">
    <p>def <span class="ident">port_mean</span>(</p><p>weights, mu)</p>
    </div>
    

    
  
    <div class="desc"><p>Add a constraint in portfolio_spec object
Main function to add or update constraint in portfolio_spec object</p>
<h2>Parameters</h2>
<p>weights : array-like,
    weights of the portfolio.
mu : array-like,
    mean return of assets</p>
<h2>Returns</h2>
<p>Adds port mean to object portfolio_spec of the specified input. </p>
<h2>Notes</h2>
<p>\mu_{p} = w . \mu_{r}</p>
<h2>See Also</h2>
<p>var_portfolio
VaR
cVaR</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>calculate the portfolio mean return</h1>
<p>w = [0.2,0.3,-0.1,0.6,0.8]
port_mean(w,R)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.port_mean', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.port_mean" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">port_mean</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Add a constraint in portfolio_spec object</span>
<span class="sd">    Main function to add or update constraint in portfolio_spec object</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        weights of the portfolio.</span>
<span class="sd">    mu : array-like,</span>
<span class="sd">        mean return of assets</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds port mean to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    \mu_{p} = w . \mu_{r}</span>


<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    var_portfolio</span>
<span class="sd">    VaR</span>
<span class="sd">    cVaR</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #calculate the portfolio mean return</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,-0.1,0.6,0.8]</span>
<span class="sd">    &gt;&gt;&gt; port_mean(w,R)</span>


<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">mu</span><span class="p">))))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_risk_objective">
    <p>def <span class="ident">portfolio_risk_objective</span>(</p><p>name, target, arguments, multiplier=-1, enabled=True)</p>
    </div>
    

    
  
    <div class="desc"><p>We'll try minimizing the risk metric if the target is null.  <br />
Constructor for the portfolio_risk_objective class.</p>
<h2>Parameters</h2>
<p>name : str,
    The target name should correspond to a feature, although we will attempt to make allowances
target : float,
    Univariate goal for the target.
arguments : dict, optional
    Default arguments to be transferred when executed on an objective function.
multiplier : int, optional
    Multiplier to be added to the target, typically 1 or -1.
enabled : bool, default = True
    bool to enable or disable constraints.</p>
<h2>Returns</h2>
<p>Adds portfolio risk objectives to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_objectives
portfolio_risk_objectives
risk_budget_objective
turnover_objective
minmax_objective
weight_constraint_objective</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'portfolio_risk', name = 'std', target = 0.015)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
        #SOME CODE
add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
NOTE: The output of sortino_ratio or other custom function in objective must be a float.
NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_risk_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_risk_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">portfolio_risk_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We&#39;ll try minimizing the risk metric if the target is null.    </span>
<span class="sd">    Constructor for the portfolio_risk_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds portfolio risk objectives to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;portfolio_risk&#39;, name = &#39;std&#39;, target = 0.015)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>

<span class="sd">   </span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.pos_limit_fail">
    <p>def <span class="ident">pos_limit_fail</span>(</p><p>weights, max_pos=None, max_pos_long=None, max_pos_short=None)</p>
    </div>
    

    
  
    <div class="desc"><p>This is used as a rp_transform helper function to search for position limit constraints being violated.       </p>
<h2>Parameters</h2>
<p>weights : array-like,
    test list of weights.
max_pos : int, optional
    maximum number of non-zero-weighted assets
max_pos_long : int, optional
    maximum number of long-position assets
max_pos_short : int, optional
    maximum number of short-position assets</p>
<h2>Returns</h2>
<p>Returns "True" if the weights fail the pos_limit constraint. called by rp_transform. see rp_transform.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.pos_limit_fail', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.pos_limit_fail" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pos_limit_fail</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    This is used as a rp_transform helper function to search for position limit constraints being violated.       </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test list of weights.</span>
<span class="sd">    max_pos : int, optional</span>
<span class="sd">        maximum number of non-zero-weighted assets</span>
<span class="sd">    max_pos_long : int, optional</span>
<span class="sd">        maximum number of long-position assets</span>
<span class="sd">    max_pos_short : int, optional</span>
<span class="sd">        maximum number of short-position assets</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Returns &quot;True&quot; if the weights fail the pos_limit constraint. called by rp_transform. see rp_transform.</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_pos</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_pos_long</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tolerance</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">max_pos_short</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.position_limit_constraint">
    <p>def <span class="ident">position_limit_constraint</span>(</p><p>assets, max_pos=None, kind=&#39;position&#39;, max_pos_long=None, max_pos_short=None, enabled=True, message=True)</p>
    </div>
    

    
  
    <div class="desc"><p>When type=”position_limit” is mentioned, this function is called by add.constraint. </p>
<div class="codehilite"><pre><span></span><span class="n">The</span> <span class="n">maximum</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">positions</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">the</span> <span class="n">maximum</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">long</span> <span class="k">and</span> <span class="n">short</span> <span class="n">positions</span>
<span class="k">are</span> <span class="n">determined</span> <span class="k">by</span> <span class="n">the</span> <span class="k">user</span> <span class="k">using</span> <span class="n">this</span> <span class="k">function</span><span class="p">.</span>

<span class="k">Parameters</span>
<span class="c1">----------</span>
<span class="n">assets</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="k">or</span> <span class="nb">array</span><span class="o">-</span><span class="k">like</span><span class="p">,</span>
        <span class="n">named</span> <span class="n">list</span> <span class="k">of</span> <span class="n">assets</span> <span class="n">determining</span> <span class="n">initial</span> <span class="n">weights</span><span class="p">.</span>
<span class="n">max_pos</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">maximum</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">assets</span> <span class="k">with</span> <span class="n">non</span><span class="o">-</span><span class="n">zero</span> <span class="n">weights</span><span class="p">.</span>
<span class="n">kind</span> <span class="p">:</span> <span class="n">str</span><span class="p">,</span>
        <span class="n">string</span> <span class="k">of</span> <span class="n">kind</span> <span class="k">of</span> <span class="k">constraint</span>
<span class="n">max_pos_long</span> <span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">optional</span>
        <span class="n">maximum</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">assets</span> <span class="k">with</span> <span class="n">long</span> <span class="n">positions</span><span class="p">.</span>
<span class="n">max_pos_short</span> <span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">optional</span>
        <span class="n">maximum</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">assets</span> <span class="k">with</span> <span class="n">short</span> <span class="n">positions</span><span class="p">.</span>
<span class="n">enabled</span> <span class="p">:</span> <span class="n">bool</span><span class="p">,</span> <span class="k">default</span> <span class="o">=</span> <span class="k">True</span>
        <span class="n">bool</span> <span class="k">to</span> <span class="n">enable</span> <span class="k">or</span> <span class="n">disable</span> <span class="k">constraints</span><span class="p">.</span>
<span class="n">message</span> <span class="p">:</span> <span class="n">bool</span><span class="p">,</span> <span class="k">default</span> <span class="o">=</span> <span class="k">True</span>
        <span class="n">bool</span> <span class="k">to</span> <span class="n">enable</span> <span class="k">or</span> <span class="n">disable</span> <span class="n">messages</span><span class="p">.</span>


<span class="k">Returns</span>
<span class="c1">-------</span>
<span class="n">Adds</span> <span class="n">position_limit</span> <span class="k">constraints</span> <span class="k">to</span> <span class="k">object</span> <span class="n">portfolio_spec</span> <span class="k">of</span> <span class="n">the</span> <span class="n">specified</span> <span class="k">input</span><span class="p">.</span>

<span class="n">See</span> <span class="n">Also</span>
<span class="c1">--------</span>
<span class="n">add_constraints</span>
<span class="n">box_constraints</span>
<span class="n">group_constraints</span>
<span class="n">weight_sum_constraint</span>
<span class="n">turnover_constraint</span>
<span class="n">diversification_constraint</span>
<span class="n">position_limit_constraint</span>
<span class="n">return_constraint</span>
<span class="n">factor_exposure_constraint</span>
<span class="n">transaction_cost_constraint</span>
<span class="n">leverage_exposure_constraint</span>


<span class="n">Examples</span>
<span class="c1">--------</span>
</pre></div>


<blockquote>
<blockquote>
<blockquote>
<h1>position_limit is a constraint to restrict max position and also max long/short positions</h1>
<p>add_constraint(portfolio, kind = 'position_limit', max_pos = 3, max_pos_long = 2, max_pos_short = 2)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.position_limit_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.position_limit_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">position_limit_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span>  <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                              <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    When type=”position_limit” is mentioned, this function is called by add.constraint. </span>

<span class="sd">    The maximum number of positions as well as the maximum number of long and short positions</span>
<span class="sd">    are determined by the user using this function.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            named list of assets determining initial weights.</span>
<span class="sd">    max_pos : int,</span>
<span class="sd">            maximum number of assets with non-zero weights.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraint</span>
<span class="sd">    max_pos_long : Int, optional</span>
<span class="sd">            maximum number of assets with long positions.</span>
<span class="sd">    max_pos_short : Int, optional</span>
<span class="sd">            maximum number of assets with short positions.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds position_limit constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">&gt;&gt;&gt; #position_limit is a constraint to restrict max position and also max long/short positions</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio, kind = &#39;position_limit&#39;, max_pos = 3, max_pos_long = 2, max_pos_short = 2)</span>

<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>


    
    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_pos</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;max_pos must be of type int&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos must a positive number&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos</span> <span class="o">&gt;</span> <span class="n">nassets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos must be less than or equal to number of assets&#39;</span><span class="p">)</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="n">nassets</span>
    <span class="n">max_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pos</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_pos_long</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;max_pos_long must be of type int&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_long</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_long must a positive number&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_long</span> <span class="o">&gt;</span> <span class="n">nassets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_long must be less than or equal to number of assets&#39;</span><span class="p">)</span>
        <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">nassets</span>
    <span class="n">max_pos_long</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pos_long</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_pos_short</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;max_pos_short must be of type int&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_short</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_short must a positive number&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_pos_short</span> <span class="o">&gt;</span> <span class="n">nassets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_pos_short must be less than or equal to number of assets&#39;</span><span class="p">)</span>
        <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">nassets</span>
    <span class="n">max_pos_short</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_pos_short</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;max_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_long&#39;</span><span class="p">,</span> <span class="s1">&#39;max_pos_short&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.return_constraint">
    <p>def <span class="ident">return_constraint</span>(</p><p>assets, return_target, kind=&#39;return&#39;, enabled=True, message=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Target mean return value is determined by the return constraint. 
When type=”return” is mentioned, this function is called by add_constraint.</p>
<h2>Parameters</h2>
<p>assets :. int, or array-like,
        named list of assets determining initial weights.
kind : str,
        string of kind of constraints.  <br />
enabled : bool, default = True
        bool to enable or disable constraints.
messages : bool, default = False
        bool to enable or disable messages.</p>
<h2>Returns</h2>
<p>Adds return constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>return constraint to add a target mean historical return to the portfolio</h1>
<p>add_constraint(portfolio, kind = 'return', return_target = 0.0018)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.return_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.return_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">return_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span>  <span class="n">return_target</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;return&#39;</span><span class="p">,</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Target mean return value is determined by the return constraint. </span>
<span class="sd">    When type=”return” is mentioned, this function is called by add_constraint.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets :. int, or array-like,</span>
<span class="sd">            named list of assets determining initial weights.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraints.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    messages : bool, default = False</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds return constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">  </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #return constraint to add a target mean historical return to the portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;return&#39;, return_target = 0.0018)</span>


<span class="sd">&quot;&quot;&quot;</span>



    
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;return_target&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">return_target</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.return_objective">
    <p>def <span class="ident">return_objective</span>(</p><p>name, target, arguments, multiplier=-1, enabled=True)</p>
    </div>
    

    
  
    <div class="desc"><p>We'll try minimizing the risk metric if the target is null.  <br />
Constructor for the portfolio_risk_objective class.</p>
<h2>Parameters</h2>
<p>name : str,
    The target name should correspond to a feature, although we will attempt to make allowances
target : float,
    Univariate goal for the target.
arguments : dict, optional
    Default arguments to be transferred when executed on an objective function.
multiplier : int, optional
    Multiplier to be added to the target, typically 1 or -1.
enabled : bool, default = True
    bool to enable or disable constraints.</p>
<h2>Returns</h2>
<p>Adds return_objective to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_objectives
portfolio_risk_objectives
risk_budget_objective
turnover_objective
minmax_objective
weight_constraint_objective</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'return', name = 'mean', target = 0.0018)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
        #SOME CODE
add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
NOTE: The output of sortino_ratio or other custom function in objective must be a float.
NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.return_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.return_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">return_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    We&#39;ll try minimizing the risk metric if the target is null.    </span>
<span class="sd">    Constructor for the portfolio_risk_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds return_objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;return&#39;, name = &#39;mean&#39;, target = 0.0018)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>




<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.risk_budget_objective">
    <p>def <span class="ident">risk_budget_objective</span>(</p><p>assets, name, min_prisk=None, max_prisk=None, target=None, arguments=None, multiplier=1, enabled=True, min_concentration=False, min_difference=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Constructor for the risk_budget_objective.</p>
<p>Parameters</p>
<hr />
<p>assets : int, or array-like,
     The asset list to be used should come from object constraints.
 name : str,
     The target name should correspond to a feature, although we will attempt to make allowances.
 min_prisk : float,
     minimum percentage risk contribution
 max_prisk : float,
     maximum percentage risk contribution
 arguments : dict, optional
     Default arguments to be transferred when executed on an objective function.
 multiplier : int, optional
     Multiplier to be added to the target, typically 1 or -1.</p>
<p>Returns</p>
<hr />
<p>Adds risk budget objective to object portfolio_spec of the specified input. </p>
<p>See Also</p>
<hr />
<p>add_objectives
 portfolio_risk_objectives
 risk_budget_objective
 turnover_objective
 minmax_objective
 weight_constraint_objective</p>
<p>Examples</p>
<hr />
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
     'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
     'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'risk_budget', name = 'risk_budget')
add_objective(kind = 'weight_conc', name = 'HHI', target = 0.11)
add_objective(kind = 'performance_metrics', name = 'sharpe', target = 0.13)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
         #SOME CODE
add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
 NOTE: The output of sortino_ratio or other custom function in objective must be a float.
 NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.risk_budget_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.risk_budget_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">risk_budget_objective</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">min_prisk</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_prisk</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">min_concentration</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">min_difference</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Constructor for the risk_budget_objective.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">        The asset list to be used should come from object constraints.</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances.</span>
<span class="sd">    min_prisk : float,</span>
<span class="sd">        minimum percentage risk contribution</span>
<span class="sd">    max_prisk : float,</span>
<span class="sd">        maximum percentage risk contribution</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds risk budget objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">    </span>
<span class="sd">   Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;risk_budget&#39;, name = &#39;risk_budget&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>




<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arguments</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;portfolio_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;component&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(min_prisk) must equal len(max_prisk)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">min_prisk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">min_prisk</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">max_prisk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">max_prisk</span><span class="p">,</span> <span class="n">nassets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">min_prisk</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_prisk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_concentration</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;min_prisk&#39;</span><span class="p">,</span> <span class="s1">&#39;max_prisk&#39;</span><span class="p">,</span> <span class="s1">&#39;min_concentration&#39;</span><span class="p">,</span> <span class="s1">&#39;min_difference&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">min_prisk</span><span class="p">,</span> <span class="n">max_prisk</span><span class="p">,</span> <span class="n">min_concentration</span><span class="p">,</span> <span class="n">min_difference</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">obj</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease">
    <p>def <span class="ident">rp_decrease</span>(</p><p>weights, max_sum, min_box, weight_seq)</p>
    </div>
    

    
  
    <div class="desc"><p>It is used by rp_transform as a helper function to reduce weights if 
max_sum or min_box constraint is breached.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    test of list of weights
max_sum : float,
    maximum sum of weights
min_box : array-like,
    minimum of individual weights in a portfolio
weight_seq : seq,
    sequence of random weights to choose from</p>
<h2>Returns</h2>
<p>returns an array of weights that satisfy the max_sum and min_box constraint. called by rp_transform.</p>
<h2>See Also</h2>
<p>rp_increase
rp_transform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rp_decrease</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to reduce weights if </span>
<span class="sd">    max_sum or min_box constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    max_sum : float,</span>
<span class="sd">        maximum sum of weights</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the max_sum and min_box constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_sum</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_weights</span><span class="p">):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&lt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">&gt;=</span> 
        <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease_leverage">
    <p>def <span class="ident">rp_decrease_leverage</span>(</p><p>weights, max_box, min_box, leverage, weight_seq)</p>
    </div>
    

    
  
    <div class="desc"><p>It is used by rp_transform as a helper function to redcrese leverage if 
leverage_exposure constraint is breached.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    test of list of weights
max_box : array-like,
    maximum of individual weights in a portfolio
min_box : like,
    minimum of individual weights in a portfolio
leverage: float,
    leverage as specified in leverage_exposure constraints
weight_seq : seq,
    sequence of random weights to choose from</p>
<h2>Returns</h2>
<p>returns an array of weights that satisfy the leverage constraint. called by rp_transform.</p>
<h2>See Also</h2>
<p>rp_increase
rp_transform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease_leverage', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_decrease_leverage" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rp_decrease_leverage</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">leverage</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to redcrese leverage if </span>
<span class="sd">    leverage_exposure constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    max_box : array-like,</span>
<span class="sd">        maximum of individual weights in a portfolio</span>
<span class="sd">    min_box : like,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    leverage: float,</span>
<span class="sd">        leverage as specified in leverage_exposure constraints</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the leverage constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="n">leverage</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="n">tmp_seq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">cur_val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&gt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&lt;=</span> <span class="n">max_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="k">elif</span> <span class="n">cur_val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&lt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&gt;=</span> 
        <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.rp_increase">
    <p>def <span class="ident">rp_increase</span>(</p><p>weights, min_sum, max_box, weight_seq)</p>
    </div>
    

    
  
    <div class="desc"><p>It is used by rp_transform as a helper function to increase weights if 
min_sum or max_box constraint is breached.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    test of list of weights
max_sum : float,
    maximum sum of weights
min_box : float,
    minimum of individual weights in a portfolio
weight_seq : seq,
    sequence of random weights to choose from</p>
<h2>Returns</h2>
<p>returns an array of weights that satisfy the max_sum and min_box constraint. called by rp_transform.</p>
<h2>See Also</h2>
<p>rp_increase
rp_transform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_increase', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_increase" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rp_increase</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to increase weights if </span>
<span class="sd">    min_sum or max_box constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    max_sum : float,</span>
<span class="sd">        maximum sum of weights</span>
<span class="sd">    min_box : float,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the max_sum and min_box constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_sum</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_sum</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_weights</span><span class="p">):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="nb">any</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cur_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">&lt;=</span> 
        <span class="n">max_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
        <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.rp_position_limit">
    <p>def <span class="ident">rp_position_limit</span>(</p><p>weights, min_box, max_box, weight_seq, max_pos=None, max_pos_long=None, max_pos_short=None)</p>
    </div>
    

    
  
    <div class="desc"><p>It is used by rp_transform as a helper function to increase weights if 
position_limit constraint is breached.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    test of list of weights
min_box : array-like,
    maximum of individual weights in a portfolio
min_box : array-like,
    minimum of individual weights in a portfolio
max_pos : int, optional
    maximum position to hold in a portfolio
max_pos_long : int, optional
    maximum long position to hold in a portfolio
max_pos_short : int, optional
    maximum short position to hold in a portfolio
weight_seq : seq,
    sequence of random weights to choose from</p>
<h2>Returns</h2>
<p>returns an array of weights that satisfy the position limit constraint. called by rp_transform.</p>
<h2>See Also</h2>
<p>rp_increase
rp_transform
rp_decrease_leverage</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_position_limit', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_position_limit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rp_position_limit</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span><span class="n">min_box</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">weight_seq</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    It is used by rp_transform as a helper function to increase weights if </span>
<span class="sd">    position_limit constraint is breached.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        test of list of weights</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        maximum of individual weights in a portfolio</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        minimum of individual weights in a portfolio</span>
<span class="sd">    max_pos : int, optional</span>
<span class="sd">        maximum position to hold in a portfolio</span>
<span class="sd">    max_pos_long : int, optional</span>
<span class="sd">        maximum long position to hold in a portfolio</span>
<span class="sd">    max_pos_short : int, optional</span>
<span class="sd">        maximum short position to hold in a portfolio</span>
<span class="sd">    weight_seq : seq,</span>
<span class="sd">        sequence of random weights to choose from</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns an array of weights that satisfy the position limit constraint. called by rp_transform.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_transform</span>
<span class="sd">    rp_decrease_leverage</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">weights</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">n_weights</span><span class="p">)</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)):</span>
        <span class="n">cur_index</span> <span class="o">=</span> <span class="n">random_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cur_val</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_pos_long</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cur_val</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
                    <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&gt;=</span> <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
                    <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_pos_short</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cur_val</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
                    <span class="n">tmp_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">[(</span><span class="n">weight_seq</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">weight_seq</span> <span class="o">&lt;=</span> <span class="n">min_box</span><span class="p">[</span><span class="n">cur_index</span><span class="p">])]</span>
                    <span class="n">n_tmp_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n_tmp_seq</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_tmp_seq</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="n">n_tmp_seq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">tmp_w</span><span class="p">[</span><span class="n">cur_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp_seq</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.rp_transform">
    <p>def <span class="ident">rp_transform</span>(</p><p>w, min_sum, max_sum, min_box, max_box, groups=None, cLO=None, cUP=None, group_pos=None, max_pos=None, max_pos_long=None, max_pos_short=None, leverage=None, weight_seq=None, max_permutations=2000)</p>
    </div>
    

    
  
    <div class="desc"><p>This function is mainly used to transform weights that dont satisfy the constraints such as:
"box"
"group"
"max_pos"
"leverage_exposure"
See add_constraint for more deatils.</p>
<p>Transform a list of weights to fulfill constraints</p>
<h2>Parameters</h2>
<p>weights : array-like,
    list of weights to be transformed
min_sum : float,
    minimum total of all weights of assets, default of 0.99
max_sum : float,
    maximum total of all weights of assets, default of 1.01
min_box : array-like,
    numeric or called list defining the minimum constraints of the weight box
max_box : array-like
    numeric or called list defining the maximum constraints of the weight box
groups : dict, 
    a dictionary defining the asset groups. similar to group_constraint. see group_constraint
cLO : flaot, or array-like,
    float or list defining the minimum constraints of the weight group
cUP : float, or array-like
    float or list defining the minimum constraints of the weight group
group_pos : array-like, optional
    list that specifies the maximum number of non-zero-weight assets per group
max_pos : int,
    maximum non-zero-weight assets
max_pos_long : int
    maximum number of long (i. e. buy) position assets
max_pos_short : int,
    maximum number of short (i. e. sell) position assets
leverage : float,
    maximum exposure to leverage in which leverage is defined as sum(abs(weights))
weight_seq : seq, optional
    list of seed sequence of weights. uses generate_sequence()
max_permutations : int, optional
    integer- maximum number of iterations to try for a portfolio which is valid, default 2000</p>
<h2>Returns</h2>
<p>weights array that satisfy the constraints on portfolio</p>
<h2>See Also</h2>
<p>rp_increase
rp_decrease
fn_map</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_transform', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.rp_transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rp_transform</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
  <span class="n">cLO</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cUP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  
  <span class="n">max_pos_long</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
  <span class="n">weight_seq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is mainly used to transform weights that dont satisfy the constraints such as:</span>
<span class="sd">    &quot;box&quot;</span>
<span class="sd">    &quot;group&quot;</span>
<span class="sd">    &quot;max_pos&quot;</span>
<span class="sd">    &quot;leverage_exposure&quot;</span>
<span class="sd">    See add_constraint for more deatils.</span>
<span class="sd">    </span>
<span class="sd">    Transform a list of weights to fulfill constraints</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        list of weights to be transformed</span>
<span class="sd">    min_sum : float,</span>
<span class="sd">        minimum total of all weights of assets, default of 0.99</span>
<span class="sd">    max_sum : float,</span>
<span class="sd">        maximum total of all weights of assets, default of 1.01</span>
<span class="sd">    min_box : array-like,</span>
<span class="sd">        numeric or called list defining the minimum constraints of the weight box</span>
<span class="sd">    max_box : array-like</span>
<span class="sd">        numeric or called list defining the maximum constraints of the weight box</span>
<span class="sd">    groups : dict, </span>
<span class="sd">        a dictionary defining the asset groups. similar to group_constraint. see group_constraint</span>
<span class="sd">    cLO : flaot, or array-like,</span>
<span class="sd">        float or list defining the minimum constraints of the weight group</span>
<span class="sd">    cUP : float, or array-like</span>
<span class="sd">        float or list defining the minimum constraints of the weight group</span>
<span class="sd">    group_pos : array-like, optional</span>
<span class="sd">        list that specifies the maximum number of non-zero-weight assets per group</span>
<span class="sd">    max_pos : int,</span>
<span class="sd">        maximum non-zero-weight assets</span>
<span class="sd">    max_pos_long : int</span>
<span class="sd">        maximum number of long (i. e. buy) position assets</span>
<span class="sd">    max_pos_short : int,</span>
<span class="sd">        maximum number of short (i. e. sell) position assets</span>
<span class="sd">    leverage : float,</span>
<span class="sd">        maximum exposure to leverage in which leverage is defined as sum(abs(weights))</span>
<span class="sd">    weight_seq : seq, optional</span>
<span class="sd">        list of seed sequence of weights. uses generate_sequence()</span>
<span class="sd">    max_permutations : int, optional</span>
<span class="sd">        integer- maximum number of iterations to try for a portfolio which is valid, default 2000</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    weights array that satisfy the constraints on portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rp_increase</span>
<span class="sd">    rp_decrease</span>
<span class="sd">    fn_map</span>
<span class="sd">   </span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="kn">import</span> <span class="nn">itertools</span>
    
    <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">min_sum</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">0.01</span>
    <span class="n">max_sum</span> <span class="o">+=</span> <span class="mf">0.01</span>
    <span class="k">if</span> <span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">weight_seq</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">generate_sequence</span><span class="p">(</span><span class="n">minimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_box</span><span class="p">),</span> <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_box</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">)</span> <span class="c1">#GenerateSequence Function</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">group_pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">max_pos_long</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">max_pos_short</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">weight_seq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">tolerence</span> <span class="o">=</span> <span class="mf">1.490116e-08</span>
    <span class="n">permutation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">min_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">max_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> 
    <span class="n">max_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">leverage_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">leverage</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> 
    <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> 
    <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span><span class="p">,</span> <span class="n">cUP</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">permutation</span> <span class="o">&lt;</span> <span class="n">max_permutations</span><span class="p">)):</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="n">permutation</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">n_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span>
        <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">),</span> <span class="n">max_pos</span><span class="p">)</span>
        <span class="n">full_index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_weights</span><span class="p">)</span>
        <span class="n">not_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">full_index</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">random_index</span><span class="p">))))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">not_index</span><span class="p">)):</span>
            <span class="n">tmp_w</span><span class="p">[</span><span class="n">not_index</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">min_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_sum</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_increase</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="n">min_sum</span><span class="p">,</span> 
        <span class="n">max_box</span> <span class="o">=</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">max_sum_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_decrease</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">max_sum</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">leverage_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">leverage</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_decrease_leverage</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">leverage</span> <span class="o">=</span> <span class="n">leverage</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos_limit_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span><span class="p">)):</span>
            <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">rp_position_limit</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">tmp_w</span><span class="p">,</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">min_box</span><span class="p">,</span> <span class="n">max_box</span> <span class="o">=</span> <span class="n">max_box</span><span class="p">,</span> <span class="n">max_pos</span> <span class="o">=</span> <span class="n">max_pos</span><span class="p">,</span> <span class="n">max_pos_long</span> <span class="o">=</span> <span class="n">max_pos_long</span><span class="p">,</span> <span class="n">max_pos_short</span> <span class="o">=</span> <span class="n">max_pos_short</span><span class="p">,</span> <span class="n">weight_seq</span> <span class="o">=</span> <span class="n">weight_seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">groups</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">group_fail</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cLO</span><span class="p">,</span> <span class="n">cUP</span><span class="p">,</span> <span class="n">group_pos</span><span class="p">))):</span>
                <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
                <span class="n">tmp_group_i</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
                    <span class="n">j_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">tmp_group_w</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tmp_min_box</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tmp_max_box</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">js</span> <span class="ow">in</span> <span class="n">j_idx</span><span class="p">:</span>
                        <span class="n">tmp_group_w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">[</span><span class="n">js</span><span class="p">])</span>
                        <span class="n">tmp_min_box</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_box</span><span class="p">[</span><span class="n">js</span><span class="p">])</span>
                        <span class="n">tmp_max_box</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_box</span><span class="p">[</span><span class="n">js</span><span class="p">])</span>
                    <span class="n">tmp_group_i</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rp_transform</span><span class="p">(</span><span class="n">w</span> <span class="o">=</span> <span class="n">tmp_group_w</span><span class="p">,</span> 
                                        <span class="n">min_sum</span> <span class="o">=</span> <span class="n">cLO</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="n">cUP</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">min_box</span> <span class="o">=</span> <span class="n">tmp_min_box</span><span class="p">,</span> 
                                            <span class="n">max_box</span> <span class="o">=</span> <span class="n">tmp_max_box</span><span class="p">,</span> <span class="n">max_permutations</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">)])</span>
                <span class="n">tmp_group_i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">tmp_group_i</span><span class="p">))</span>
                <span class="n">tmp_group_i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">tmp_group_i</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_groups</span><span class="p">):</span>
                    <span class="n">j_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">tmp_w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_group_i</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                            <span class="c1">#group constraint</span>

    <span class="n">portfolio</span> <span class="o">=</span> <span class="n">tmp_w</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_sum</span> <span class="ow">or</span> <span class="nb">sum</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_sum</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Impossible portfolio created. Try relaxing constraints&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.transaction_cost_constraint">
    <p>def <span class="ident">transaction_cost_constraint</span>(</p><p>assets, ptc, kind=&#39;transaction&#39;, enabled=True, message=True)</p>
    </div>
    

    
  
    <div class="desc"><p>A proportional cost value is determined under the transaction cost constraint.
When type=”transaction_cost” is specified, this function is called by add.constraint.</p>
<h2>Parameters</h2>
<p>assets : int, or array-like,
        number of assets, or optionally a named list of assets determining initial weights.
ptc : float,
        proportional transaction cost value.<br />
kind : str,
        string of kind of constraint 
enabled : bool, default = True
        bool to enable or disable constraints.
message : bool, default = True
        bool to enable or disable messages.</p>
<h2>Returns</h2>
<p>Adds transaction _cost constraints to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>adds a tranaction cost constraint on portfolio</h1>
<p>add_constraint(portfolio, kind = 'transaction_cost', ptc = 0.1)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.transaction_cost_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.transaction_cost_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">transaction_cost_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">ptc</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;transaction&#39;</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A proportional cost value is determined under the transaction cost constraint.</span>
<span class="sd">    When type=”transaction_cost” is specified, this function is called by add.constraint.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">            number of assets, or optionally a named list of assets determining initial weights.</span>
<span class="sd">    ptc : float,</span>
<span class="sd">            proportional transaction cost value.  </span>
<span class="sd">    kind : str,</span>
<span class="sd">            string of kind of constraint </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds transaction _cost constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; #adds a tranaction cost constraint on portfolio</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;transaction_cost&#39;, ptc = 0.1)</span>

<span class="sd">&quot;&quot;&quot;</span>

    


    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;ptc&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">ptc</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.turnover">
    <p>def <span class="ident">turnover</span>(</p><p>weights, wgt_init=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Turnover estimation of two weight lists.
This is used as an objective function and is named when the user adds with add.objective 
an objective of type turnover.</p>
<h2>Parameters</h2>
<p>weights : array-like,
    Weights list from optimization.
wgt_init : array-like, optional
    Initial weights list used for measuring turnover from.</p>
<h2>Returns</h2>
<p>returns the turnover of the portfolio given the weights</p>
<h2>See Also</h2>
<p>var_portfolio
port_mean</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
w = [0.2,0.3,0.4,-.4,0.5]
turnover(w)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.turnover', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.turnover" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">turnover</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">wgt_init</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Turnover estimation of two weight lists.</span>
<span class="sd">    This is used as an objective function and is named when the user adds with add.objective </span>
<span class="sd">    an objective of type turnover.</span>
<span class="sd">  </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array-like,</span>
<span class="sd">        Weights list from optimization.</span>
<span class="sd">    wgt_init : array-like, optional</span>
<span class="sd">        Initial weights list used for measuring turnover from.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the turnover of the portfolio given the weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    var_portfolio</span>
<span class="sd">    port_mean</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,0.4,-.4,0.5]</span>
<span class="sd">    &gt;&gt;&gt; turnover(w)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wgt_init</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wgt_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wgt_init</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The length of weights and wgt_init must be the same&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">wgt_init</span><span class="o">-</span><span class="n">weights</span><span class="p">))</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_constraint">
    <p>def <span class="ident">turnover_constraint</span>(</p><p>assets, turnover_target, kind=&#39;turnover&#39;, enabled=True, message=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Target turnover value is determined under the turnover constraint. 
    When type=”turnover” is stated, the function is called by add.constraint</p>
<div class="codehilite"><pre><span></span><span class="gh">Parameters</span>
<span class="gh">----------</span>
asset : Int, or array-like,
        Number of assets or, as an alternative, a named asset list specifying initial weights.
kind :  str,
        character kind of the constraint.    
enabled : bool, default = True
        bool to enable or disable constraints.
message : bool, default = True
        bool to enable or disable messages.

<span class="gh">Returns</span>
<span class="gh">-------</span>
Adds  turnover constraints to object portfolio_spec of the specified input.

<span class="gh">See Also</span>
<span class="gh">--------</span>
add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint


<span class="gh">Examples</span>
<span class="gh">--------</span>
</pre></div>


<blockquote>
<blockquote>
<blockquote>
<h1>turnover constraint</h1>
<p>add_constraint(portfolio, kind = 'turnover', turnover_target = 0.1)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">turnover_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">turnover_target</span><span class="p">,</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;turnover&#39;</span><span class="p">,</span>  <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Target turnover value is determined under the turnover constraint. </span>
<span class="sd">    When type=”turnover” is stated, the function is called by add.constraint</span>
<span class="sd">   </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    asset : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    kind :  str,</span>
<span class="sd">            character kind of the constraint.    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds  turnover constraints to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>

<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">&gt;&gt;&gt; #turnover constraint</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio, kind = &#39;turnover&#39;, turnover_target = 0.1)</span>

<span class="sd">&quot;&quot;&quot;</span> 
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;turnover_target&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">],[</span><span class="n">turnover_target</span><span class="p">,</span> <span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_objective">
    <p>def <span class="ident">turnover_objective</span>(</p><p>name, arguments, target=None, multiplier=1, enabled=True)</p>
    </div>
    

    
  
    <div class="desc"><p>We'll try minimizing the turnover metric if the goal is null.  <br />
Constructor for the turnover_objective class.</p>
<h2>Parameters</h2>
<p>name : str,
    The target name should correspond to a feature, although we will attempt to make allowances.
arguments : dict,
    Default arguments to be transferred when executed on an objective function.
target : float,
    Univariate goal for the target.
multiplier : int, optional
    Multiplier to be added to the target, typically 1 or -1.<br />
enabled : bool, default = True
    bool to enable or disable constraints.</p>
<h2>Returns</h2>
<p>Adds turnover_objective to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_objectives
portfolio_risk_objectives
risk_budget_objective
turnover_objective
minmax_objective
weight_constraint_objective</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')</p>
<h1>adding objectives</h1>
<p>add_objective(kind = 'turnover', name = 'turnover', target = 0.2)
add_objective(kind = 'performance_metrics', name = 'sharpe', target = 0.13)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
        #SOME CODE
add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
NOTE: The output of sortino_ratio or other custom function in objective must be a float.
NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.turnover_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">turnover_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We&#39;ll try minimizing the turnover metric if the goal is null.    </span>
<span class="sd">    Constructor for the turnover_objective class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The target name should correspond to a feature, although we will attempt to make allowances.</span>
<span class="sd">    arguments : dict,</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    target : float,</span>
<span class="sd">        Univariate goal for the target.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.  </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">    </span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds turnover_objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>

<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; #adding objectives</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;turnover&#39;, name = &#39;turnover&#39;, target = 0.2)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>



<span class="sd">&quot;&quot;&quot;</span>


    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.var_portfolio">
    <p>def <span class="ident">var_portfolio</span>(</p><p>R, weights)</p>
    </div>
    

    
  
    <div class="desc"><p>When var is an object for mean variance or quadratic utility optimization,
this function is used to measure the portfolio variance through a call to constrained_objective.</p>
<p>Main function to calculate portfolio variance</p>
<h2>Parameters</h2>
<p>R : pd.DataFrame,
    return series
weights: array-like,
    list of weights of assets.</p>
<h2>Returns</h2>
<p>returns the variance of the portfolio given the following weights.</p>
<h2>Notes</h2>
<p>\sigma_{p} = w \Sigma_{p} w^{T}</p>
<h2>See Also</h2>
<p>port_mean
VaR
cVaR</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>calculate the variance of portfolio</h1>
<p>import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
w = [0.2,0.3,-0.1,0.6,0.8]
var_portfolio(w,R)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.var_portfolio', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.var_portfolio" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">var_portfolio</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When var is an object for mean variance or quadratic utility optimization,</span>
<span class="sd">    this function is used to measure the portfolio variance through a call to constrained_objective.</span>
<span class="sd">    </span>
<span class="sd">    Main function to calculate portfolio variance</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pd.DataFrame,</span>
<span class="sd">        return series</span>
<span class="sd">    weights: array-like,</span>
<span class="sd">        list of weights of assets.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    returns the variance of the portfolio given the following weights.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    \sigma_{p} = w \Sigma_{p} w^{T}</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    port_mean</span>
<span class="sd">    VaR</span>
<span class="sd">    cVaR</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # calculate the variance of portfolio</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; w = [0.2,0.3,-0.1,0.6,0.8]</span>
<span class="sd">    &gt;&gt;&gt; var_portfolio(w,R)</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>




    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">weights</span><span class="p">))))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.weight_concentration_objective">
    <p>def <span class="ident">weight_concentration_objective</span>(</p><p>name, conc_aversion, conc_groups=None, multiplier=1, arguments=None, enabled=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Using the HHI as a concentration scale, this feature penalizes weight concentration
Constructor for objective of weight concentration.</p>
<h2>Parameters</h2>
<p>name : str,
    The name of the concentration measure is currently only supported by "HHI".
conc_aversion : float,
    concentration value(s) of aversion
conc_groups : dict,
    A dictionary defining the asset classes. Similar to 'group constraint' groups.
multiplier : int, optional
    Multiplier to be added to the target, typically 1 or -1.
arguments : dict, optional
    Default arguments to be transferred when executed on an objective function.
enabled : bool, default = True
    bool to enable or disable constraints.</p>
<h2>Returns</h2>
<p>Adds weight constraints objective to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_objectives
portfolio_risk_objectives
risk_budget_objective
turnover_objective
minmax_objective
weight_constraint_objective</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>port = portfolio_spec(assets = 5)
import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
add_constraint('long_only')
add_constraint('full_investment')
add_objective(kind = 'weight_conc', name = 'HHI', target = 0.11)
add_objective(kind = 'performance_metrics', name = 'sharpe', target = 0.13)</p>
<h1>add a custom objective by first defining it.</h1>
<p>def sortino_ratio(w,R):
        #SOME CODE</p>
<p>add_objective(kind = 'performance_metrics', name = {'sortino':sortino_ratio}, target = 0.35)
NOTE: The output of sortino_ratio or other custom function in objective must be a float.
NOTE: you can also add other custom function in other kind of objective in similar methd.</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.weight_concentration_objective', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.weight_concentration_objective" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">weight_concentration_objective</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">conc_aversion</span><span class="p">,</span> <span class="n">conc_groups</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">    Using the HHI as a concentration scale, this feature penalizes weight concentration</span>
<span class="sd">    Constructor for objective of weight concentration.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str,</span>
<span class="sd">        The name of the concentration measure is currently only supported by &quot;HHI&quot;.</span>
<span class="sd">    conc_aversion : float,</span>
<span class="sd">        concentration value(s) of aversion</span>
<span class="sd">    conc_groups : dict,</span>
<span class="sd">        A dictionary defining the asset classes. Similar to &#39;group constraint&#39; groups.</span>
<span class="sd">    multiplier : int, optional</span>
<span class="sd">        Multiplier to be added to the target, typically 1 or -1.</span>
<span class="sd">    arguments : dict, optional</span>
<span class="sd">        Default arguments to be transferred when executed on an objective function.</span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">        bool to enable or disable constraints.</span>
<span class="sd">   </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds weight constraints objective to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_objectives</span>
<span class="sd">    portfolio_risk_objectives</span>
<span class="sd">    risk_budget_objective</span>
<span class="sd">    turnover_objective</span>
<span class="sd">    minmax_objective</span>
<span class="sd">    weight_constraint_objective</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; port = portfolio_spec(assets = 5)</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;long_only&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(&#39;full_investment&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;weight_conc&#39;, name = &#39;HHI&#39;, target = 0.11)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = &#39;sharpe&#39;, target = 0.13)</span>
<span class="sd">    &gt;&gt;&gt; # add a custom objective by first defining it.</span>
<span class="sd">    &gt;&gt;&gt; def sortino_ratio(w,R):</span>
<span class="sd">            #SOME CODE</span>
<span class="sd">            </span>
<span class="sd">    &gt;&gt;&gt; add_objective(kind = &#39;performance_metrics&#39;, name = {&#39;sortino&#39;:sortino_ratio}, target = 0.35)</span>
<span class="sd">    NOTE: The output of sortino_ratio or other custom function in objective must be a float.</span>
<span class="sd">    NOTE: you can also add other custom function in other kind of objective in similar methd.</span>



<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>





    <span class="k">if</span> <span class="n">conc_groups</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conc_groups</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">conc_groups</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;conc_groups must be a dictionary&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
            <span class="n">conc_aversion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">conc_groups</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">conc_groups</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;len(conc_aversion) must equal len(conc_groups)&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">conc_groups</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">conc_aversion</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;conc_aversion must be type float when conc_groups is not defined&#39;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conc_aversion&#39;</span><span class="p">,</span> <span class="s1">&#39;conc_groups&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">conc_aversion</span><span class="p">,</span> <span class="n">conc_groups</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span><span class="n">multiplier</span><span class="p">,</span><span class="n">enabled</span><span class="p">,</span><span class="n">name</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.weight_sum_constraint">
    <p>def <span class="ident">weight_sum_constraint</span>(</p><p>assets, kind=&#39;weight_sum&#39;, min_sum=0.99, max_sum=1.01, enabled=True, message=True)</p>
    </div>
    

    
  
    <div class="desc"><p>The constraint determines the sum of the weights of the upper and lower limits.
This function is called add.constraint when the type is defined as "weight sum", 
"leverage", "full investment", "dollar neutral" or "active"</p>
<h2>Parameters</h2>
<p>assets : Int, or array-like,
        Number of assets or, as an alternative, a named asset list specifying initial weights.
kind : str,
        character kind of the constraint.
min_sum : float,
        Minimum sum of all weights of assets, default 0.99
max_sum : float, 
        Maximum sum of all weights of assets, default 1.01  <br />
enabled : bool, default = True
        bool to enable or disable constraints.
message : bool, default = True
        bool to enable or disable messages.  </p>
<h2>Returns</h2>
<p>Adds weight_sum constraint to object portfolio_spec of the specified input. </p>
<h2>See Also</h2>
<p>add_constraints
box_constraints
group_constraints
weight_sum_constraint
turnover_constraint
diversification_constraint
position_limit_constraint
return_constraint
factor_exposure_constraint
transaction_cost_constraint
leverage_exposure_constraint</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<h1>adding weight_sum constraint</h1>
<p>add_constraint(portfolio, kind = 'weight_sum', min_sum = 0.9, max_sum = .95)</p>
<h1>special case of weight_sum is dollar_neutral/active or full_investment</h1>
<p>add_constraint(portfolio, kind = 'dollar_neutral')
add_constraint(portfolio, kind = 'full_investment')</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.weight_sum_constraint', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.weight_sum_constraint" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">weight_sum_constraint</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;weight_sum&#39;</span><span class="p">,</span> <span class="n">min_sum</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">max_sum</span> <span class="o">=</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>


<span class="sd">    The constraint determines the sum of the weights of the upper and lower limits.</span>
<span class="sd">    This function is called add.constraint when the type is defined as &quot;weight sum&quot;, </span>
<span class="sd">    &quot;leverage&quot;, &quot;full investment&quot;, &quot;dollar neutral&quot; or &quot;active&quot;</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assets : Int, or array-like,</span>
<span class="sd">            Number of assets or, as an alternative, a named asset list specifying initial weights.</span>
<span class="sd">    kind : str,</span>
<span class="sd">            character kind of the constraint.</span>
<span class="sd">    min_sum : float,</span>
<span class="sd">            Minimum sum of all weights of assets, default 0.99</span>
<span class="sd">    max_sum : float, </span>
<span class="sd">            Maximum sum of all weights of assets, default 1.01    </span>
<span class="sd">    enabled : bool, default = True</span>
<span class="sd">            bool to enable or disable constraints.</span>
<span class="sd">    message : bool, default = True</span>
<span class="sd">            bool to enable or disable messages.  </span>

<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Adds weight_sum constraint to object portfolio_spec of the specified input. </span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    add_constraints</span>
<span class="sd">    box_constraints</span>
<span class="sd">    group_constraints</span>
<span class="sd">    weight_sum_constraint</span>
<span class="sd">    turnover_constraint</span>
<span class="sd">    diversification_constraint</span>
<span class="sd">    position_limit_constraint</span>
<span class="sd">    return_constraint</span>
<span class="sd">    factor_exposure_constraint</span>
<span class="sd">    transaction_cost_constraint</span>
<span class="sd">    leverage_exposure_constraint</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; # adding weight_sum constraint</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;weight_sum&#39;, min_sum = 0.9, max_sum = .95)</span>
<span class="sd">    &gt;&gt;&gt; # special case of weight_sum is dollar_neutral/active or full_investment</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;dollar_neutral&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio, kind = &#39;full_investment&#39;)</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>






    
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;full_investment&#39;</span><span class="p">:</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;dollar_neutral&#39;</span><span class="p">:</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span>
        <span class="n">min_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;min_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;max_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="n">min_sum</span><span class="p">,</span> <span class="n">max_sum</span><span class="p">,</span><span class="n">enabled</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman" class="name">class <span class="ident">black_litterman</span></p>
      
  
    <div class="desc"><p>A class to call black_litterman object.</p>
<p>Black-litterman formula is popular to get posterior moments of the portfolio.</p>
<p>...</p>
<h2>Attributes</h2>
<p>R : pandas.DataFrame
    dataframe of returns series.
P : matrix-like,
    KXN link matrix where N is the number of assets and K are the views</p>
<h2>Methods</h2>
<p>fit(Mu = None, S = None, Views = None, tau = 1):
    returns a matrix of posterior returns based on Views and returns data.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">black_litterman</span><span class="p">:</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to call black_litterman object.</span>
<span class="sd">    </span>
<span class="sd">    Black-litterman formula is popular to get posterior moments of the portfolio.</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pandas.DataFrame</span>
<span class="sd">        dataframe of returns series.</span>
<span class="sd">    P : matrix-like,</span>
<span class="sd">        KXN link matrix where N is the number of assets and K are the views</span>
<span class="sd">        </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    fit(Mu = None, S = None, Views = None, tau = 1):</span>
<span class="sd">        returns a matrix of posterior returns based on Views and returns data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for all necessary attributes of class black_litterman</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    R : pandas.DataFrame</span>
<span class="sd">        dataframe of returns series.</span>
<span class="sd">    P : matrix-like,</span>
<span class="sd">        KXN link matrix where N is the number of assets and K are the views</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Mu</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Views</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fit method of black_litterman object</span>
<span class="sd">    </span>
<span class="sd">    Main function to call in order to return the posterior mean of the portfolio given the views and return.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Mu : array-like, optional</span>
<span class="sd">        prior mean of the returns. numpy.mean is called if Mu is None</span>
<span class="sd">    S : matrix-like, optional</span>
<span class="sd">        NXN covariance matrix. numpy.cov is called if S is None</span>
<span class="sd">    Views: array-like, default = None</span>
<span class="sd">        array of K views held by investor. </span>
<span class="sd">    Tau: float, default = 1</span>
<span class="sd">        multiplying factor to be used.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array:</span>
<span class="sd">        returns an array of posterior moments of portfolio given the returns and weights</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    Black-litterman formula is very useful if an investor believes that a particular stock is going to rise</span>
<span class="sd">    compared to others although this information is not incorporated in the stock price. Essentially, it captures</span>
<span class="sd">    the views an investor holds for a particular asset.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">                       &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; P = np.matrix([[-1, 0, 1],[0,-1,1]])</span>
<span class="sd">    &gt;&gt;&gt; Views = np.matrix([[0.02],</span>
<span class="sd">                   [0.05]])</span>
<span class="sd">    &gt;&gt;&gt; bl = black_litterman(R = port_ret, P = P)</span>
<span class="sd">    &gt;&gt;&gt; bl.fit(Views = Views)</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
        <span class="kn">import</span> <span class="nn">random</span>
    


        <span class="k">if</span> <span class="n">Mu</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mu</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Length of Mu must equal R&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">S</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Dimensions of Sigma must equal Dimensions of R&#39;</span><span class="p">)</span>
        <span class="n">Omega</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Views</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Views</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span>
        <span class="n">tot_wgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Omega</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>
        <span class="n">wgt_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Mu</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Omega</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Views</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tot_wgt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">wgt_avg</span><span class="p">))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman">black_litterman</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, R, P)</p>
    </div>
    

    
  
    <div class="desc"><p>Constructor for all necessary attributes of class black_litterman</p>
<p>...</p>
<h2>Attributes</h2>
<p>R : pandas.DataFrame
    dataframe of returns series.
P : matrix-like,
    KXN link matrix where N is the number of assets and K are the views</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Constructor for all necessary attributes of class black_litterman</span>
<span class="sd">...</span>
<span class="sd">Attributes</span>
<span class="sd">----------</span>
<span class="sd">R : pandas.DataFrame</span>
<span class="sd">    dataframe of returns series.</span>
<span class="sd">P : matrix-like,</span>
<span class="sd">    KXN link matrix where N is the number of assets and K are the views</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.fit">
    <p>def <span class="ident">fit</span>(</p><p>self, Mu=None, S=None, Views=None, tau=1)</p>
    </div>
    

    
  
    <div class="desc"><p>fit method of black_litterman object</p>
<p>Main function to call in order to return the posterior mean of the portfolio given the views and return.</p>
<h2>Parameters</h2>
<p>Mu : array-like, optional
    prior mean of the returns. numpy.mean is called if Mu is None
S : matrix-like, optional
    NXN covariance matrix. numpy.cov is called if S is None
Views: array-like, default = None
    array of K views held by investor. 
Tau: float, default = 1
    multiplying factor to be used.</p>
<h2>Returns</h2>
<p>array:
    returns an array of posterior moments of portfolio given the returns and weights</p>
<h2>See Also</h2>
<p>portfolio_spec
optimize_portfolio</p>
<h2>Notes</h2>
<p>Black-litterman formula is very useful if an investor believes that a particular stock is going to rise
compared to others although this information is not incorporated in the stock price. Essentially, it captures
the views an investor holds for a particular asset.</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
                   'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6]})
port_ret = port.pct_change().dropna()
P = np.matrix([[-1, 0, 1],[0,-1,1]])
Views = np.matrix([[0.02],
               [0.05]])
bl = black_litterman(R = port_ret, P = P)
bl.fit(Views = Views)</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.fit', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Mu</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Views</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">fit method of black_litterman object</span>

<span class="sd">Main function to call in order to return the posterior mean of the portfolio given the views and return.</span>

<span class="sd">Parameters</span>
<span class="sd">----------</span>
<span class="sd">Mu : array-like, optional</span>
<span class="sd">    prior mean of the returns. numpy.mean is called if Mu is None</span>
<span class="sd">S : matrix-like, optional</span>
<span class="sd">    NXN covariance matrix. numpy.cov is called if S is None</span>
<span class="sd">Views: array-like, default = None</span>
<span class="sd">    array of K views held by investor. </span>
<span class="sd">Tau: float, default = 1</span>
<span class="sd">    multiplying factor to be used.</span>
<span class="sd">    </span>
<span class="sd">Returns</span>
<span class="sd">-------</span>
<span class="sd">array:</span>
<span class="sd">    returns an array of posterior moments of portfolio given the returns and weights</span>

<span class="sd">See Also</span>
<span class="sd">--------</span>
<span class="sd">portfolio_spec</span>
<span class="sd">optimize_portfolio</span>

<span class="sd">Notes</span>
<span class="sd">-----</span>

<span class="sd">Black-litterman formula is very useful if an investor believes that a particular stock is going to rise</span>
<span class="sd">compared to others although this information is not incorporated in the stock price. Essentially, it captures</span>
<span class="sd">the views an investor holds for a particular asset.</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">&gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">&gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">&gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">&gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">&gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">                   &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6]})</span>
<span class="sd">&gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">&gt;&gt;&gt; P = np.matrix([[-1, 0, 1],[0,-1,1]])</span>
<span class="sd">&gt;&gt;&gt; Views = np.matrix([[0.02],</span>
<span class="sd">               [0.05]])</span>
<span class="sd">&gt;&gt;&gt; bl = black_litterman(R = port_ret, P = P)</span>
<span class="sd">&gt;&gt;&gt; bl.fit(Views = Views)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>

    <span class="k">if</span> <span class="n">Mu</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mu</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Length of Mu must equal R&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">S</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">()))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Dimensions of Sigma must equal Dimensions of R&#39;</span><span class="p">)</span>
    <span class="n">Omega</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Views</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Views</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span>
    <span class="n">tot_wgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Omega</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">))</span>
    <span class="n">wgt_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Mu</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Omega</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Views</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tot_wgt</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">wgt_avg</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.P" class="name">var <span class="ident">P</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.black_litterman.R" class="name">var <span class="ident">R</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec" class="name">class <span class="ident">portfolio_spec</span></p>
      
  
    <div class="desc"><p>A class to call portfolio_spec object.</p>
<p>portfolio_spec object is the main class that contains all the constraints, objectives, optimal weights;
it is called by many functions to get relevant attributes and store attributes.</p>
<p>...</p>
<h2>Attributes</h2>
<p>assets : int, or array-like,
    add assets to portfolio either via name of assets in the form of an array or int of number of assets.
category_label: dict, optional
    dictionary of different categories assigned to different assets. similar to group_constraint.
    See group_constraint.
weights_seq : sequence, optional
    sequence of random weights. These weights will be used to optimize weights. See generate_sequence
message : bool, default = False
    bool to enable or diable message</p>
<h2>Methods</h2>
<p>port_summary():
    returns a dictionary of the summary of constraints and objective added by add_consraint and add_objective
    funtions. See add_constraint, add_objective
optimal_portfolio():
    returns a dictionary of optimal weights, objective measure and minimum value calculated by the specified solver
    NOTE: optimal_portfolio will only return result if optimize_portfolio is called. See optimize_portfolio</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">portfolio_spec</span><span class="p">:</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to call portfolio_spec object.</span>
<span class="sd">    </span>
<span class="sd">    portfolio_spec object is the main class that contains all the constraints, objectives, optimal weights;</span>
<span class="sd">    it is called by many functions to get relevant attributes and store attributes.</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">        add assets to portfolio either via name of assets in the form of an array or int of number of assets.</span>
<span class="sd">    category_label: dict, optional</span>
<span class="sd">        dictionary of different categories assigned to different assets. similar to group_constraint.</span>
<span class="sd">        See group_constraint.</span>
<span class="sd">    weights_seq : sequence, optional</span>
<span class="sd">        sequence of random weights. These weights will be used to optimize weights. See generate_sequence</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or diable message</span>
<span class="sd">        </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    port_summary():</span>
<span class="sd">        returns a dictionary of the summary of constraints and objective added by add_consraint and add_objective</span>
<span class="sd">        funtions. See add_constraint, add_objective</span>
<span class="sd">    optimal_portfolio():</span>
<span class="sd">        returns a dictionary of optimal weights, objective measure and minimum value calculated by the specified solver</span>
<span class="sd">        NOTE: optimal_portfolio will only return result if optimize_portfolio is called. See optimize_portfolio</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weights_seq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for all necessary attributes of class black_litterman</span>

<span class="sd">    ...</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    assets : int, or array-like,</span>
<span class="sd">        add assets to portfolio either via name of assets in the form of an array or int of number of assets.</span>
<span class="sd">    category_label: dict, optional</span>
<span class="sd">        dictionary of different categories assigned to different assets. similar to group_constraint.</span>
<span class="sd">        See group_constraint.</span>
<span class="sd">    weights_seq : sequence, optional</span>
<span class="sd">        sequence of random weights. These weights will be used to optimize weights. See generate_sequence</span>
<span class="sd">    message : bool, default = False</span>
<span class="sd">        bool to enable or diable message</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>




        <span class="k">if</span> <span class="n">assets</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Please Enter Asset Names&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">assetnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asset&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">assets</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
                <span class="n">assetnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;asset&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
                <span class="n">assets</span> <span class="o">=</span> <span class="n">assetnames</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">assetnames</span> <span class="o">=</span> <span class="n">assets</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">tmp_cat_len</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)):</span>
                <span class="n">tmp_cat_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">category_labels</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">tmp_cat_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_cat_len</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tmp_cat_len</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;len(assets) must equal len(category_labels)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Category_labels must be a list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">=</span> <span class="n">category_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight_seq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">port_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    summary of the portfolio</span>
<span class="sd">    </span>
<span class="sd">    method to provide a summary of the portfolio.</span>
<span class="sd">            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict:</span>
<span class="sd">        returns a dictionary of all constraints and objective</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; p1 = portfolio_spec(assets = 3)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;factor_exposure&#39;, B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;group&#39;, groups = dict(zip([&#39;equity&#39;,&#39;debt&#39;],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;transaction&#39;, ptc = 0.2)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;return&#39;, target = 0.1, name = &#39;return_obj&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;minmax&#39;,  minimum = 0.2, maximum = 0.3,name = &#39;risk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; p1.port_summary()</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">({</span><span class="s1">&#39;Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span><span class="s1">&#39;Number of Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nassets</span><span class="p">,</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span><span class="p">,</span>
              <span class="s1">&#39;Constraints&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="s1">&#39;Objectives&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">optimal_portfolio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    summary of the portfolio</span>
<span class="sd">    </span>
<span class="sd">    method to provide a summary of the optimal weights, objective and minimum output of portfolio.</span>
<span class="sd">            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict:</span>
<span class="sd">        returns a dictionary of optimal weights, objective and minimum output of portfolio</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    portfolio_spec</span>
<span class="sd">    optimize_portfolio</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">    &gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">    &gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">    &gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">    &gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">        &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">        &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">    &gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">    &gt;&gt;&gt; R = port_ret</span>
<span class="sd">    &gt;&gt;&gt; p1 = portfolio_spec(assets = 3)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;factor_exposure&#39;, B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;group&#39;, groups = dict(zip([&#39;equity&#39;,&#39;debt&#39;],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)</span>
<span class="sd">    &gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;transaction&#39;, ptc = 0.2)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;return&#39;, target = 0.1, name = &#39;return_obj&#39;)</span>
<span class="sd">    &gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;minmax&#39;,  minimum = 0.2, maximum = 0.3,name = &#39;risk&#39;)</span>
<span class="sd">    &gt;&gt;&gt; optimize_portfolio(R, p1, optimize_method = &#39;DEoptim&#39;)</span>
<span class="sd">    &gt;&gt;&gt; p1.optimal_weights()</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
        <span class="kn">import</span> <span class="nn">random</span>




        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Please run optimize_portfolio function before call optimzal weights&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">({</span><span class="s1">&#39;Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span><span class="s1">&#39;Number of Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nassets</span><span class="p">,</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span><span class="p">,</span>
               <span class="s1">&#39;Weights&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="s1">&#39;Objective_measures&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">objective_measures</span><span class="p">})</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec">portfolio_spec</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, assets, category_labels=None, weights_seq=None, message=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Constructor for all necessary attributes of class black_litterman</p>
<p>...</p>
<h2>Attributes</h2>
<p>assets : int, or array-like,
    add assets to portfolio either via name of assets in the form of an array or int of number of assets.
category_label: dict, optional
    dictionary of different categories assigned to different assets. similar to group_constraint.
    See group_constraint.
weights_seq : sequence, optional
    sequence of random weights. These weights will be used to optimize weights. See generate_sequence
message : bool, default = False
    bool to enable or diable message</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weights_seq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Constructor for all necessary attributes of class black_litterman</span>
<span class="sd">...</span>
<span class="sd">Attributes</span>
<span class="sd">----------</span>

<span class="sd">assets : int, or array-like,</span>
<span class="sd">    add assets to portfolio either via name of assets in the form of an array or int of number of assets.</span>
<span class="sd">category_label: dict, optional</span>
<span class="sd">    dictionary of different categories assigned to different assets. similar to group_constraint.</span>
<span class="sd">    See group_constraint.</span>
<span class="sd">weights_seq : sequence, optional</span>
<span class="sd">    sequence of random weights. These weights will be used to optimize weights. See generate_sequence</span>
<span class="sd">message : bool, default = False</span>
<span class="sd">    bool to enable or diable message</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="k">if</span> <span class="n">assets</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Please Enter Asset Names&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">assetnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asset&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">assets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span>
            <span class="n">assetnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;asset&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
            <span class="n">assets</span> <span class="o">=</span> <span class="n">assetnames</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">assetnames</span> <span class="o">=</span> <span class="n">assets</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">tmp_cat_len</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)):</span>
            <span class="n">tmp_cat_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">category_labels</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">tmp_cat_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tmp_cat_len</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tmp_cat_len</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;len(assets) must equal len(category_labels)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">category_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Category_labels must be a list&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span> <span class="o">=</span> <span class="n">category_labels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nassets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weight_seq</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">objective_measures</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.optimal_portfolio">
    <p>def <span class="ident">optimal_portfolio</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>summary of the portfolio</p>
<p>method to provide a summary of the optimal weights, objective and minimum output of portfolio.</p>
<h2>Returns</h2>
<p>dict:
    returns a dictionary of optimal weights, objective and minimum output of portfolio</p>
<h2>See Also</h2>
<p>portfolio_spec
optimize_portfolio</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
p1 = portfolio_spec(assets = 3)
add_constraint(portfolio = p1, kind = 'factor_exposure', B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)
add_constraint(portfolio = p1, kind = 'group', groups = dict(zip(['equity','debt'],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)
add_constraint(portfolio = p1, kind = 'transaction', ptc = 0.2)
add_objective(portfolio = p1, kind = 'return', target = 0.1, name = 'return_obj')
add_objective(portfolio = p1, kind = 'minmax',  minimum = 0.2, maximum = 0.3,name = 'risk')
optimize_portfolio(R, p1, optimize_method = 'DEoptim')
p1.optimal_weights()</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.optimal_portfolio', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.optimal_portfolio" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">optimal_portfolio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">summary of the portfolio</span>

<span class="sd">method to provide a summary of the optimal weights, objective and minimum output of portfolio.</span>
<span class="sd">        </span>
<span class="sd">Returns</span>
<span class="sd">-------</span>
<span class="sd">dict:</span>
<span class="sd">    returns a dictionary of optimal weights, objective and minimum output of portfolio</span>

<span class="sd">See Also</span>
<span class="sd">--------</span>
<span class="sd">portfolio_spec</span>
<span class="sd">optimize_portfolio</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">&gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">&gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">&gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">&gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">&gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">&gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">&gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">    &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">    &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">&gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">&gt;&gt;&gt; R = port_ret</span>
<span class="sd">&gt;&gt;&gt; p1 = portfolio_spec(assets = 3)</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;factor_exposure&#39;, B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;group&#39;, groups = dict(zip([&#39;equity&#39;,&#39;debt&#39;],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;transaction&#39;, ptc = 0.2)</span>
<span class="sd">&gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;return&#39;, target = 0.1, name = &#39;return_obj&#39;)</span>
<span class="sd">&gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;minmax&#39;,  minimum = 0.2, maximum = 0.3,name = &#39;risk&#39;)</span>
<span class="sd">&gt;&gt;&gt; optimize_portfolio(R, p1, optimize_method = &#39;DEoptim&#39;)</span>
<span class="sd">&gt;&gt;&gt; p1.optimal_weights()</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;Please run optimize_portfolio function before call optimzal weights&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">({</span><span class="s1">&#39;Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span><span class="s1">&#39;Number of Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nassets</span><span class="p">,</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span><span class="p">,</span>
           <span class="s1">&#39;Weights&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="s1">&#39;Objective_measures&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">objective_measures</span><span class="p">})</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.port_summary">
    <p>def <span class="ident">port_summary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>summary of the portfolio</p>
<p>method to provide a summary of the portfolio.</p>
<h2>Returns</h2>
<p>dict:
    returns a dictionary of all constraints and objective</p>
<h2>See Also</h2>
<p>portfolio_spec
optimize_portfolio</p>
<h2>Examples</h2>
<blockquote>
<blockquote>
<blockquote>
<p>import pandas_datareader as pdr
aapl = pdr.get_data_yahoo('AAPL')
msft = pdr.get_data_yahoo('MSFT')
tsla = pdr.get_data_yahoo('TSLA')
uber = pdr.get_data_yahoo('UBER')
amzn = pdr.get_data_yahoo('AMZN')
port = pd.DataFrame({'aapl': pd.DataFrame.reset_index(aapl).iloc[:,6], 'msft':pd.DataFrame.reset_index(msft).iloc[:,6],
    'tsla': pd.DataFrame.reset_index(tsla).iloc[:,6], 'uber':pd.DataFrame.reset_index(uber).iloc[:,6],
    'amzn': pd.DataFrame.reset_index(amzn).iloc[:,6]})
port_ret = port.pct_change().dropna()
R = port_ret
p1 = portfolio_spec(assets = 3)
add_constraint(portfolio = p1, kind = 'factor_exposure', B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)
add_constraint(portfolio = p1, kind = 'group', groups = dict(zip(['equity','debt'],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)
add_constraint(portfolio = p1, kind = 'transaction', ptc = 0.2)
add_objective(portfolio = p1, kind = 'return', target = 0.1, name = 'return_obj')
add_objective(portfolio = p1, kind = 'minmax',  minimum = 0.2, maximum = 0.3,name = 'risk')
p1.port_summary()</p>
</blockquote>
</blockquote>
</blockquote></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.port_summary', this);">Show source &equiv;</a></p>
  <div id="source-pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.port_summary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">port_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">summary of the portfolio</span>

<span class="sd">method to provide a summary of the portfolio.</span>
<span class="sd">        </span>
<span class="sd">Returns</span>
<span class="sd">-------</span>
<span class="sd">dict:</span>
<span class="sd">    returns a dictionary of all constraints and objective</span>

<span class="sd">See Also</span>
<span class="sd">--------</span>
<span class="sd">portfolio_spec</span>
<span class="sd">optimize_portfolio</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">&gt;&gt;&gt; import pandas_datareader as pdr</span>
<span class="sd">&gt;&gt;&gt; aapl = pdr.get_data_yahoo(&#39;AAPL&#39;)</span>
<span class="sd">&gt;&gt;&gt; msft = pdr.get_data_yahoo(&#39;MSFT&#39;)</span>
<span class="sd">&gt;&gt;&gt; tsla = pdr.get_data_yahoo(&#39;TSLA&#39;)</span>
<span class="sd">&gt;&gt;&gt; uber = pdr.get_data_yahoo(&#39;UBER&#39;)</span>
<span class="sd">&gt;&gt;&gt; amzn = pdr.get_data_yahoo(&#39;AMZN&#39;)</span>
<span class="sd">&gt;&gt;&gt; port = pd.DataFrame({&#39;aapl&#39;: pd.DataFrame.reset_index(aapl).iloc[:,6], &#39;msft&#39;:pd.DataFrame.reset_index(msft).iloc[:,6],</span>
<span class="sd">    &#39;tsla&#39;: pd.DataFrame.reset_index(tsla).iloc[:,6], &#39;uber&#39;:pd.DataFrame.reset_index(uber).iloc[:,6],</span>
<span class="sd">    &#39;amzn&#39;: pd.DataFrame.reset_index(amzn).iloc[:,6]})</span>
<span class="sd">&gt;&gt;&gt; port_ret = port.pct_change().dropna()</span>
<span class="sd">&gt;&gt;&gt; R = port_ret</span>
<span class="sd">&gt;&gt;&gt; p1 = portfolio_spec(assets = 3)</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;factor_exposure&#39;, B = [0.2,0.2,0.4], lower = 1.0, upper = 0.9)</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;group&#39;, groups = dict(zip([&#39;equity&#39;,&#39;debt&#39;],[[0,1], [2]])), group_min = 0.2, group_max = 0.5)</span>
<span class="sd">&gt;&gt;&gt; add_constraint(portfolio = p1, kind = &#39;transaction&#39;, ptc = 0.2)</span>
<span class="sd">&gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;return&#39;, target = 0.1, name = &#39;return_obj&#39;)</span>
<span class="sd">&gt;&gt;&gt; add_objective(portfolio = p1, kind = &#39;minmax&#39;,  minimum = 0.2, maximum = 0.3,name = &#39;risk&#39;)</span>
<span class="sd">&gt;&gt;&gt; p1.port_summary()</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">({</span><span class="s1">&#39;Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">,</span><span class="s1">&#39;Number of Assets&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nassets</span><span class="p">,</span><span class="s1">&#39;category_labels&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">category_labels</span><span class="p">,</span>
          <span class="s1">&#39;Constraints&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="s1">&#39;Objectives&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">})</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.assets" class="name">var <span class="ident">assets</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.category_labels" class="name">var <span class="ident">category_labels</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.constraints" class="name">var <span class="ident">constraints</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.nassets" class="name">var <span class="ident">nassets</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.objective_measures" class="name">var <span class="ident">objective_measures</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.objectives" class="name">var <span class="ident">objectives</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.weight_seq" class="name">var <span class="ident">weight_seq</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyPortfolioAnalysis.pyPortfolioAnalysis.portfolio_spec.weights" class="name">var <span class="ident">weights</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
